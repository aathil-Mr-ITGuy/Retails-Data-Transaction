[0m22:17:56.079651 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb358524750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb359bc2e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb358690c90>]}


============================== 22:17:56.089620 | a8645d3d-1cff-4f49-aaa2-1f37f6d38017 ==============================
[0m22:17:56.089620 [info ] [MainThread]: Running with dbt=1.5.9
[0m22:17:56.092259 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'version_check': 'True', 'log_cache_events': 'False', 'debug': 'False', 'log_path': '/usr/local/airflow/include/dbt/logs', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'static_parser': 'True', 'warn_error': 'None', 'quiet': 'False', 'profiles_dir': '/usr/local/airflow/include/dbt', 'cache_selected_only': 'False', 'log_format': 'default', 'write_json': 'True', 'use_colors': 'True', 'no_print': 'None'}
[0m22:17:56.141872 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a8645d3d-1cff-4f49-aaa2-1f37f6d38017', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb3583bd190>]}
[0m22:17:56.148470 [debug] [MainThread]: Set downloads directory='/tmp/dbt-downloads-cq7swk3l'
[0m22:17:56.150500 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m22:17:56.452659 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m22:17:56.458156 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m22:17:56.951481 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m22:17:56.972299 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m22:18:02.073707 [info ] [MainThread]: Installed from version 1.1.1
[0m22:18:02.076145 [info ] [MainThread]: Up to date!
[0m22:18:02.079256 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'a8645d3d-1cff-4f49-aaa2-1f37f6d38017', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb357d8ce50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb3581f8e90>]}
[0m22:18:02.083307 [debug] [MainThread]: Command `dbt deps` succeeded at 22:18:02.082855 after 6.03 seconds
[0m22:18:02.085546 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb35c1ad010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb35c1ac350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb3584eb010>]}
[0m22:18:02.094355 [debug] [MainThread]: Flushing usage events
[0m22:18:34.843284 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3b064afe90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3b064aff10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3b064dcf50>]}


============================== 22:18:34.850700 | 50a00c22-514b-4ac3-9950-9a10f0bb6e30 ==============================
[0m22:18:34.850700 [info ] [MainThread]: Running with dbt=1.5.9
[0m22:18:34.853427 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'use_experimental_parser': 'False', 'log_path': '/usr/local/airflow/include/dbt/logs', 'printer_width': '80', 'partial_parse': 'True', 'target_path': 'None', 'quiet': 'False', 'profiles_dir': '/usr/local/airflow/include/dbt/', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'fail_fast': 'False', 'log_cache_events': 'False', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'no_print': 'None', 'debug': 'False', 'warn_error': 'None', 'cache_selected_only': 'False', 'version_check': 'True', 'static_parser': 'True', 'log_format': 'default', 'indirect_selection': 'eager'}
[0m22:18:35.941217 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '50a00c22-514b-4ac3-9950-9a10f0bb6e30', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3b05c04e50>]}
[0m22:18:35.970533 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '50a00c22-514b-4ac3-9950-9a10f0bb6e30', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3b05d1cd50>]}
[0m22:18:35.973593 [info ] [MainThread]: Registered adapter: bigquery=1.5.3
[0m22:18:36.024875 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m22:18:36.035036 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:18:36.037296 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '50a00c22-514b-4ac3-9950-9a10f0bb6e30', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3b03f93a90>]}
[0m22:18:38.467323 [debug] [MainThread]: 1603: static parser failed on transform/dim_customer.sql
[0m22:18:38.509558 [debug] [MainThread]: 1602: parser fallback to jinja rendering on transform/dim_customer.sql
[0m22:18:38.513769 [debug] [MainThread]: 1699: static parser successfully parsed transform/dim_datetime.sql
[0m22:18:38.519943 [debug] [MainThread]: 1603: static parser failed on transform/dim_product.sql
[0m22:18:38.531031 [debug] [MainThread]: 1602: parser fallback to jinja rendering on transform/dim_product.sql
[0m22:18:38.534932 [debug] [MainThread]: 1603: static parser failed on transform/fct_invoices.sql
[0m22:18:38.552609 [debug] [MainThread]: 1602: parser fallback to jinja rendering on transform/fct_invoices.sql
[0m22:18:38.614464 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.retail.dim_customer' (models/transform/dim_customer.sql) depends on a source named 'retail.raw_invoices' which was not found
[0m22:18:38.617173 [debug] [MainThread]: Command `dbt run` failed at 22:18:38.616733 after 3.80 seconds
[0m22:18:38.618943 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3b064aff10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3b065423d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3b06077590>]}
[0m22:18:38.620376 [debug] [MainThread]: Flushing usage events
[0m22:23:00.031652 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb0b14662d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb0b1134dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb0b0ccb690>]}


============================== 22:23:00.041889 | 59bd8966-3f72-4d6f-a190-5c1e6c518cfd ==============================
[0m22:23:00.041889 [info ] [MainThread]: Running with dbt=1.5.9
[0m22:23:00.044956 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'log_format': 'default', 'log_cache_events': 'False', 'profiles_dir': '/usr/local/airflow/include/dbt/', 'no_print': 'None', 'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'cache_selected_only': 'False', 'fail_fast': 'False', 'log_path': '/usr/local/airflow/include/dbt/logs', 'printer_width': '80', 'partial_parse': 'True', 'version_check': 'True', 'static_parser': 'True', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'debug': 'False', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'target_path': 'None'}
[0m22:23:00.739379 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '59bd8966-3f72-4d6f-a190-5c1e6c518cfd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb0aef0b6d0>]}
[0m22:23:00.780132 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '59bd8966-3f72-4d6f-a190-5c1e6c518cfd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb0b130ea90>]}
[0m22:23:00.783847 [info ] [MainThread]: Registered adapter: bigquery=1.5.3
[0m22:23:00.844032 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m22:23:00.854001 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:23:00.857940 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '59bd8966-3f72-4d6f-a190-5c1e6c518cfd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb0aed6ac50>]}
[0m22:23:04.136317 [debug] [MainThread]: 1603: static parser failed on transform/dim_customer.sql
[0m22:23:04.179395 [debug] [MainThread]: 1602: parser fallback to jinja rendering on transform/dim_customer.sql
[0m22:23:04.183213 [debug] [MainThread]: 1699: static parser successfully parsed transform/dim_datetime.sql
[0m22:23:04.189446 [debug] [MainThread]: 1603: static parser failed on transform/dim_product.sql
[0m22:23:04.201320 [debug] [MainThread]: 1602: parser fallback to jinja rendering on transform/dim_product.sql
[0m22:23:04.205175 [debug] [MainThread]: 1603: static parser failed on transform/fct_invoices.sql
[0m22:23:04.220568 [debug] [MainThread]: 1602: parser fallback to jinja rendering on transform/fct_invoices.sql
[0m22:23:04.342814 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '59bd8966-3f72-4d6f-a190-5c1e6c518cfd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb0aee48090>]}
[0m22:23:04.375863 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '59bd8966-3f72-4d6f-a190-5c1e6c518cfd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb0aecb0950>]}
[0m22:23:04.377733 [info ] [MainThread]: Found 4 models, 0 tests, 0 snapshots, 0 analyses, 474 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics, 0 groups
[0m22:23:04.380049 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '59bd8966-3f72-4d6f-a190-5c1e6c518cfd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb0b41e3c10>]}
[0m22:23:04.384537 [info ] [MainThread]: 
[0m22:23:04.388168 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:23:04.394293 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sapient-cycling-413017'
[0m22:23:04.398317 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:23:05.419202 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017, now list_sapient-cycling-413017_retail)
[0m22:23:05.420940 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:23:06.364040 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '59bd8966-3f72-4d6f-a190-5c1e6c518cfd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb0aec59710>]}
[0m22:23:06.366724 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:23:06.369257 [info ] [MainThread]: 
[0m22:23:06.397713 [debug] [Thread-1 (]: Began running node model.retail.dim_customer
[0m22:23:06.400571 [info ] [Thread-1 (]: 1 of 4 START sql table model retail.dim_customer ............................... [RUN]
[0m22:23:06.408809 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017_retail, now model.retail.dim_customer)
[0m22:23:06.410643 [debug] [Thread-1 (]: Began compiling node model.retail.dim_customer
[0m22:23:06.434394 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_customer"
[0m22:23:06.464015 [debug] [Thread-1 (]: Timing info for model.retail.dim_customer (compile): 22:23:06.412609 => 22:23:06.463498
[0m22:23:06.465578 [debug] [Thread-1 (]: Began executing node model.retail.dim_customer
[0m22:23:06.532715 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_customer"
[0m22:23:06.551436 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:23:06.557347 [debug] [Thread-1 (]: On model.retail.dim_customer: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_customer"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_customer`
    
    

    OPTIONS()
    as (
      with customer_cte as (
    select distinct to_hex(md5(cast(coalesce(cast(CustomerID as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Country as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as customer_id,
        Country as country
    from `sapient-cycling-413017`.`retail`.`raw_invoices`
    where CustomerID is not null
)
select
    t.*,
from customer_cte t
left join `sapient-cycling-413017`.`retail`.`country` cm on t.country = cm.nicename
    );
  
[0m22:23:10.785287 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:19a4371d-04ac-4b23-825f-5b59d6fd0a5c&page=queryresults
[0m22:23:10.835081 [debug] [Thread-1 (]: Timing info for model.retail.dim_customer (execute): 22:23:06.466947 => 22:23:10.834300
[0m22:23:10.838423 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '59bd8966-3f72-4d6f-a190-5c1e6c518cfd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb0aed70390>]}
[0m22:23:10.841118 [info ] [Thread-1 (]: 1 of 4 OK created sql table model retail.dim_customer .......................... [[32mCREATE TABLE (4.4k rows, 11.1 MiB processed)[0m in 4.43s]
[0m22:23:10.846365 [debug] [Thread-1 (]: Finished running node model.retail.dim_customer
[0m22:23:10.852438 [debug] [Thread-1 (]: Began running node model.retail.dim_datetime
[0m22:23:10.856977 [info ] [Thread-1 (]: 2 of 4 START sql table model retail.dim_datetime ............................... [RUN]
[0m22:23:10.872546 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_customer, now model.retail.dim_datetime)
[0m22:23:10.884850 [debug] [Thread-1 (]: Began compiling node model.retail.dim_datetime
[0m22:23:10.900469 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_datetime"
[0m22:23:10.917156 [debug] [Thread-1 (]: Timing info for model.retail.dim_datetime (compile): 22:23:10.893197 => 22:23:10.916440
[0m22:23:10.919291 [debug] [Thread-1 (]: Began executing node model.retail.dim_datetime
[0m22:23:10.956509 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_datetime"
[0m22:23:10.977348 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:23:10.984973 [debug] [Thread-1 (]: On model.retail.dim_datetime: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_datetime"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_datetime`
    
    

    OPTIONS()
    as (
      with datetime_cte as (
    select distinct
        InvoiceDate as datetime_id,
        case
            when length(InvoiceDate) = 16 then
                PARSE_DATETOME('%m/%d/%Y %H:%M', InvoiceDate)
            when length(InvoiceDate) <= 14 then
                PARSE_DATETOME('$m/%d/%y %H:%M', InvoiceDate)
            else
                null
        end as date_part,
    from `sapient-cycling-413017`.`retail`.`raw_invoices`
    where InvoiceDate is not null
)
select
    datetime_id,
    date_part as datetime,
    Extract(YEAR FROM date_part) AS year,
    Extract(MONTH FROM date_part) AS month,
    Extract(DAY FROM date_part) AS day,
    Extract(HOUR FROM date_part) AS hour,
    Extract(MINUTE FROM date_part) AS minute,
    Extract(DAYOFWEEK FROM date_part) AS weekday
from datetime_cte
    );
  
[0m22:23:12.809554 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('No matching signature for function LENGTH for argument types: TIMESTAMP. Supported signatures: LENGTH(STRING); LENGTH(BYTES) at [16:18]; reason: invalidQuery, location: query, message: No matching signature for function LENGTH for argument types: TIMESTAMP. Supported signatures: LENGTH(STRING); LENGTH(BYTES) at [16:18]')
[0m22:23:14.789659 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:88be80d2-51bb-488a-87dc-e2d9b08e9f4d&page=queryresults
[0m22:23:14.793047 [debug] [Thread-1 (]: Timing info for model.retail.dim_datetime (execute): 22:23:10.922290 => 22:23:14.792353
[0m22:23:14.828340 [debug] [Thread-1 (]: Database Error in model dim_datetime (models/transform/dim_datetime.sql)
  No matching signature for function LENGTH for argument types: TIMESTAMP. Supported signatures: LENGTH(STRING); LENGTH(BYTES) at [16:18]
  compiled Code at target/run/retail/models/transform/dim_datetime.sql
[0m22:23:14.831026 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '59bd8966-3f72-4d6f-a190-5c1e6c518cfd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb0aed54c50>]}
[0m22:23:14.832981 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model retail.dim_datetime ...................... [[31mERROR[0m in 3.96s]
[0m22:23:14.835361 [debug] [Thread-1 (]: Finished running node model.retail.dim_datetime
[0m22:23:14.838063 [debug] [Thread-1 (]: Began running node model.retail.dim_product
[0m22:23:14.840457 [info ] [Thread-1 (]: 3 of 4 START sql table model retail.dim_product ................................ [RUN]
[0m22:23:14.843830 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_datetime, now model.retail.dim_product)
[0m22:23:14.846027 [debug] [Thread-1 (]: Began compiling node model.retail.dim_product
[0m22:23:14.871295 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_product"
[0m22:23:14.883021 [debug] [Thread-1 (]: Timing info for model.retail.dim_product (compile): 22:23:14.848079 => 22:23:14.882342
[0m22:23:14.885320 [debug] [Thread-1 (]: Began executing node model.retail.dim_product
[0m22:23:14.892695 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_product"
[0m22:23:14.902496 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:23:14.909811 [debug] [Thread-1 (]: On model.retail.dim_product: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_product"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_product`
    
    

    OPTIONS()
    as (
      -- StockCode isn't unique, a product with the same id can have different and prices
-- Create the dimension table

select distinct
    to_hex(md5(cast(coalesce(cast(StockCode as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Description as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(UnitPrice as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as product_id,
    StockCode as stock_code,
    Description as description,
    UnitPrice as price,
from `sapient-cycling-413017`.`retail`.`raw_invoices`
where StockCode is not null
and UnitPrice > 0
    );
  
[0m22:23:19.451264 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:4d0d7fdc-c232-46ac-9f80-17934c9853bb&page=queryresults
[0m22:23:19.455943 [debug] [Thread-1 (]: Timing info for model.retail.dim_product (execute): 22:23:14.887624 => 22:23:19.455526
[0m22:23:19.457950 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '59bd8966-3f72-4d6f-a190-5c1e6c518cfd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb0aeccd350>]}
[0m22:23:19.459923 [info ] [Thread-1 (]: 3 of 4 OK created sql table model retail.dim_product ........................... [[32mCREATE TABLE (16.3k rows, 22.6 MiB processed)[0m in 4.62s]
[0m22:23:19.462929 [debug] [Thread-1 (]: Finished running node model.retail.dim_product
[0m22:23:19.465657 [debug] [Thread-1 (]: Began running node model.retail.fct_invoices
[0m22:23:19.467572 [info ] [Thread-1 (]: 4 of 4 SKIP relation retail.fct_invoices ....................................... [[33mSKIP[0m]
[0m22:23:19.470905 [debug] [Thread-1 (]: Finished running node model.retail.fct_invoices
[0m22:23:19.476637 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:23:19.478368 [debug] [MainThread]: Connection 'model.retail.dim_product' was properly closed.
[0m22:23:19.480758 [info ] [MainThread]: 
[0m22:23:19.484087 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 15.09 seconds (15.09s).
[0m22:23:19.490796 [debug] [MainThread]: Command end result
[0m22:23:19.538490 [info ] [MainThread]: 
[0m22:23:19.545917 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m22:23:19.548536 [info ] [MainThread]: 
[0m22:23:19.551034 [error] [MainThread]: [33mDatabase Error in model dim_datetime (models/transform/dim_datetime.sql)[0m
[0m22:23:19.555660 [error] [MainThread]:   No matching signature for function LENGTH for argument types: TIMESTAMP. Supported signatures: LENGTH(STRING); LENGTH(BYTES) at [16:18]
[0m22:23:19.561887 [error] [MainThread]:   compiled Code at target/run/retail/models/transform/dim_datetime.sql
[0m22:23:19.565466 [info ] [MainThread]: 
[0m22:23:19.568401 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=1 TOTAL=4
[0m22:23:19.572374 [debug] [MainThread]: Command `dbt run` failed at 22:23:19.571998 after 19.58 seconds
[0m22:23:19.575008 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb0b1166b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb0b1165510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb0b1153910>]}
[0m22:23:19.583540 [debug] [MainThread]: Flushing usage events
[0m22:25:41.416154 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67c0891ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67c06e3d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67c04a6750>]}


============================== 22:25:41.422887 | 0cb85d66-8d9d-408b-ac9f-d5ddfa3ec4f3 ==============================
[0m22:25:41.422887 [info ] [MainThread]: Running with dbt=1.5.9
[0m22:25:41.425723 [debug] [MainThread]: running dbt with arguments {'log_path': '/usr/local/airflow/include/dbt/logs', 'version_check': 'True', 'quiet': 'False', 'cache_selected_only': 'False', 'debug': 'False', 'target_path': 'None', 'log_format': 'default', 'warn_error': 'None', 'log_cache_events': 'False', 'write_json': 'True', 'static_parser': 'True', 'fail_fast': 'False', 'partial_parse': 'True', 'introspect': 'True', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'use_experimental_parser': 'False', 'profiles_dir': '/usr/local/airflow/include/dbt/', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'printer_width': '80'}
[0m22:25:42.160897 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0cb85d66-8d9d-408b-ac9f-d5ddfa3ec4f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67be1d0890>]}
[0m22:25:42.191394 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0cb85d66-8d9d-408b-ac9f-d5ddfa3ec4f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67be1ece90>]}
[0m22:25:42.193410 [info ] [MainThread]: Registered adapter: bigquery=1.5.3
[0m22:25:42.241431 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m22:25:43.133456 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:25:43.134946 [debug] [MainThread]: Partial parsing: updated file: retail://models/transform/dim_datetime.sql
[0m22:25:43.174481 [debug] [MainThread]: 1699: static parser successfully parsed transform/dim_datetime.sql
[0m22:25:43.218365 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0cb85d66-8d9d-408b-ac9f-d5ddfa3ec4f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67be004250>]}
[0m22:25:43.243671 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0cb85d66-8d9d-408b-ac9f-d5ddfa3ec4f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67bdfbfe10>]}
[0m22:25:43.245757 [info ] [MainThread]: Found 4 models, 0 tests, 0 snapshots, 0 analyses, 474 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics, 0 groups
[0m22:25:43.248202 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0cb85d66-8d9d-408b-ac9f-d5ddfa3ec4f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67be23bbd0>]}
[0m22:25:43.252756 [info ] [MainThread]: 
[0m22:25:43.256065 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:25:43.260606 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sapient-cycling-413017'
[0m22:25:43.263361 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:25:44.203988 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017, now list_sapient-cycling-413017_retail)
[0m22:25:44.206072 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:25:45.156889 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0cb85d66-8d9d-408b-ac9f-d5ddfa3ec4f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67c1347ed0>]}
[0m22:25:45.159570 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:25:45.161897 [info ] [MainThread]: 
[0m22:25:45.188803 [debug] [Thread-1 (]: Began running node model.retail.dim_customer
[0m22:25:45.190698 [info ] [Thread-1 (]: 1 of 4 START sql table model retail.dim_customer ............................... [RUN]
[0m22:25:45.193232 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017_retail, now model.retail.dim_customer)
[0m22:25:45.195464 [debug] [Thread-1 (]: Began compiling node model.retail.dim_customer
[0m22:25:45.235528 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_customer"
[0m22:25:45.247586 [debug] [Thread-1 (]: Timing info for model.retail.dim_customer (compile): 22:25:45.197141 => 22:25:45.246787
[0m22:25:45.250172 [debug] [Thread-1 (]: Began executing node model.retail.dim_customer
[0m22:25:45.274946 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:25:46.256451 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_customer"
[0m22:25:46.267088 [debug] [Thread-1 (]: On model.retail.dim_customer: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_customer"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_customer`
    
    

    OPTIONS()
    as (
      with customer_cte as (
    select distinct to_hex(md5(cast(coalesce(cast(CustomerID as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Country as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as customer_id,
        Country as country
    from `sapient-cycling-413017`.`retail`.`raw_invoices`
    where CustomerID is not null
)
select
    t.*,
from customer_cte t
left join `sapient-cycling-413017`.`retail`.`country` cm on t.country = cm.nicename
    );
  
[0m22:25:49.639594 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:f16434d0-7543-40ba-8a59-ecbb827d2f71&page=queryresults
[0m22:25:49.743879 [debug] [Thread-1 (]: Timing info for model.retail.dim_customer (execute): 22:25:45.251623 => 22:25:49.743289
[0m22:25:49.747343 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0cb85d66-8d9d-408b-ac9f-d5ddfa3ec4f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67be2701d0>]}
[0m22:25:49.757353 [info ] [Thread-1 (]: 1 of 4 OK created sql table model retail.dim_customer .......................... [[32mCREATE TABLE (4.4k rows, 11.1 MiB processed)[0m in 4.55s]
[0m22:25:49.763320 [debug] [Thread-1 (]: Finished running node model.retail.dim_customer
[0m22:25:49.767226 [debug] [Thread-1 (]: Began running node model.retail.dim_datetime
[0m22:25:49.770113 [info ] [Thread-1 (]: 2 of 4 START sql table model retail.dim_datetime ............................... [RUN]
[0m22:25:49.774989 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_customer, now model.retail.dim_datetime)
[0m22:25:49.786878 [debug] [Thread-1 (]: Began compiling node model.retail.dim_datetime
[0m22:25:49.839342 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_datetime"
[0m22:25:49.864800 [debug] [Thread-1 (]: Timing info for model.retail.dim_datetime (compile): 22:25:49.788941 => 22:25:49.863993
[0m22:25:49.867125 [debug] [Thread-1 (]: Began executing node model.retail.dim_datetime
[0m22:25:49.876719 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_datetime"
[0m22:25:49.901314 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:25:49.921755 [debug] [Thread-1 (]: On model.retail.dim_datetime: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_datetime"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_datetime`
    
    

    OPTIONS()
    as (
      with datetime_cte as (
    select distinct
        InvoiceDate as datetime_id,
        case
            when length(InvoiceDate) = 16 then
                PARSE_DATETIME('%m/%d/%Y %H:%M', InvoiceDate)
            when length(InvoiceDate) <= 14 then
                PARSE_DATETIME('$m/%d/%y %H:%M', InvoiceDate)
            else
                null
        end as date_part,
    from `sapient-cycling-413017`.`retail`.`raw_invoices`
    where InvoiceDate is not null
)
select
    datetime_id,
    date_part as datetime,
    Extract(YEAR FROM date_part) AS year,
    Extract(MONTH FROM date_part) AS month,
    Extract(DAY FROM date_part) AS day,
    Extract(HOUR FROM date_part) AS hour,
    Extract(MINUTE FROM date_part) AS minute,
    Extract(DAYOFWEEK FROM date_part) AS weekday
from datetime_cte
    );
  
[0m22:25:51.969953 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('No matching signature for function LENGTH for argument types: TIMESTAMP. Supported signatures: LENGTH(STRING); LENGTH(BYTES) at [16:18]; reason: invalidQuery, location: query, message: No matching signature for function LENGTH for argument types: TIMESTAMP. Supported signatures: LENGTH(STRING); LENGTH(BYTES) at [16:18]')
[0m22:25:54.152428 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:53f249e6-9830-4c7b-9c48-0fd148b21038&page=queryresults
[0m22:25:54.155895 [debug] [Thread-1 (]: Timing info for model.retail.dim_datetime (execute): 22:25:49.869790 => 22:25:54.155115
[0m22:25:54.165818 [debug] [Thread-1 (]: Database Error in model dim_datetime (models/transform/dim_datetime.sql)
  No matching signature for function LENGTH for argument types: TIMESTAMP. Supported signatures: LENGTH(STRING); LENGTH(BYTES) at [16:18]
  compiled Code at target/run/retail/models/transform/dim_datetime.sql
[0m22:25:54.167733 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0cb85d66-8d9d-408b-ac9f-d5ddfa3ec4f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67be1d7ed0>]}
[0m22:25:54.169855 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model retail.dim_datetime ...................... [[31mERROR[0m in 4.39s]
[0m22:25:54.175027 [debug] [Thread-1 (]: Finished running node model.retail.dim_datetime
[0m22:25:54.176681 [debug] [Thread-1 (]: Began running node model.retail.dim_product
[0m22:25:54.179764 [info ] [Thread-1 (]: 3 of 4 START sql table model retail.dim_product ................................ [RUN]
[0m22:25:54.182998 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_datetime, now model.retail.dim_product)
[0m22:25:54.184876 [debug] [Thread-1 (]: Began compiling node model.retail.dim_product
[0m22:25:54.194351 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_product"
[0m22:25:54.207474 [debug] [Thread-1 (]: Timing info for model.retail.dim_product (compile): 22:25:54.186432 => 22:25:54.206851
[0m22:25:54.209413 [debug] [Thread-1 (]: Began executing node model.retail.dim_product
[0m22:25:54.217305 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:25:55.223858 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_product"
[0m22:25:55.237448 [debug] [Thread-1 (]: On model.retail.dim_product: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_product"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_product`
    
    

    OPTIONS()
    as (
      -- StockCode isn't unique, a product with the same id can have different and prices
-- Create the dimension table

select distinct
    to_hex(md5(cast(coalesce(cast(StockCode as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Description as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(UnitPrice as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as product_id,
    StockCode as stock_code,
    Description as description,
    UnitPrice as price,
from `sapient-cycling-413017`.`retail`.`raw_invoices`
where StockCode is not null
and UnitPrice > 0
    );
  
[0m22:26:09.508681 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:89857534-43b1-4620-a2a6-c2f53f9289fb&page=queryresults
[0m22:26:09.517089 [debug] [Thread-1 (]: Timing info for model.retail.dim_product (execute): 22:25:54.210951 => 22:26:09.516477
[0m22:26:09.519950 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0cb85d66-8d9d-408b-ac9f-d5ddfa3ec4f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67be1edf50>]}
[0m22:26:09.522120 [info ] [Thread-1 (]: 3 of 4 OK created sql table model retail.dim_product ........................... [[32mCREATE TABLE (16.3k rows, 22.6 MiB processed)[0m in 15.34s]
[0m22:26:09.527785 [debug] [Thread-1 (]: Finished running node model.retail.dim_product
[0m22:26:09.531082 [debug] [Thread-1 (]: Began running node model.retail.fct_invoices
[0m22:26:09.532985 [info ] [Thread-1 (]: 4 of 4 SKIP relation retail.fct_invoices ....................................... [[33mSKIP[0m]
[0m22:26:09.536199 [debug] [Thread-1 (]: Finished running node model.retail.fct_invoices
[0m22:26:09.548795 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:26:09.550547 [debug] [MainThread]: Connection 'model.retail.dim_product' was properly closed.
[0m22:26:09.552136 [info ] [MainThread]: 
[0m22:26:09.554513 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 26.30 seconds (26.30s).
[0m22:26:09.559732 [debug] [MainThread]: Command end result
[0m22:26:09.600710 [info ] [MainThread]: 
[0m22:26:09.604244 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m22:26:09.607119 [info ] [MainThread]: 
[0m22:26:09.609759 [error] [MainThread]: [33mDatabase Error in model dim_datetime (models/transform/dim_datetime.sql)[0m
[0m22:26:09.613245 [error] [MainThread]:   No matching signature for function LENGTH for argument types: TIMESTAMP. Supported signatures: LENGTH(STRING); LENGTH(BYTES) at [16:18]
[0m22:26:09.618313 [error] [MainThread]:   compiled Code at target/run/retail/models/transform/dim_datetime.sql
[0m22:26:09.621321 [info ] [MainThread]: 
[0m22:26:09.629619 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=1 TOTAL=4
[0m22:26:09.637209 [debug] [MainThread]: Command `dbt run` failed at 22:26:09.636714 after 28.24 seconds
[0m22:26:09.639682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67c0127410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67c013d710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67c08d7a10>]}
[0m22:26:09.641747 [debug] [MainThread]: Flushing usage events
[0m22:26:19.357217 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f408f4425d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f408f755390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f408f74bb90>]}


============================== 22:26:19.364021 | aef98f8e-6bc6-4af9-b6fb-0904d85bb9a9 ==============================
[0m22:26:19.364021 [info ] [MainThread]: Running with dbt=1.5.9
[0m22:26:19.366705 [debug] [MainThread]: running dbt with arguments {'fail_fast': 'False', 'log_path': '/usr/local/airflow/include/dbt/logs', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'write_json': 'True', 'use_colors': 'True', 'cache_selected_only': 'False', 'version_check': 'True', 'warn_error': 'None', 'indirect_selection': 'eager', 'debug': 'False', 'target_path': 'None', 'profiles_dir': '/usr/local/airflow/include/dbt/', 'use_experimental_parser': 'False', 'printer_width': '80', 'log_format': 'default', 'log_cache_events': 'False', 'quiet': 'False', 'no_print': 'None'}
[0m22:26:20.057426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'aef98f8e-6bc6-4af9-b6fb-0904d85bb9a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f408eea4950>]}
[0m22:26:20.087372 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'aef98f8e-6bc6-4af9-b6fb-0904d85bb9a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f408f58ca10>]}
[0m22:26:20.089512 [info ] [MainThread]: Registered adapter: bigquery=1.5.3
[0m22:26:20.138081 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m22:26:21.162127 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:26:21.163754 [debug] [MainThread]: Partial parsing: updated file: retail://models/transform/dim_datetime.sql
[0m22:26:21.204770 [debug] [MainThread]: 1699: static parser successfully parsed transform/dim_datetime.sql
[0m22:26:21.245279 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aef98f8e-6bc6-4af9-b6fb-0904d85bb9a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f408d04b190>]}
[0m22:26:21.269395 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'aef98f8e-6bc6-4af9-b6fb-0904d85bb9a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f408d0ff1d0>]}
[0m22:26:21.271089 [info ] [MainThread]: Found 4 models, 0 tests, 0 snapshots, 0 analyses, 474 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics, 0 groups
[0m22:26:21.273370 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aef98f8e-6bc6-4af9-b6fb-0904d85bb9a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f40924b7b90>]}
[0m22:26:21.279988 [info ] [MainThread]: 
[0m22:26:21.283759 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:26:21.287973 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sapient-cycling-413017'
[0m22:26:21.290615 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:26:22.212372 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017, now list_sapient-cycling-413017_retail)
[0m22:26:22.214466 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:26:23.180211 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aef98f8e-6bc6-4af9-b6fb-0904d85bb9a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f40901ec110>]}
[0m22:26:23.182681 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:26:23.185221 [info ] [MainThread]: 
[0m22:26:23.215485 [debug] [Thread-1 (]: Began running node model.retail.dim_customer
[0m22:26:23.217649 [info ] [Thread-1 (]: 1 of 4 START sql table model retail.dim_customer ............................... [RUN]
[0m22:26:23.220486 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017_retail, now model.retail.dim_customer)
[0m22:26:23.222017 [debug] [Thread-1 (]: Began compiling node model.retail.dim_customer
[0m22:26:23.262337 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_customer"
[0m22:26:23.273287 [debug] [Thread-1 (]: Timing info for model.retail.dim_customer (compile): 22:26:23.223244 => 22:26:23.272676
[0m22:26:23.275153 [debug] [Thread-1 (]: Began executing node model.retail.dim_customer
[0m22:26:23.301484 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:26:24.308745 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_customer"
[0m22:26:24.318595 [debug] [Thread-1 (]: On model.retail.dim_customer: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_customer"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_customer`
    
    

    OPTIONS()
    as (
      with customer_cte as (
    select distinct to_hex(md5(cast(coalesce(cast(CustomerID as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Country as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as customer_id,
        Country as country
    from `sapient-cycling-413017`.`retail`.`raw_invoices`
    where CustomerID is not null
)
select
    t.*,
from customer_cte t
left join `sapient-cycling-413017`.`retail`.`country` cm on t.country = cm.nicename
    );
  
[0m22:26:28.189284 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:07fff0ac-0124-4e1d-833e-e48b6f7c6c2d&page=queryresults
[0m22:26:28.219081 [debug] [Thread-1 (]: Timing info for model.retail.dim_customer (execute): 22:26:23.276592 => 22:26:28.218747
[0m22:26:28.221434 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aef98f8e-6bc6-4af9-b6fb-0904d85bb9a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f408d095d90>]}
[0m22:26:28.223554 [info ] [Thread-1 (]: 1 of 4 OK created sql table model retail.dim_customer .......................... [[32mCREATE TABLE (4.4k rows, 11.1 MiB processed)[0m in 5.00s]
[0m22:26:28.226570 [debug] [Thread-1 (]: Finished running node model.retail.dim_customer
[0m22:26:28.228513 [debug] [Thread-1 (]: Began running node model.retail.dim_datetime
[0m22:26:28.230279 [info ] [Thread-1 (]: 2 of 4 START sql table model retail.dim_datetime ............................... [RUN]
[0m22:26:28.232964 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_customer, now model.retail.dim_datetime)
[0m22:26:28.234953 [debug] [Thread-1 (]: Began compiling node model.retail.dim_datetime
[0m22:26:28.277532 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_datetime"
[0m22:26:28.305012 [debug] [Thread-1 (]: Timing info for model.retail.dim_datetime (compile): 22:26:28.236728 => 22:26:28.304229
[0m22:26:28.307053 [debug] [Thread-1 (]: Began executing node model.retail.dim_datetime
[0m22:26:28.324444 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_datetime"
[0m22:26:28.336337 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:26:28.344820 [debug] [Thread-1 (]: On model.retail.dim_datetime: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_datetime"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_datetime`
    
    

    OPTIONS()
    as (
      -- dim_datetime.sql

-- Create a CTE to extract date and time components
WITH datetime_cte AS (  
  SELECT DISTINCT
    InvoiceDate AS datetime_id,
    CASE
      WHEN LENGTH(InvoiceDate) = 16 THEN
        -- Date format: "DD/MM/YYYY HH:MM"
        PARSE_DATETIME('%m/%d/%Y %H:%M', InvoiceDate)
      WHEN LENGTH(InvoiceDate) <= 14 THEN
        -- Date format: "MM/DD/YY HH:MM"
        PARSE_DATETIME('%m/%d/%y %H:%M', InvoiceDate)
      ELSE
        NULL
    END AS date_part,
  FROM `sapient-cycling-413017`.`retail`.`raw_invoices`
  WHERE InvoiceDate IS NOT NULL
)
SELECT
  datetime_id,
  date_part as datetime,
  EXTRACT(YEAR FROM date_part) AS year,
  EXTRACT(MONTH FROM date_part) AS month,
  EXTRACT(DAY FROM date_part) AS day,
  EXTRACT(HOUR FROM date_part) AS hour,
  EXTRACT(MINUTE FROM date_part) AS minute,
  EXTRACT(DAYOFWEEK FROM date_part) AS weekday
FROM datetime_cte
    );
  
[0m22:26:30.089365 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('No matching signature for function LENGTH for argument types: TIMESTAMP. Supported signatures: LENGTH(STRING); LENGTH(BYTES) at [19:12]; reason: invalidQuery, location: query, message: No matching signature for function LENGTH for argument types: TIMESTAMP. Supported signatures: LENGTH(STRING); LENGTH(BYTES) at [19:12]')
[0m22:26:31.558997 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:ee44c241-58b6-4b53-a258-167e30e22ecc&page=queryresults
[0m22:26:31.562293 [debug] [Thread-1 (]: Timing info for model.retail.dim_datetime (execute): 22:26:28.308555 => 22:26:31.561507
[0m22:26:31.571778 [debug] [Thread-1 (]: Database Error in model dim_datetime (models/transform/dim_datetime.sql)
  No matching signature for function LENGTH for argument types: TIMESTAMP. Supported signatures: LENGTH(STRING); LENGTH(BYTES) at [19:12]
  compiled Code at target/run/retail/models/transform/dim_datetime.sql
[0m22:26:31.574097 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aef98f8e-6bc6-4af9-b6fb-0904d85bb9a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f408cf1fe90>]}
[0m22:26:31.577342 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model retail.dim_datetime ...................... [[31mERROR[0m in 3.34s]
[0m22:26:31.581558 [debug] [Thread-1 (]: Finished running node model.retail.dim_datetime
[0m22:26:31.583291 [debug] [Thread-1 (]: Began running node model.retail.dim_product
[0m22:26:31.585025 [info ] [Thread-1 (]: 3 of 4 START sql table model retail.dim_product ................................ [RUN]
[0m22:26:31.587837 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_datetime, now model.retail.dim_product)
[0m22:26:31.589658 [debug] [Thread-1 (]: Began compiling node model.retail.dim_product
[0m22:26:31.601433 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_product"
[0m22:26:31.613264 [debug] [Thread-1 (]: Timing info for model.retail.dim_product (compile): 22:26:31.591071 => 22:26:31.612157
[0m22:26:31.616181 [debug] [Thread-1 (]: Began executing node model.retail.dim_product
[0m22:26:31.622826 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:26:32.570567 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_product"
[0m22:26:32.580741 [debug] [Thread-1 (]: On model.retail.dim_product: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_product"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_product`
    
    

    OPTIONS()
    as (
      -- StockCode isn't unique, a product with the same id can have different and prices
-- Create the dimension table

select distinct
    to_hex(md5(cast(coalesce(cast(StockCode as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Description as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(UnitPrice as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as product_id,
    StockCode as stock_code,
    Description as description,
    UnitPrice as price,
from `sapient-cycling-413017`.`retail`.`raw_invoices`
where StockCode is not null
and UnitPrice > 0
    );
  
[0m22:26:36.424723 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:6aeaf56a-dfd8-4384-8dec-4e20397cbcff&page=queryresults
[0m22:26:36.433122 [debug] [Thread-1 (]: Timing info for model.retail.dim_product (execute): 22:26:31.617716 => 22:26:36.432670
[0m22:26:36.435408 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aef98f8e-6bc6-4af9-b6fb-0904d85bb9a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f408c64d3d0>]}
[0m22:26:36.437265 [info ] [Thread-1 (]: 3 of 4 OK created sql table model retail.dim_product ........................... [[32mCREATE TABLE (16.3k rows, 22.6 MiB processed)[0m in 4.85s]
[0m22:26:36.440991 [debug] [Thread-1 (]: Finished running node model.retail.dim_product
[0m22:26:36.446975 [debug] [Thread-1 (]: Began running node model.retail.fct_invoices
[0m22:26:36.449599 [info ] [Thread-1 (]: 4 of 4 SKIP relation retail.fct_invoices ....................................... [[33mSKIP[0m]
[0m22:26:36.452725 [debug] [Thread-1 (]: Finished running node model.retail.fct_invoices
[0m22:26:36.460536 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:26:36.463746 [debug] [MainThread]: Connection 'model.retail.dim_product' was properly closed.
[0m22:26:36.465768 [info ] [MainThread]: 
[0m22:26:36.468783 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 15.18 seconds (15.18s).
[0m22:26:36.473097 [debug] [MainThread]: Command end result
[0m22:26:36.502417 [info ] [MainThread]: 
[0m22:26:36.504614 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m22:26:36.507250 [info ] [MainThread]: 
[0m22:26:36.511374 [error] [MainThread]: [33mDatabase Error in model dim_datetime (models/transform/dim_datetime.sql)[0m
[0m22:26:36.517268 [error] [MainThread]:   No matching signature for function LENGTH for argument types: TIMESTAMP. Supported signatures: LENGTH(STRING); LENGTH(BYTES) at [19:12]
[0m22:26:36.522245 [error] [MainThread]:   compiled Code at target/run/retail/models/transform/dim_datetime.sql
[0m22:26:36.530114 [info ] [MainThread]: 
[0m22:26:36.534134 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=1 TOTAL=4
[0m22:26:36.537488 [debug] [MainThread]: Command `dbt run` failed at 22:26:36.537245 after 17.20 seconds
[0m22:26:36.538847 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f408f770090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f40932cf450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f408f45d410>]}
[0m22:26:36.540092 [debug] [MainThread]: Flushing usage events
[0m22:27:50.058083 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1bf24f0990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1bf27d6c90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1bf2684c50>]}


============================== 22:27:50.076061 | 926e8840-cf7a-4d06-8c78-510f86b1141b ==============================
[0m22:27:50.076061 [info ] [MainThread]: Running with dbt=1.5.9
[0m22:27:50.080292 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'warn_error': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'introspect': 'True', 'printer_width': '80', 'target_path': 'None', 'log_cache_events': 'False', 'use_colors': 'True', 'no_print': 'None', 'debug': 'False', 'write_json': 'True', 'log_path': '/usr/local/airflow/include/dbt/logs', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'cache_selected_only': 'False', 'fail_fast': 'False', 'partial_parse': 'True', 'use_experimental_parser': 'False', 'version_check': 'True', 'profiles_dir': '/usr/local/airflow/include/dbt/', 'indirect_selection': 'eager'}
[0m22:27:51.347966 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '926e8840-cf7a-4d06-8c78-510f86b1141b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1bf00ec850>]}
[0m22:27:51.383040 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '926e8840-cf7a-4d06-8c78-510f86b1141b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1bf236cb10>]}
[0m22:27:51.385645 [info ] [MainThread]: Registered adapter: bigquery=1.5.3
[0m22:27:51.457901 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m22:27:53.484771 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:27:53.487282 [debug] [MainThread]: Partial parsing: updated file: retail://models/transform/dim_datetime.sql
[0m22:27:53.554987 [debug] [MainThread]: 1699: static parser successfully parsed transform/dim_datetime.sql
[0m22:27:53.616602 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '926e8840-cf7a-4d06-8c78-510f86b1141b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1bf012cc50>]}
[0m22:27:53.646706 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '926e8840-cf7a-4d06-8c78-510f86b1141b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1befffd510>]}
[0m22:27:53.648737 [info ] [MainThread]: Found 4 models, 0 tests, 0 snapshots, 0 analyses, 474 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics, 0 groups
[0m22:27:53.651376 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '926e8840-cf7a-4d06-8c78-510f86b1141b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1bf24f0090>]}
[0m22:27:53.658410 [info ] [MainThread]: 
[0m22:27:53.668768 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:27:53.674972 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sapient-cycling-413017'
[0m22:27:53.679087 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:27:54.683321 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017, now list_sapient-cycling-413017_retail)
[0m22:27:54.686638 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:27:55.726059 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '926e8840-cf7a-4d06-8c78-510f86b1141b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1bf3280850>]}
[0m22:27:55.729338 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:27:55.732167 [info ] [MainThread]: 
[0m22:27:55.765277 [debug] [Thread-1 (]: Began running node model.retail.dim_customer
[0m22:27:55.767180 [info ] [Thread-1 (]: 1 of 4 START sql table model retail.dim_customer ............................... [RUN]
[0m22:27:55.769846 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017_retail, now model.retail.dim_customer)
[0m22:27:55.771606 [debug] [Thread-1 (]: Began compiling node model.retail.dim_customer
[0m22:27:55.829420 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_customer"
[0m22:27:55.839928 [debug] [Thread-1 (]: Timing info for model.retail.dim_customer (compile): 22:27:55.777114 => 22:27:55.839005
[0m22:27:55.842861 [debug] [Thread-1 (]: Began executing node model.retail.dim_customer
[0m22:27:55.871657 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:27:56.898840 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_customer"
[0m22:27:56.912242 [debug] [Thread-1 (]: On model.retail.dim_customer: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_customer"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_customer`
    
    

    OPTIONS()
    as (
      with customer_cte as (
    select distinct to_hex(md5(cast(coalesce(cast(CustomerID as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Country as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as customer_id,
        Country as country
    from `sapient-cycling-413017`.`retail`.`raw_invoices`
    where CustomerID is not null
)
select
    t.*,
from customer_cte t
left join `sapient-cycling-413017`.`retail`.`country` cm on t.country = cm.nicename
    );
  
[0m22:28:00.592215 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:2d5238f2-4501-4170-acaa-7e19480bc38f&page=queryresults
[0m22:28:00.648541 [debug] [Thread-1 (]: Timing info for model.retail.dim_customer (execute): 22:27:55.844509 => 22:28:00.648168
[0m22:28:00.650406 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '926e8840-cf7a-4d06-8c78-510f86b1141b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1bf01d8ad0>]}
[0m22:28:00.652321 [info ] [Thread-1 (]: 1 of 4 OK created sql table model retail.dim_customer .......................... [[32mCREATE TABLE (4.4k rows, 11.1 MiB processed)[0m in 4.88s]
[0m22:28:00.660937 [debug] [Thread-1 (]: Finished running node model.retail.dim_customer
[0m22:28:00.663512 [debug] [Thread-1 (]: Began running node model.retail.dim_datetime
[0m22:28:00.665795 [info ] [Thread-1 (]: 2 of 4 START sql table model retail.dim_datetime ............................... [RUN]
[0m22:28:00.676793 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_customer, now model.retail.dim_datetime)
[0m22:28:00.680990 [debug] [Thread-1 (]: Began compiling node model.retail.dim_datetime
[0m22:28:00.718416 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_datetime"
[0m22:28:00.737435 [debug] [Thread-1 (]: Timing info for model.retail.dim_datetime (compile): 22:28:00.682534 => 22:28:00.736754
[0m22:28:00.742181 [debug] [Thread-1 (]: Began executing node model.retail.dim_datetime
[0m22:28:00.754998 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_datetime"
[0m22:28:00.777301 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:28:00.787366 [debug] [Thread-1 (]: On model.retail.dim_datetime: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_datetime"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_datetime`
    
    

    OPTIONS()
    as (
      -- dim_datetime.sql

-- Create a CTE to extract date and time components
WITH datetime_cte AS (  
  SELECT DISTINCT
    InvoiceDate AS datetime_id,
    CASE
      WHEN LENGTH(InvoiceDate) = 16 THEN
        -- Date format: "DD/MM/YYYY HH:MM"
        PARSE_DATETIME('%d/%m/%Y %H:%M', InvoiceDate)
      WHEN LENGTH(InvoiceDate) <= 14 THEN
        -- Date format: "MM/DD/YY HH:MM"
        PARSE_DATETIME('%m/%d/%y %H:%M', InvoiceDate)
      ELSE
        NULL
    END AS date_part
  FROM `sapient-cycling-413017`.`retail`.`raw_invoices`
  WHERE InvoiceDate IS NOT NULL
)
SELECT
  datetime_id,
  date_part AS datetime,
  FORMAT_DATETIME('%Y', date_part) AS year,
  FORMAT_DATETIME('%m', date_part) AS month,
  FORMAT_DATETIME('%d', date_part) AS day,
  FORMAT_DATETIME('%H', date_part) AS hour,
  FORMAT_DATETIME('%M', date_part) AS minute,
  FORMAT_DATETIME('%A', date_part) AS weekday
FROM datetime_cte;
    );
  
[0m22:28:01.801084 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected ")" but got ";" at [40:18]; reason: invalidQuery, location: query, message: Syntax error: Expected ")" but got ";" at [40:18]')
[0m22:28:02.863362 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:214d21da-e501-4efc-958a-e989d194391d&page=queryresults
[0m22:28:02.867500 [debug] [Thread-1 (]: Timing info for model.retail.dim_datetime (execute): 22:28:00.745132 => 22:28:02.866535
[0m22:28:02.880373 [debug] [Thread-1 (]: Database Error in model dim_datetime (models/transform/dim_datetime.sql)
  Syntax error: Expected ")" but got ";" at [40:18]
  compiled Code at target/run/retail/models/transform/dim_datetime.sql
[0m22:28:02.882205 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '926e8840-cf7a-4d06-8c78-510f86b1141b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1bf012d590>]}
[0m22:28:02.885209 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model retail.dim_datetime ...................... [[31mERROR[0m in 2.21s]
[0m22:28:02.893712 [debug] [Thread-1 (]: Finished running node model.retail.dim_datetime
[0m22:28:02.896940 [debug] [Thread-1 (]: Began running node model.retail.dim_product
[0m22:28:02.899761 [info ] [Thread-1 (]: 3 of 4 START sql table model retail.dim_product ................................ [RUN]
[0m22:28:02.903663 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_datetime, now model.retail.dim_product)
[0m22:28:02.905829 [debug] [Thread-1 (]: Began compiling node model.retail.dim_product
[0m22:28:02.918872 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_product"
[0m22:28:02.933254 [debug] [Thread-1 (]: Timing info for model.retail.dim_product (compile): 22:28:02.907660 => 22:28:02.932569
[0m22:28:02.935342 [debug] [Thread-1 (]: Began executing node model.retail.dim_product
[0m22:28:02.942157 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:28:03.960208 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_product"
[0m22:28:03.972368 [debug] [Thread-1 (]: On model.retail.dim_product: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_product"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_product`
    
    

    OPTIONS()
    as (
      -- StockCode isn't unique, a product with the same id can have different and prices
-- Create the dimension table

select distinct
    to_hex(md5(cast(coalesce(cast(StockCode as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Description as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(UnitPrice as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as product_id,
    StockCode as stock_code,
    Description as description,
    UnitPrice as price,
from `sapient-cycling-413017`.`retail`.`raw_invoices`
where StockCode is not null
and UnitPrice > 0
    );
  
[0m22:28:07.876032 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:bcafc91b-2e99-4be3-a0f0-09bcab7e0b4a&page=queryresults
[0m22:28:07.881140 [debug] [Thread-1 (]: Timing info for model.retail.dim_product (execute): 22:28:02.936771 => 22:28:07.880648
[0m22:28:07.884546 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '926e8840-cf7a-4d06-8c78-510f86b1141b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1bf00ed510>]}
[0m22:28:07.887119 [info ] [Thread-1 (]: 3 of 4 OK created sql table model retail.dim_product ........................... [[32mCREATE TABLE (16.3k rows, 22.6 MiB processed)[0m in 4.98s]
[0m22:28:07.892030 [debug] [Thread-1 (]: Finished running node model.retail.dim_product
[0m22:28:07.896428 [debug] [Thread-1 (]: Began running node model.retail.fct_invoices
[0m22:28:07.898620 [info ] [Thread-1 (]: 4 of 4 SKIP relation retail.fct_invoices ....................................... [[33mSKIP[0m]
[0m22:28:07.901061 [debug] [Thread-1 (]: Finished running node model.retail.fct_invoices
[0m22:28:07.906719 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:28:07.909928 [debug] [MainThread]: Connection 'model.retail.dim_product' was properly closed.
[0m22:28:07.911743 [info ] [MainThread]: 
[0m22:28:07.914666 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 14.24 seconds (14.24s).
[0m22:28:07.920963 [debug] [MainThread]: Command end result
[0m22:28:07.953818 [info ] [MainThread]: 
[0m22:28:07.959648 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m22:28:07.964211 [info ] [MainThread]: 
[0m22:28:07.970275 [error] [MainThread]: [33mDatabase Error in model dim_datetime (models/transform/dim_datetime.sql)[0m
[0m22:28:07.976210 [error] [MainThread]:   Syntax error: Expected ")" but got ";" at [40:18]
[0m22:28:07.979861 [error] [MainThread]:   compiled Code at target/run/retail/models/transform/dim_datetime.sql
[0m22:28:07.984959 [info ] [MainThread]: 
[0m22:28:07.987860 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=1 TOTAL=4
[0m22:28:07.994779 [debug] [MainThread]: Command `dbt run` failed at 22:28:07.994336 after 17.96 seconds
[0m22:28:07.997294 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1bf2808c90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1bf2607b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1bf29a8890>]}
[0m22:28:07.999351 [debug] [MainThread]: Flushing usage events
[0m22:29:51.471689 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9dcf6b5bd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9dcef635d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9dcf57be10>]}


============================== 22:29:51.483858 | e2d15e1d-6e81-441b-a9cc-d5b584d32dc7 ==============================
[0m22:29:51.483858 [info ] [MainThread]: Running with dbt=1.5.9
[0m22:29:51.489297 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'target_path': 'None', 'fail_fast': 'False', 'version_check': 'True', 'warn_error': 'None', 'use_experimental_parser': 'False', 'introspect': 'True', 'debug': 'False', 'profiles_dir': '/usr/local/airflow/include/dbt/', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'printer_width': '80', 'log_cache_events': 'False', 'log_path': '/usr/local/airflow/include/dbt/logs', 'log_format': 'default'}
[0m22:29:52.239336 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e2d15e1d-6e81-441b-a9cc-d5b584d32dc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9dccff0cd0>]}
[0m22:29:52.310041 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e2d15e1d-6e81-441b-a9cc-d5b584d32dc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9dcef64790>]}
[0m22:29:52.312090 [info ] [MainThread]: Registered adapter: bigquery=1.5.3
[0m22:29:52.377325 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m22:29:53.269527 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:29:53.271724 [debug] [MainThread]: Partial parsing: updated file: retail://models/transform/dim_datetime.sql
[0m22:29:53.312637 [debug] [MainThread]: 1699: static parser successfully parsed transform/dim_datetime.sql
[0m22:29:53.361715 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e2d15e1d-6e81-441b-a9cc-d5b584d32dc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9dccfef510>]}
[0m22:29:53.388427 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e2d15e1d-6e81-441b-a9cc-d5b584d32dc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9dccf20cd0>]}
[0m22:29:53.390148 [info ] [MainThread]: Found 4 models, 0 tests, 0 snapshots, 0 analyses, 474 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics, 0 groups
[0m22:29:53.392448 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e2d15e1d-6e81-441b-a9cc-d5b584d32dc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9dcd009850>]}
[0m22:29:53.397166 [info ] [MainThread]: 
[0m22:29:53.401094 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:29:53.407267 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sapient-cycling-413017'
[0m22:29:53.414975 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:29:54.302256 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017, now list_sapient-cycling-413017_retail)
[0m22:29:54.303780 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:29:55.309667 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e2d15e1d-6e81-441b-a9cc-d5b584d32dc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9dd0184150>]}
[0m22:29:55.312176 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:29:55.314602 [info ] [MainThread]: 
[0m22:29:55.343115 [debug] [Thread-1 (]: Began running node model.retail.dim_customer
[0m22:29:55.344966 [info ] [Thread-1 (]: 1 of 4 START sql table model retail.dim_customer ............................... [RUN]
[0m22:29:55.349301 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017_retail, now model.retail.dim_customer)
[0m22:29:55.356699 [debug] [Thread-1 (]: Began compiling node model.retail.dim_customer
[0m22:29:55.393591 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_customer"
[0m22:29:55.403830 [debug] [Thread-1 (]: Timing info for model.retail.dim_customer (compile): 22:29:55.358449 => 22:29:55.403295
[0m22:29:55.405679 [debug] [Thread-1 (]: Began executing node model.retail.dim_customer
[0m22:29:55.430813 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:29:56.502188 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_customer"
[0m22:29:56.509844 [debug] [Thread-1 (]: On model.retail.dim_customer: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_customer"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_customer`
    
    

    OPTIONS()
    as (
      with customer_cte as (
    select distinct to_hex(md5(cast(coalesce(cast(CustomerID as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Country as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as customer_id,
        Country as country
    from `sapient-cycling-413017`.`retail`.`raw_invoices`
    where CustomerID is not null
)
select
    t.*,
from customer_cte t
left join `sapient-cycling-413017`.`retail`.`country` cm on t.country = cm.nicename
    );
  
[0m22:29:59.906887 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:68d3b484-bb52-4fa9-bc21-c92830bd3b05&page=queryresults
[0m22:29:59.954677 [debug] [Thread-1 (]: Timing info for model.retail.dim_customer (execute): 22:29:55.407176 => 22:29:59.953929
[0m22:29:59.957363 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e2d15e1d-6e81-441b-a9cc-d5b584d32dc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9dcf3f8c10>]}
[0m22:29:59.959674 [info ] [Thread-1 (]: 1 of 4 OK created sql table model retail.dim_customer .......................... [[32mCREATE TABLE (4.4k rows, 11.1 MiB processed)[0m in 4.61s]
[0m22:29:59.966456 [debug] [Thread-1 (]: Finished running node model.retail.dim_customer
[0m22:29:59.968943 [debug] [Thread-1 (]: Began running node model.retail.dim_datetime
[0m22:29:59.970940 [info ] [Thread-1 (]: 2 of 4 START sql table model retail.dim_datetime ............................... [RUN]
[0m22:29:59.974136 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_customer, now model.retail.dim_datetime)
[0m22:29:59.978794 [debug] [Thread-1 (]: Began compiling node model.retail.dim_datetime
[0m22:30:00.027112 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_datetime"
[0m22:30:00.059674 [debug] [Thread-1 (]: Timing info for model.retail.dim_datetime (compile): 22:29:59.985505 => 22:30:00.059036
[0m22:30:00.061687 [debug] [Thread-1 (]: Began executing node model.retail.dim_datetime
[0m22:30:00.081680 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_datetime"
[0m22:30:00.091665 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:30:00.097958 [debug] [Thread-1 (]: On model.retail.dim_datetime: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_datetime"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_datetime`
    
    

    OPTIONS()
    as (
      -- dim_datetime.sql

-- Create a CTE to extract date and time components
WITH datetime_cte AS (  
  SELECT DISTINCT
    InvoiceDate AS datetime_id,
    CASE
      WHEN LENGTH(InvoiceDate) = 16 THEN
        -- Date format: "DD/MM/YYYY HH:MM"
        PARSE_DATETIME('%m/%d/%Y %H:%M', InvoiceDate)
      WHEN LENGTH(InvoiceDate) <= 14 THEN
        -- Date format: "MM/DD/YY HH:MM"
        PARSE_DATETIME('%m/%d/%y %H:%M', InvoiceDate)
      ELSE
        NULL
    END AS date_part,
  FROM `sapient-cycling-413017`.`retail`.`raw_invoices`
  WHERE InvoiceDate IS NOT NULL
)
SELECT
  datetime_id,
  date_part as datetime,
  EXTRACT(YEAR FROM date_part) AS year,
  EXTRACT(MONTH FROM date_part) AS month,
  EXTRACT(DAY FROM date_part) AS day,
  EXTRACT(HOUR FROM date_part) AS hour,
  EXTRACT(MINUTE FROM date_part) AS minute,
  EXTRACT(DAYOFWEEK FROM date_part) AS weekday
FROM datetime_cte
    );
  
[0m22:30:01.959629 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('No matching signature for function LENGTH for argument types: TIMESTAMP. Supported signatures: LENGTH(STRING); LENGTH(BYTES) at [19:12]; reason: invalidQuery, location: query, message: No matching signature for function LENGTH for argument types: TIMESTAMP. Supported signatures: LENGTH(STRING); LENGTH(BYTES) at [19:12]')
[0m22:30:04.104995 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:94dfb85e-eb3b-4be3-be68-55566081ebe6&page=queryresults
[0m22:30:04.109077 [debug] [Thread-1 (]: Timing info for model.retail.dim_datetime (execute): 22:30:00.063852 => 22:30:04.108039
[0m22:30:04.121148 [debug] [Thread-1 (]: Database Error in model dim_datetime (models/transform/dim_datetime.sql)
  No matching signature for function LENGTH for argument types: TIMESTAMP. Supported signatures: LENGTH(STRING); LENGTH(BYTES) at [19:12]
  compiled Code at target/run/retail/models/transform/dim_datetime.sql
[0m22:30:04.123264 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e2d15e1d-6e81-441b-a9cc-d5b584d32dc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9dccfafcd0>]}
[0m22:30:04.125485 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model retail.dim_datetime ...................... [[31mERROR[0m in 4.15s]
[0m22:30:04.129264 [debug] [Thread-1 (]: Finished running node model.retail.dim_datetime
[0m22:30:04.131962 [debug] [Thread-1 (]: Began running node model.retail.dim_product
[0m22:30:04.134897 [info ] [Thread-1 (]: 3 of 4 START sql table model retail.dim_product ................................ [RUN]
[0m22:30:04.138452 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_datetime, now model.retail.dim_product)
[0m22:30:04.141234 [debug] [Thread-1 (]: Began compiling node model.retail.dim_product
[0m22:30:04.152457 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_product"
[0m22:30:04.162846 [debug] [Thread-1 (]: Timing info for model.retail.dim_product (compile): 22:30:04.142713 => 22:30:04.162247
[0m22:30:04.164266 [debug] [Thread-1 (]: Began executing node model.retail.dim_product
[0m22:30:04.170473 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:30:05.126955 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_product"
[0m22:30:05.144120 [debug] [Thread-1 (]: On model.retail.dim_product: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_product"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_product`
    
    

    OPTIONS()
    as (
      -- StockCode isn't unique, a product with the same id can have different and prices
-- Create the dimension table

select distinct
    to_hex(md5(cast(coalesce(cast(StockCode as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Description as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(UnitPrice as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as product_id,
    StockCode as stock_code,
    Description as description,
    UnitPrice as price,
from `sapient-cycling-413017`.`retail`.`raw_invoices`
where StockCode is not null
and UnitPrice > 0
    );
  
[0m22:30:09.391757 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:9741193a-6177-4a1a-aa25-4686499e0241&page=queryresults
[0m22:30:09.399033 [debug] [Thread-1 (]: Timing info for model.retail.dim_product (execute): 22:30:04.165769 => 22:30:09.396569
[0m22:30:09.402711 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e2d15e1d-6e81-441b-a9cc-d5b584d32dc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9dcd0cd990>]}
[0m22:30:09.405603 [info ] [Thread-1 (]: 3 of 4 OK created sql table model retail.dim_product ........................... [[32mCREATE TABLE (16.3k rows, 22.6 MiB processed)[0m in 5.26s]
[0m22:30:09.409135 [debug] [Thread-1 (]: Finished running node model.retail.dim_product
[0m22:30:09.412039 [debug] [Thread-1 (]: Began running node model.retail.fct_invoices
[0m22:30:09.413690 [info ] [Thread-1 (]: 4 of 4 SKIP relation retail.fct_invoices ....................................... [[33mSKIP[0m]
[0m22:30:09.420254 [debug] [Thread-1 (]: Finished running node model.retail.fct_invoices
[0m22:30:09.428100 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:30:09.429794 [debug] [MainThread]: Connection 'model.retail.dim_product' was properly closed.
[0m22:30:09.431372 [info ] [MainThread]: 
[0m22:30:09.434607 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 16.03 seconds (16.03s).
[0m22:30:09.443058 [debug] [MainThread]: Command end result
[0m22:30:09.474649 [info ] [MainThread]: 
[0m22:30:09.476729 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m22:30:09.479067 [info ] [MainThread]: 
[0m22:30:09.481865 [error] [MainThread]: [33mDatabase Error in model dim_datetime (models/transform/dim_datetime.sql)[0m
[0m22:30:09.490209 [error] [MainThread]:   No matching signature for function LENGTH for argument types: TIMESTAMP. Supported signatures: LENGTH(STRING); LENGTH(BYTES) at [19:12]
[0m22:30:09.492775 [error] [MainThread]:   compiled Code at target/run/retail/models/transform/dim_datetime.sql
[0m22:30:09.495186 [info ] [MainThread]: 
[0m22:30:09.501095 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=1 TOTAL=4
[0m22:30:09.507678 [debug] [MainThread]: Command `dbt run` failed at 22:30:09.506864 after 18.06 seconds
[0m22:30:09.509504 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9dcf2701d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9dcf70e950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9dcf6d6c10>]}
[0m22:30:09.511023 [debug] [MainThread]: Flushing usage events
[0m22:30:57.607091 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7e892fbed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7e8943d6d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7e89871010>]}


============================== 22:30:57.620455 | 4a784811-e03a-4399-af0b-f8038993229f ==============================
[0m22:30:57.620455 [info ] [MainThread]: Running with dbt=1.5.9
[0m22:30:57.625768 [debug] [MainThread]: running dbt with arguments {'log_cache_events': 'False', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'log_format': 'default', 'no_print': 'None', 'profiles_dir': '/usr/local/airflow/include/dbt/', 'warn_error': 'None', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'log_path': '/usr/local/airflow/include/dbt/logs', 'use_experimental_parser': 'False', 'printer_width': '80', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'write_json': 'True', 'version_check': 'True', 'debug': 'False', 'partial_parse': 'True', 'use_colors': 'True', 'static_parser': 'True', 'fail_fast': 'False'}
[0m22:30:58.894975 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4a784811-e03a-4399-af0b-f8038993229f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7e87144e50>]}
[0m22:30:58.954034 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4a784811-e03a-4399-af0b-f8038993229f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7e87317990>]}
[0m22:30:58.957374 [info ] [MainThread]: Registered adapter: bigquery=1.5.3
[0m22:30:59.057717 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m22:31:01.218128 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:31:01.221089 [debug] [MainThread]: Partial parsing: updated file: retail://models/transform/dim_datetime.sql
[0m22:31:01.316357 [debug] [MainThread]: 1699: static parser successfully parsed transform/dim_datetime.sql
[0m22:31:01.423082 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4a784811-e03a-4399-af0b-f8038993229f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7e8715cad0>]}
[0m22:31:01.478579 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4a784811-e03a-4399-af0b-f8038993229f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7e87039090>]}
[0m22:31:01.481467 [info ] [MainThread]: Found 4 models, 0 tests, 0 snapshots, 0 analyses, 474 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics, 0 groups
[0m22:31:01.485818 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4a784811-e03a-4399-af0b-f8038993229f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7e8c5cbb90>]}
[0m22:31:01.503304 [info ] [MainThread]: 
[0m22:31:01.511270 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:31:01.523075 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sapient-cycling-413017'
[0m22:31:01.526441 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:31:02.638186 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017, now list_sapient-cycling-413017_retail)
[0m22:31:02.641936 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:31:03.741837 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4a784811-e03a-4399-af0b-f8038993229f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7e8a3001d0>]}
[0m22:31:03.748341 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:31:03.754556 [info ] [MainThread]: 
[0m22:31:03.848673 [debug] [Thread-1 (]: Began running node model.retail.dim_customer
[0m22:31:03.854192 [info ] [Thread-1 (]: 1 of 4 START sql table model retail.dim_customer ............................... [RUN]
[0m22:31:03.862101 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017_retail, now model.retail.dim_customer)
[0m22:31:03.867095 [debug] [Thread-1 (]: Began compiling node model.retail.dim_customer
[0m22:31:03.950651 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_customer"
[0m22:31:03.961748 [debug] [Thread-1 (]: Timing info for model.retail.dim_customer (compile): 22:31:03.869506 => 22:31:03.960867
[0m22:31:03.963929 [debug] [Thread-1 (]: Began executing node model.retail.dim_customer
[0m22:31:04.012792 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:31:05.328868 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_customer"
[0m22:31:05.344348 [debug] [Thread-1 (]: On model.retail.dim_customer: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_customer"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_customer`
    
    

    OPTIONS()
    as (
      with customer_cte as (
    select distinct to_hex(md5(cast(coalesce(cast(CustomerID as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Country as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as customer_id,
        Country as country
    from `sapient-cycling-413017`.`retail`.`raw_invoices`
    where CustomerID is not null
)
select
    t.*,
from customer_cte t
left join `sapient-cycling-413017`.`retail`.`country` cm on t.country = cm.nicename
    );
  
[0m22:31:08.860183 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:4f9e9cbd-6a42-4500-85e7-93b00e072d1a&page=queryresults
[0m22:31:08.946405 [debug] [Thread-1 (]: Timing info for model.retail.dim_customer (execute): 22:31:03.965501 => 22:31:08.945651
[0m22:31:08.950245 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4a784811-e03a-4399-af0b-f8038993229f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7e89432d10>]}
[0m22:31:08.953366 [info ] [Thread-1 (]: 1 of 4 OK created sql table model retail.dim_customer .......................... [[32mCREATE TABLE (4.4k rows, 11.1 MiB processed)[0m in 5.09s]
[0m22:31:08.958366 [debug] [Thread-1 (]: Finished running node model.retail.dim_customer
[0m22:31:08.961258 [debug] [Thread-1 (]: Began running node model.retail.dim_datetime
[0m22:31:08.963959 [info ] [Thread-1 (]: 2 of 4 START sql table model retail.dim_datetime ............................... [RUN]
[0m22:31:08.968324 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_customer, now model.retail.dim_datetime)
[0m22:31:08.971667 [debug] [Thread-1 (]: Began compiling node model.retail.dim_datetime
[0m22:31:09.010620 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_datetime"
[0m22:31:09.027589 [debug] [Thread-1 (]: Timing info for model.retail.dim_datetime (compile): 22:31:08.974086 => 22:31:09.026572
[0m22:31:09.032030 [debug] [Thread-1 (]: Began executing node model.retail.dim_datetime
[0m22:31:09.040860 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_datetime"
[0m22:31:09.057175 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:31:09.068759 [debug] [Thread-1 (]: On model.retail.dim_datetime: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_datetime"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_datetime`
    
    

    OPTIONS()
    as (
      -- dim_datetime.sql

-- Create a CTE to extract date and time components
WITH datetime_cte AS (  
  SELECT DISTINCT
    InvoiceDate AS datetime_id,
    CASE
      WHEN LENGTH(InvoiceDate) = 16 THEN
        -- Date format: "DD/MM/YYYY HH:MM"
        PARSE_DATETIME('%d/%m/%Y %H:%M', InvoiceDate)
      WHEN LENGTH(InvoiceDate) <= 14 THEN
        -- Date format: "MM/DD/YY HH:MM"
        PARSE_DATETIME('%m/%d/%y %H:%M', InvoiceDate)
      ELSE
        NULL
    END AS date_part
  FROM `sapient-cycling-413017`.`retail`.`raw_invoices`
  WHERE InvoiceDate IS NOT NULL
)
SELECT
  datetime_id,
  date_part AS datetime,
  FORMAT_DATETIME('%Y', date_part) AS year,
  FORMAT_DATETIME('%m', date_part) AS month,
  FORMAT_DATETIME('%d', date_part) AS day,
  FORMAT_DATETIME('%H', date_part) AS hour,
  FORMAT_DATETIME('%M', date_part) AS minute,
  FORMAT_DATETIME('%A', date_part) AS weekday
FROM datetime_cte;
    );
  
[0m22:31:10.339217 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected ")" but got ";" at [40:18]; reason: invalidQuery, location: query, message: Syntax error: Expected ")" but got ";" at [40:18]')
[0m22:31:11.214807 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:a826deec-95ca-494f-8ebc-38c83eaf4a9b&page=queryresults
[0m22:31:11.219676 [debug] [Thread-1 (]: Timing info for model.retail.dim_datetime (execute): 22:31:09.034255 => 22:31:11.218656
[0m22:31:11.234240 [debug] [Thread-1 (]: Database Error in model dim_datetime (models/transform/dim_datetime.sql)
  Syntax error: Expected ")" but got ";" at [40:18]
  compiled Code at target/run/retail/models/transform/dim_datetime.sql
[0m22:31:11.237287 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4a784811-e03a-4399-af0b-f8038993229f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7e87317c10>]}
[0m22:31:11.242812 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model retail.dim_datetime ...................... [[31mERROR[0m in 2.27s]
[0m22:31:11.248214 [debug] [Thread-1 (]: Finished running node model.retail.dim_datetime
[0m22:31:11.251069 [debug] [Thread-1 (]: Began running node model.retail.dim_product
[0m22:31:11.253729 [info ] [Thread-1 (]: 3 of 4 START sql table model retail.dim_product ................................ [RUN]
[0m22:31:11.259928 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_datetime, now model.retail.dim_product)
[0m22:31:11.262335 [debug] [Thread-1 (]: Began compiling node model.retail.dim_product
[0m22:31:11.282924 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_product"
[0m22:31:11.300449 [debug] [Thread-1 (]: Timing info for model.retail.dim_product (compile): 22:31:11.266272 => 22:31:11.299624
[0m22:31:11.302806 [debug] [Thread-1 (]: Began executing node model.retail.dim_product
[0m22:31:11.311126 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:31:12.500524 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_product"
[0m22:31:12.524009 [debug] [Thread-1 (]: On model.retail.dim_product: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_product"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_product`
    
    

    OPTIONS()
    as (
      -- StockCode isn't unique, a product with the same id can have different and prices
-- Create the dimension table

select distinct
    to_hex(md5(cast(coalesce(cast(StockCode as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Description as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(UnitPrice as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as product_id,
    StockCode as stock_code,
    Description as description,
    UnitPrice as price,
from `sapient-cycling-413017`.`retail`.`raw_invoices`
where StockCode is not null
and UnitPrice > 0
    );
  
[0m22:31:16.845201 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:7049b241-e1e7-4282-80ae-b20d347ddfed&page=queryresults
[0m22:31:16.865448 [debug] [Thread-1 (]: Timing info for model.retail.dim_product (execute): 22:31:11.304426 => 22:31:16.864209
[0m22:31:16.870022 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4a784811-e03a-4399-af0b-f8038993229f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7e870493d0>]}
[0m22:31:16.874453 [info ] [Thread-1 (]: 3 of 4 OK created sql table model retail.dim_product ........................... [[32mCREATE TABLE (16.3k rows, 22.6 MiB processed)[0m in 5.61s]
[0m22:31:16.883044 [debug] [Thread-1 (]: Finished running node model.retail.dim_product
[0m22:31:16.894996 [debug] [Thread-1 (]: Began running node model.retail.fct_invoices
[0m22:31:16.898461 [info ] [Thread-1 (]: 4 of 4 SKIP relation retail.fct_invoices ....................................... [[33mSKIP[0m]
[0m22:31:16.903089 [debug] [Thread-1 (]: Finished running node model.retail.fct_invoices
[0m22:31:16.914715 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:31:16.921145 [debug] [MainThread]: Connection 'model.retail.dim_product' was properly closed.
[0m22:31:16.924162 [info ] [MainThread]: 
[0m22:31:16.927257 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 15.41 seconds (15.41s).
[0m22:31:16.937727 [debug] [MainThread]: Command end result
[0m22:31:16.973505 [info ] [MainThread]: 
[0m22:31:16.976491 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m22:31:16.981116 [info ] [MainThread]: 
[0m22:31:16.985981 [error] [MainThread]: [33mDatabase Error in model dim_datetime (models/transform/dim_datetime.sql)[0m
[0m22:31:16.994234 [error] [MainThread]:   Syntax error: Expected ")" but got ";" at [40:18]
[0m22:31:17.003677 [error] [MainThread]:   compiled Code at target/run/retail/models/transform/dim_datetime.sql
[0m22:31:17.009412 [info ] [MainThread]: 
[0m22:31:17.012642 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=1 TOTAL=4
[0m22:31:17.017890 [debug] [MainThread]: Command `dbt run` failed at 22:31:17.017274 after 19.51 seconds
[0m22:31:17.021391 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7e8982f110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7e89446090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7e8987b2d0>]}
[0m22:31:17.023941 [debug] [MainThread]: Flushing usage events
[0m22:31:49.014820 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f49e5ee6ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f49e66f9f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f49e6881a50>]}


============================== 22:31:49.025784 | 8c11c7ef-7adf-4cb0-9d9c-e647b9cd6bdf ==============================
[0m22:31:49.025784 [info ] [MainThread]: Running with dbt=1.5.9
[0m22:31:49.029088 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'partial_parse': 'True', 'printer_width': '80', 'log_cache_events': 'False', 'fail_fast': 'False', 'use_experimental_parser': 'False', 'version_check': 'True', 'warn_error': 'None', 'write_json': 'True', 'target_path': 'None', 'log_path': '/usr/local/airflow/include/dbt/logs', 'profiles_dir': '/usr/local/airflow/include/dbt/', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'log_format': 'default', 'debug': 'False', 'use_colors': 'True', 'indirect_selection': 'eager', 'introspect': 'True', 'no_print': 'None'}
[0m22:31:50.030683 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8c11c7ef-7adf-4cb0-9d9c-e647b9cd6bdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f49e43289d0>]}
[0m22:31:50.069384 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8c11c7ef-7adf-4cb0-9d9c-e647b9cd6bdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f49e430bfd0>]}
[0m22:31:50.071741 [info ] [MainThread]: Registered adapter: bigquery=1.5.3
[0m22:31:50.144800 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m22:31:51.422327 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:31:51.424172 [debug] [MainThread]: Partial parsing: updated file: retail://models/transform/dim_datetime.sql
[0m22:31:51.473403 [debug] [MainThread]: 1699: static parser successfully parsed transform/dim_datetime.sql
[0m22:31:51.530943 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8c11c7ef-7adf-4cb0-9d9c-e647b9cd6bdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f49e4169ed0>]}
[0m22:31:51.570861 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8c11c7ef-7adf-4cb0-9d9c-e647b9cd6bdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f49e4078110>]}
[0m22:31:51.573493 [info ] [MainThread]: Found 4 models, 0 tests, 0 snapshots, 0 analyses, 474 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics, 0 groups
[0m22:31:51.576221 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8c11c7ef-7adf-4cb0-9d9c-e647b9cd6bdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f49e95c7a50>]}
[0m22:31:51.581948 [info ] [MainThread]: 
[0m22:31:51.594504 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:31:51.609599 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sapient-cycling-413017'
[0m22:31:51.613234 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:31:52.553812 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017, now list_sapient-cycling-413017_retail)
[0m22:31:52.555781 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:31:53.525941 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8c11c7ef-7adf-4cb0-9d9c-e647b9cd6bdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f49e657ce10>]}
[0m22:31:53.531479 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:31:53.538038 [info ] [MainThread]: 
[0m22:31:53.586358 [debug] [Thread-1 (]: Began running node model.retail.dim_customer
[0m22:31:53.588362 [info ] [Thread-1 (]: 1 of 4 START sql table model retail.dim_customer ............................... [RUN]
[0m22:31:53.591692 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017_retail, now model.retail.dim_customer)
[0m22:31:53.593644 [debug] [Thread-1 (]: Began compiling node model.retail.dim_customer
[0m22:31:53.643821 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_customer"
[0m22:31:53.657406 [debug] [Thread-1 (]: Timing info for model.retail.dim_customer (compile): 22:31:53.595048 => 22:31:53.656846
[0m22:31:53.659200 [debug] [Thread-1 (]: Began executing node model.retail.dim_customer
[0m22:31:53.690565 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:31:55.046398 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_customer"
[0m22:31:55.070738 [debug] [Thread-1 (]: On model.retail.dim_customer: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_customer"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_customer`
    
    

    OPTIONS()
    as (
      with customer_cte as (
    select distinct to_hex(md5(cast(coalesce(cast(CustomerID as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Country as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as customer_id,
        Country as country
    from `sapient-cycling-413017`.`retail`.`raw_invoices`
    where CustomerID is not null
)
select
    t.*,
from customer_cte t
left join `sapient-cycling-413017`.`retail`.`country` cm on t.country = cm.nicename
    );
  
[0m22:31:58.688711 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:58218a92-9eaa-4189-9c08-25ea3d0aeb75&page=queryresults
[0m22:31:58.777973 [debug] [Thread-1 (]: Timing info for model.retail.dim_customer (execute): 22:31:53.660660 => 22:31:58.776495
[0m22:31:58.782315 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c11c7ef-7adf-4cb0-9d9c-e647b9cd6bdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f49e415b350>]}
[0m22:31:58.785914 [info ] [Thread-1 (]: 1 of 4 OK created sql table model retail.dim_customer .......................... [[32mCREATE TABLE (4.4k rows, 11.1 MiB processed)[0m in 5.19s]
[0m22:31:58.794342 [debug] [Thread-1 (]: Finished running node model.retail.dim_customer
[0m22:31:58.798899 [debug] [Thread-1 (]: Began running node model.retail.dim_datetime
[0m22:31:58.801800 [info ] [Thread-1 (]: 2 of 4 START sql table model retail.dim_datetime ............................... [RUN]
[0m22:31:58.809429 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_customer, now model.retail.dim_datetime)
[0m22:31:58.812062 [debug] [Thread-1 (]: Began compiling node model.retail.dim_datetime
[0m22:31:58.845242 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_datetime"
[0m22:31:58.865721 [debug] [Thread-1 (]: Timing info for model.retail.dim_datetime (compile): 22:31:58.815913 => 22:31:58.864877
[0m22:31:58.867907 [debug] [Thread-1 (]: Began executing node model.retail.dim_datetime
[0m22:31:58.878193 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_datetime"
[0m22:31:58.889687 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:31:58.898603 [debug] [Thread-1 (]: On model.retail.dim_datetime: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_datetime"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_datetime`
    
    

    OPTIONS()
    as (
      -- dim_datetime.sql

-- Create a CTE to extract date and time components
WITH datetime_cte AS (  
  SELECT DISTINCT
    InvoiceDate AS datetime_id,
    CASE
      WHEN LENGTH(InvoiceDate) = 16 THEN
        -- Date format: "DD/MM/YYYY HH:MM"
        PARSE_DATETIME('%d/%m/%Y %H:%M', InvoiceDate)
      WHEN LENGTH(InvoiceDate) <= 14 THEN
        -- Date format: "MM/DD/YY HH:MM"
        PARSE_DATETIME('%m/%d/%y %H:%M', InvoiceDate)
      ELSE
        NULL
    END AS date_part
  FROM `sapient-cycling-413017`.`retail`.`raw_invoices`
  WHERE InvoiceDate IS NOT NULL
)
SELECT
  datetime_id,
  date_part AS datetime,
  EXTRACT(YEAR FROM date_part) AS year,
  EXTRACT(MONTH FROM date_part) AS month,
  EXTRACT(DAY FROM date_part) AS day,
  EXTRACT(HOUR FROM date_part) AS hour,
  EXTRACT(MINUTE FROM date_part) AS minute,
  EXTRACT(DAYOFWEEK FROM date_part) AS weekday
FROM datetime_cte;
    );
  
[0m22:32:00.158180 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected ")" but got ";" at [40:18]; reason: invalidQuery, location: query, message: Syntax error: Expected ")" but got ";" at [40:18]')
[0m22:32:01.816381 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:59e6c993-f84a-48fd-a040-0eae38508c30&page=queryresults
[0m22:32:01.833911 [debug] [Thread-1 (]: Timing info for model.retail.dim_datetime (execute): 22:31:58.869847 => 22:32:01.830438
[0m22:32:01.863747 [debug] [Thread-1 (]: Database Error in model dim_datetime (models/transform/dim_datetime.sql)
  Syntax error: Expected ")" but got ";" at [40:18]
  compiled Code at target/run/retail/models/transform/dim_datetime.sql
[0m22:32:01.868376 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c11c7ef-7adf-4cb0-9d9c-e647b9cd6bdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f49e41fc2d0>]}
[0m22:32:01.871385 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model retail.dim_datetime ...................... [[31mERROR[0m in 3.06s]
[0m22:32:01.875098 [debug] [Thread-1 (]: Finished running node model.retail.dim_datetime
[0m22:32:01.878148 [debug] [Thread-1 (]: Began running node model.retail.dim_product
[0m22:32:01.881443 [info ] [Thread-1 (]: 3 of 4 START sql table model retail.dim_product ................................ [RUN]
[0m22:32:01.885633 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_datetime, now model.retail.dim_product)
[0m22:32:01.888961 [debug] [Thread-1 (]: Began compiling node model.retail.dim_product
[0m22:32:01.908554 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_product"
[0m22:32:01.926422 [debug] [Thread-1 (]: Timing info for model.retail.dim_product (compile): 22:32:01.892623 => 22:32:01.925659
[0m22:32:01.928745 [debug] [Thread-1 (]: Began executing node model.retail.dim_product
[0m22:32:01.937094 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:32:03.097215 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_product"
[0m22:32:03.144621 [debug] [Thread-1 (]: On model.retail.dim_product: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_product"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_product`
    
    

    OPTIONS()
    as (
      -- StockCode isn't unique, a product with the same id can have different and prices
-- Create the dimension table

select distinct
    to_hex(md5(cast(coalesce(cast(StockCode as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Description as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(UnitPrice as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as product_id,
    StockCode as stock_code,
    Description as description,
    UnitPrice as price,
from `sapient-cycling-413017`.`retail`.`raw_invoices`
where StockCode is not null
and UnitPrice > 0
    );
  
[0m22:32:07.185185 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:aebb697c-ff40-4c2e-ad07-39b036c3690b&page=queryresults
[0m22:32:07.207798 [debug] [Thread-1 (]: Timing info for model.retail.dim_product (execute): 22:32:01.930796 => 22:32:07.205895
[0m22:32:07.218054 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c11c7ef-7adf-4cb0-9d9c-e647b9cd6bdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f49e396e450>]}
[0m22:32:07.225507 [info ] [Thread-1 (]: 3 of 4 OK created sql table model retail.dim_product ........................... [[32mCREATE TABLE (16.3k rows, 22.6 MiB processed)[0m in 5.33s]
[0m22:32:07.243895 [debug] [Thread-1 (]: Finished running node model.retail.dim_product
[0m22:32:07.259413 [debug] [Thread-1 (]: Began running node model.retail.fct_invoices
[0m22:32:07.266303 [info ] [Thread-1 (]: 4 of 4 SKIP relation retail.fct_invoices ....................................... [[33mSKIP[0m]
[0m22:32:07.287475 [debug] [Thread-1 (]: Finished running node model.retail.fct_invoices
[0m22:32:07.302051 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:32:07.307067 [debug] [MainThread]: Connection 'model.retail.dim_product' was properly closed.
[0m22:32:07.315178 [info ] [MainThread]: 
[0m22:32:07.325477 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 15.72 seconds (15.72s).
[0m22:32:07.336182 [debug] [MainThread]: Command end result
[0m22:32:07.384338 [info ] [MainThread]: 
[0m22:32:07.387428 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m22:32:07.391255 [info ] [MainThread]: 
[0m22:32:07.396831 [error] [MainThread]: [33mDatabase Error in model dim_datetime (models/transform/dim_datetime.sql)[0m
[0m22:32:07.406725 [error] [MainThread]:   Syntax error: Expected ")" but got ";" at [40:18]
[0m22:32:07.409951 [error] [MainThread]:   compiled Code at target/run/retail/models/transform/dim_datetime.sql
[0m22:32:07.414821 [info ] [MainThread]: 
[0m22:32:07.422422 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=1 TOTAL=4
[0m22:32:07.426104 [debug] [MainThread]: Command `dbt run` failed at 22:32:07.425671 after 18.45 seconds
[0m22:32:07.437736 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f49e6872450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f49e682f290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f49e6865e10>]}
[0m22:32:07.440719 [debug] [MainThread]: Flushing usage events
[0m22:32:59.287154 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa6e156f990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa6e18c6f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa6e2fbae10>]}


============================== 22:32:59.297121 | dbadbd90-593b-4e2d-9bf6-162bac9859b1 ==============================
[0m22:32:59.297121 [info ] [MainThread]: Running with dbt=1.5.9
[0m22:32:59.300898 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'use_experimental_parser': 'False', 'warn_error': 'None', 'printer_width': '80', 'introspect': 'True', 'static_parser': 'True', 'profiles_dir': '/usr/local/airflow/include/dbt/', 'indirect_selection': 'eager', 'version_check': 'True', 'log_format': 'default', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'write_json': 'True', 'fail_fast': 'False', 'no_print': 'None', 'log_path': '/usr/local/airflow/include/dbt/logs', 'debug': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'quiet': 'False', 'target_path': 'None'}
[0m22:33:00.203139 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dbadbd90-593b-4e2d-9bf6-162bac9859b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa6e163f9d0>]}
[0m22:33:00.248578 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dbadbd90-593b-4e2d-9bf6-162bac9859b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa6e148c9d0>]}
[0m22:33:00.251457 [info ] [MainThread]: Registered adapter: bigquery=1.5.3
[0m22:33:00.333837 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m22:33:02.186189 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:33:02.188267 [debug] [MainThread]: Partial parsing: updated file: retail://models/transform/dim_datetime.sql
[0m22:33:02.244657 [debug] [MainThread]: 1699: static parser successfully parsed transform/dim_datetime.sql
[0m22:33:02.321210 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dbadbd90-593b-4e2d-9bf6-162bac9859b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa6df3bad90>]}
[0m22:33:02.369014 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dbadbd90-593b-4e2d-9bf6-162bac9859b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa6df118a50>]}
[0m22:33:02.371642 [info ] [MainThread]: Found 4 models, 0 tests, 0 snapshots, 0 analyses, 474 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics, 0 groups
[0m22:33:02.375481 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dbadbd90-593b-4e2d-9bf6-162bac9859b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa6e4683b90>]}
[0m22:33:02.385027 [info ] [MainThread]: 
[0m22:33:02.393545 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:33:02.404635 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sapient-cycling-413017'
[0m22:33:02.407579 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:33:03.632545 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017, now list_sapient-cycling-413017_retail)
[0m22:33:03.637952 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:33:05.070863 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dbadbd90-593b-4e2d-9bf6-162bac9859b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa6e101d310>]}
[0m22:33:05.078110 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:33:05.085608 [info ] [MainThread]: 
[0m22:33:05.155901 [debug] [Thread-1 (]: Began running node model.retail.dim_customer
[0m22:33:05.158613 [info ] [Thread-1 (]: 1 of 4 START sql table model retail.dim_customer ............................... [RUN]
[0m22:33:05.164548 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017_retail, now model.retail.dim_customer)
[0m22:33:05.166967 [debug] [Thread-1 (]: Began compiling node model.retail.dim_customer
[0m22:33:05.223940 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_customer"
[0m22:33:05.236361 [debug] [Thread-1 (]: Timing info for model.retail.dim_customer (compile): 22:33:05.168680 => 22:33:05.235653
[0m22:33:05.238369 [debug] [Thread-1 (]: Began executing node model.retail.dim_customer
[0m22:33:05.273142 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:33:06.423382 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_customer"
[0m22:33:06.437144 [debug] [Thread-1 (]: On model.retail.dim_customer: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_customer"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_customer`
    
    

    OPTIONS()
    as (
      with customer_cte as (
    select distinct to_hex(md5(cast(coalesce(cast(CustomerID as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Country as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as customer_id,
        Country as country
    from `sapient-cycling-413017`.`retail`.`raw_invoices`
    where CustomerID is not null
)
select
    t.*,
from customer_cte t
left join `sapient-cycling-413017`.`retail`.`country` cm on t.country = cm.nicename
    );
  
[0m22:33:10.487181 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:0af8f2b2-ecfe-4307-bf5c-c52e61885881&page=queryresults
[0m22:33:10.523677 [debug] [Thread-1 (]: Timing info for model.retail.dim_customer (execute): 22:33:05.239770 => 22:33:10.523212
[0m22:33:10.526622 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dbadbd90-593b-4e2d-9bf6-162bac9859b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa6df2c83d0>]}
[0m22:33:10.528946 [info ] [Thread-1 (]: 1 of 4 OK created sql table model retail.dim_customer .......................... [[32mCREATE TABLE (4.4k rows, 11.1 MiB processed)[0m in 5.36s]
[0m22:33:10.532845 [debug] [Thread-1 (]: Finished running node model.retail.dim_customer
[0m22:33:10.535875 [debug] [Thread-1 (]: Began running node model.retail.dim_datetime
[0m22:33:10.538291 [info ] [Thread-1 (]: 2 of 4 START sql table model retail.dim_datetime ............................... [RUN]
[0m22:33:10.542436 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_customer, now model.retail.dim_datetime)
[0m22:33:10.546529 [debug] [Thread-1 (]: Began compiling node model.retail.dim_datetime
[0m22:33:10.585132 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_datetime"
[0m22:33:10.603636 [debug] [Thread-1 (]: Timing info for model.retail.dim_datetime (compile): 22:33:10.549492 => 22:33:10.602776
[0m22:33:10.606297 [debug] [Thread-1 (]: Began executing node model.retail.dim_datetime
[0m22:33:10.622760 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_datetime"
[0m22:33:10.662803 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:33:10.672158 [debug] [Thread-1 (]: On model.retail.dim_datetime: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_datetime"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_datetime`
    
    

    OPTIONS()
    as (
      -- dim_datetime.sql

-- Create a CTE to extract date and time components
WITH datetime_cte AS (  
  SELECT DISTINCT
    InvoiceDate AS datetime_id,
    PARSE_DATETIME('%d/%m/%Y %H:%M', InvoiceDate) AS date_part
  FROM `sapient-cycling-413017`.`retail`.`raw_invoices`
  WHERE InvoiceDate IS NOT NULL
)
SELECT
  datetime_id,
  date_part AS datetime,
  EXTRACT(YEAR FROM date_part) AS year,
  EXTRACT(MONTH FROM date_part) AS month,
  EXTRACT(DAY FROM date_part) AS day,
  EXTRACT(HOUR FROM date_part) AS hour,
  EXTRACT(MINUTE FROM date_part) AS minute,
  EXTRACT(DAYOFWEEK FROM date_part) AS weekday
FROM datetime_cte;
    );
  
[0m22:33:11.614307 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected ")" but got ";" at [31:18]; reason: invalidQuery, location: query, message: Syntax error: Expected ")" but got ";" at [31:18]')
[0m22:33:12.482439 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:8347ea82-a264-46be-a6d9-7e47754f073e&page=queryresults
[0m22:33:12.495558 [debug] [Thread-1 (]: Timing info for model.retail.dim_datetime (execute): 22:33:10.609159 => 22:33:12.494308
[0m22:33:12.525582 [debug] [Thread-1 (]: Database Error in model dim_datetime (models/transform/dim_datetime.sql)
  Syntax error: Expected ")" but got ";" at [31:18]
  compiled Code at target/run/retail/models/transform/dim_datetime.sql
[0m22:33:12.529889 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dbadbd90-593b-4e2d-9bf6-162bac9859b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa6de801410>]}
[0m22:33:12.532308 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model retail.dim_datetime ...................... [[31mERROR[0m in 1.99s]
[0m22:33:12.536045 [debug] [Thread-1 (]: Finished running node model.retail.dim_datetime
[0m22:33:12.538887 [debug] [Thread-1 (]: Began running node model.retail.dim_product
[0m22:33:12.542058 [info ] [Thread-1 (]: 3 of 4 START sql table model retail.dim_product ................................ [RUN]
[0m22:33:12.552021 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_datetime, now model.retail.dim_product)
[0m22:33:12.555293 [debug] [Thread-1 (]: Began compiling node model.retail.dim_product
[0m22:33:12.576985 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_product"
[0m22:33:12.593445 [debug] [Thread-1 (]: Timing info for model.retail.dim_product (compile): 22:33:12.559871 => 22:33:12.591805
[0m22:33:12.596561 [debug] [Thread-1 (]: Began executing node model.retail.dim_product
[0m22:33:12.602933 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:33:13.752001 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_product"
[0m22:33:13.797313 [debug] [Thread-1 (]: On model.retail.dim_product: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_product"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_product`
    
    

    OPTIONS()
    as (
      -- StockCode isn't unique, a product with the same id can have different and prices
-- Create the dimension table

select distinct
    to_hex(md5(cast(coalesce(cast(StockCode as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Description as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(UnitPrice as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as product_id,
    StockCode as stock_code,
    Description as description,
    UnitPrice as price,
from `sapient-cycling-413017`.`retail`.`raw_invoices`
where StockCode is not null
and UnitPrice > 0
    );
  
[0m22:33:18.044074 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:9a49b18a-b5b0-4737-b0b1-5f0f9e0f2091&page=queryresults
[0m22:33:18.062572 [debug] [Thread-1 (]: Timing info for model.retail.dim_product (execute): 22:33:12.598698 => 22:33:18.061379
[0m22:33:18.069329 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dbadbd90-593b-4e2d-9bf6-162bac9859b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa6df240650>]}
[0m22:33:18.075411 [info ] [Thread-1 (]: 3 of 4 OK created sql table model retail.dim_product ........................... [[32mCREATE TABLE (16.3k rows, 22.6 MiB processed)[0m in 5.52s]
[0m22:33:18.089352 [debug] [Thread-1 (]: Finished running node model.retail.dim_product
[0m22:33:18.101563 [debug] [Thread-1 (]: Began running node model.retail.fct_invoices
[0m22:33:18.110094 [info ] [Thread-1 (]: 4 of 4 SKIP relation retail.fct_invoices ....................................... [[33mSKIP[0m]
[0m22:33:18.128982 [debug] [Thread-1 (]: Finished running node model.retail.fct_invoices
[0m22:33:18.138759 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:33:18.141833 [debug] [MainThread]: Connection 'model.retail.dim_product' was properly closed.
[0m22:33:18.146287 [info ] [MainThread]: 
[0m22:33:18.152975 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 15.75 seconds (15.75s).
[0m22:33:18.166399 [debug] [MainThread]: Command end result
[0m22:33:18.232431 [info ] [MainThread]: 
[0m22:33:18.239467 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m22:33:18.247943 [info ] [MainThread]: 
[0m22:33:18.253385 [error] [MainThread]: [33mDatabase Error in model dim_datetime (models/transform/dim_datetime.sql)[0m
[0m22:33:18.264871 [error] [MainThread]:   Syntax error: Expected ")" but got ";" at [31:18]
[0m22:33:18.274355 [error] [MainThread]:   compiled Code at target/run/retail/models/transform/dim_datetime.sql
[0m22:33:18.280436 [info ] [MainThread]: 
[0m22:33:18.294433 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=1 TOTAL=4
[0m22:33:18.303285 [debug] [MainThread]: Command `dbt run` failed at 22:33:18.302643 after 19.06 seconds
[0m22:33:18.305867 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa6e1130b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa6e18e2210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa6df399b10>]}
[0m22:33:18.310361 [debug] [MainThread]: Flushing usage events
[0m22:35:48.181934 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efc6d2b6b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efc6d098ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efc6eaf7290>]}


============================== 22:35:48.190166 | a381d150-5824-46c0-abeb-ad9bef1e86dd ==============================
[0m22:35:48.190166 [info ] [MainThread]: Running with dbt=1.5.9
[0m22:35:48.193936 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '/usr/local/airflow/include/dbt/', 'use_colors': 'True', 'quiet': 'False', 'warn_error': 'None', 'indirect_selection': 'eager', 'debug': 'False', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'version_check': 'True', 'partial_parse': 'True', 'log_format': 'default', 'fail_fast': 'False', 'log_cache_events': 'False', 'introspect': 'True', 'cache_selected_only': 'False', 'log_path': '/usr/local/airflow/include/dbt/logs', 'use_experimental_parser': 'False', 'static_parser': 'True', 'write_json': 'True', 'no_print': 'None'}
[0m22:35:48.996687 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a381d150-5824-46c0-abeb-ad9bef1e86dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efc6af18a50>]}
[0m22:35:49.035014 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a381d150-5824-46c0-abeb-ad9bef1e86dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efc6aed9390>]}
[0m22:35:49.037710 [info ] [MainThread]: Registered adapter: bigquery=1.5.3
[0m22:35:49.105378 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m22:35:50.370968 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:35:50.373160 [debug] [MainThread]: Partial parsing: updated file: retail://models/transform/dim_datetime.sql
[0m22:35:50.451379 [debug] [MainThread]: 1699: static parser successfully parsed transform/dim_datetime.sql
[0m22:35:50.586457 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a381d150-5824-46c0-abeb-ad9bef1e86dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efc6ac3a8d0>]}
[0m22:35:50.652564 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a381d150-5824-46c0-abeb-ad9bef1e86dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efc6adeae90>]}
[0m22:35:50.654902 [info ] [MainThread]: Found 4 models, 0 tests, 0 snapshots, 0 analyses, 474 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics, 0 groups
[0m22:35:50.658163 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a381d150-5824-46c0-abeb-ad9bef1e86dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efc701c3b90>]}
[0m22:35:50.663892 [info ] [MainThread]: 
[0m22:35:50.667864 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:35:50.673611 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sapient-cycling-413017'
[0m22:35:50.681684 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:35:51.851454 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017, now list_sapient-cycling-413017_retail)
[0m22:35:51.855117 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:35:52.987837 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a381d150-5824-46c0-abeb-ad9bef1e86dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efc6deafe50>]}
[0m22:35:52.994337 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:35:53.000467 [info ] [MainThread]: 
[0m22:35:53.100110 [debug] [Thread-1 (]: Began running node model.retail.dim_customer
[0m22:35:53.105657 [info ] [Thread-1 (]: 1 of 4 START sql table model retail.dim_customer ............................... [RUN]
[0m22:35:53.118034 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017_retail, now model.retail.dim_customer)
[0m22:35:53.124049 [debug] [Thread-1 (]: Began compiling node model.retail.dim_customer
[0m22:35:53.220294 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_customer"
[0m22:35:53.240108 [debug] [Thread-1 (]: Timing info for model.retail.dim_customer (compile): 22:35:53.127300 => 22:35:53.239024
[0m22:35:53.243324 [debug] [Thread-1 (]: Began executing node model.retail.dim_customer
[0m22:35:53.293902 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:35:54.504072 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_customer"
[0m22:35:54.521393 [debug] [Thread-1 (]: On model.retail.dim_customer: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_customer"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_customer`
    
    

    OPTIONS()
    as (
      with customer_cte as (
    select distinct to_hex(md5(cast(coalesce(cast(CustomerID as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Country as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as customer_id,
        Country as country
    from `sapient-cycling-413017`.`retail`.`raw_invoices`
    where CustomerID is not null
)
select
    t.*,
from customer_cte t
left join `sapient-cycling-413017`.`retail`.`country` cm on t.country = cm.nicename
    );
  
[0m22:36:07.455710 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:73148dac-e1e5-4447-a836-9247f7d2d37f&page=queryresults
[0m22:36:07.520767 [debug] [Thread-1 (]: Timing info for model.retail.dim_customer (execute): 22:35:53.245472 => 22:36:07.519386
[0m22:36:07.525748 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a381d150-5824-46c0-abeb-ad9bef1e86dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efc6ae14310>]}
[0m22:36:07.529316 [info ] [Thread-1 (]: 1 of 4 OK created sql table model retail.dim_customer .......................... [[32mCREATE TABLE (4.4k rows, 11.1 MiB processed)[0m in 14.41s]
[0m22:36:07.534542 [debug] [Thread-1 (]: Finished running node model.retail.dim_customer
[0m22:36:07.537296 [debug] [Thread-1 (]: Began running node model.retail.dim_datetime
[0m22:36:07.539701 [info ] [Thread-1 (]: 2 of 4 START sql table model retail.dim_datetime ............................... [RUN]
[0m22:36:07.543538 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_customer, now model.retail.dim_datetime)
[0m22:36:07.546312 [debug] [Thread-1 (]: Began compiling node model.retail.dim_datetime
[0m22:36:07.588088 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_datetime"
[0m22:36:07.599168 [debug] [Thread-1 (]: Timing info for model.retail.dim_datetime (compile): 22:36:07.548774 => 22:36:07.598363
[0m22:36:07.602487 [debug] [Thread-1 (]: Began executing node model.retail.dim_datetime
[0m22:36:07.612150 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_datetime"
[0m22:36:07.623261 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:36:07.631713 [debug] [Thread-1 (]: On model.retail.dim_datetime: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_datetime"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_datetime`
    
    

    OPTIONS()
    as (
      WITH datetime_cte AS (  
  SELECT DISTINCT
    InvoiceDate AS datetime_id,
    CASE
      WHEN LENGTH(InvoiceDate) = 16 THEN
        -- Date format: "DD/MM/YYYY HH:MM"
        PARSE_DATETIME('%m/%d/%Y %H:%M', InvoiceDate)
      WHEN LENGTH(InvoiceDate) <= 14 THEN
        -- Date format: "MM/DD/YY HH:MM"
        PARSE_DATETIME('%m/%d/%y %H:%M', InvoiceDate)
      ELSE
        NULL
    END AS date_part,
  FROM `sapient-cycling-413017`.`retail`.`raw_invoices`
  WHERE InvoiceDate IS NOT NULL
)
SELECT
  datetime_id,
  date_part as datetime,
  EXTRACT(YEAR FROM date_part) AS year,
  EXTRACT(MONTH FROM date_part) AS month,
  EXTRACT(DAY FROM date_part) AS day,
  EXTRACT(HOUR FROM date_part) AS hour,
  EXTRACT(MINUTE FROM date_part) AS minute,
  EXTRACT(DAYOFWEEK FROM date_part) AS weekday
FROM datetime_cte
    );
  
[0m22:36:09.553667 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('No matching signature for function LENGTH for argument types: TIMESTAMP. Supported signatures: LENGTH(STRING); LENGTH(BYTES) at [16:12]; reason: invalidQuery, location: query, message: No matching signature for function LENGTH for argument types: TIMESTAMP. Supported signatures: LENGTH(STRING); LENGTH(BYTES) at [16:12]')
[0m22:36:11.447822 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:bf9ceafe-0c92-4408-94c4-5766dbaf4f59&page=queryresults
[0m22:36:11.466470 [debug] [Thread-1 (]: Timing info for model.retail.dim_datetime (execute): 22:36:07.604528 => 22:36:11.461520
[0m22:36:11.519572 [debug] [Thread-1 (]: Database Error in model dim_datetime (models/transform/dim_datetime.sql)
  No matching signature for function LENGTH for argument types: TIMESTAMP. Supported signatures: LENGTH(STRING); LENGTH(BYTES) at [16:12]
  compiled Code at target/run/retail/models/transform/dim_datetime.sql
[0m22:36:11.526126 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a381d150-5824-46c0-abeb-ad9bef1e86dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efc6adce910>]}
[0m22:36:11.532972 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model retail.dim_datetime ...................... [[31mERROR[0m in 3.98s]
[0m22:36:11.544949 [debug] [Thread-1 (]: Finished running node model.retail.dim_datetime
[0m22:36:11.553259 [debug] [Thread-1 (]: Began running node model.retail.dim_product
[0m22:36:11.560004 [info ] [Thread-1 (]: 3 of 4 START sql table model retail.dim_product ................................ [RUN]
[0m22:36:11.583539 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_datetime, now model.retail.dim_product)
[0m22:36:11.589323 [debug] [Thread-1 (]: Began compiling node model.retail.dim_product
[0m22:36:11.615155 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_product"
[0m22:36:11.631042 [debug] [Thread-1 (]: Timing info for model.retail.dim_product (compile): 22:36:11.591900 => 22:36:11.630188
[0m22:36:11.633345 [debug] [Thread-1 (]: Began executing node model.retail.dim_product
[0m22:36:11.640917 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:36:12.736530 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_product"
[0m22:36:12.750265 [debug] [Thread-1 (]: On model.retail.dim_product: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_product"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_product`
    
    

    OPTIONS()
    as (
      -- StockCode isn't unique, a product with the same id can have different and prices
-- Create the dimension table

select distinct
    to_hex(md5(cast(coalesce(cast(StockCode as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Description as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(UnitPrice as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as product_id,
    StockCode as stock_code,
    Description as description,
    UnitPrice as price,
from `sapient-cycling-413017`.`retail`.`raw_invoices`
where StockCode is not null
and UnitPrice > 0
    );
  
[0m22:36:17.379577 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:fb6fb44f-15e9-481a-84ea-00b4c082caec&page=queryresults
[0m22:36:17.391182 [debug] [Thread-1 (]: Timing info for model.retail.dim_product (execute): 22:36:11.635986 => 22:36:17.390447
[0m22:36:17.396104 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a381d150-5824-46c0-abeb-ad9bef1e86dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efc6cb4f4d0>]}
[0m22:36:17.400751 [info ] [Thread-1 (]: 3 of 4 OK created sql table model retail.dim_product ........................... [[32mCREATE TABLE (16.3k rows, 22.6 MiB processed)[0m in 5.81s]
[0m22:36:17.412129 [debug] [Thread-1 (]: Finished running node model.retail.dim_product
[0m22:36:17.417270 [debug] [Thread-1 (]: Began running node model.retail.fct_invoices
[0m22:36:17.419639 [info ] [Thread-1 (]: 4 of 4 SKIP relation retail.fct_invoices ....................................... [[33mSKIP[0m]
[0m22:36:17.424069 [debug] [Thread-1 (]: Finished running node model.retail.fct_invoices
[0m22:36:17.435050 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:36:17.439175 [debug] [MainThread]: Connection 'model.retail.dim_product' was properly closed.
[0m22:36:17.441198 [info ] [MainThread]: 
[0m22:36:17.444120 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 26.77 seconds (26.77s).
[0m22:36:17.458017 [debug] [MainThread]: Command end result
[0m22:36:17.508206 [info ] [MainThread]: 
[0m22:36:17.513113 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m22:36:17.521089 [info ] [MainThread]: 
[0m22:36:17.529496 [error] [MainThread]: [33mDatabase Error in model dim_datetime (models/transform/dim_datetime.sql)[0m
[0m22:36:17.532886 [error] [MainThread]:   No matching signature for function LENGTH for argument types: TIMESTAMP. Supported signatures: LENGTH(STRING); LENGTH(BYTES) at [16:12]
[0m22:36:17.540093 [error] [MainThread]:   compiled Code at target/run/retail/models/transform/dim_datetime.sql
[0m22:36:17.543919 [info ] [MainThread]: 
[0m22:36:17.548143 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=1 TOTAL=4
[0m22:36:17.555180 [debug] [MainThread]: Command `dbt run` failed at 22:36:17.554570 after 29.42 seconds
[0m22:36:17.557818 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efc6cfdb450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efc6d407610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7efc6d099050>]}
[0m22:36:17.559259 [debug] [MainThread]: Flushing usage events
[0m22:37:03.588349 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff4d836f890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff4d836f190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff4d83c4b90>]}


============================== 22:37:03.597198 | b5d7add8-5bfe-4c40-978f-a92d9d1685fc ==============================
[0m22:37:03.597198 [info ] [MainThread]: Running with dbt=1.5.9
[0m22:37:03.600697 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'target_path': 'None', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'debug': 'False', 'log_path': '/usr/local/airflow/include/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'log_format': 'default', 'cache_selected_only': 'False', 'use_colors': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'static_parser': 'True', 'profiles_dir': '/usr/local/airflow/include/dbt/', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'printer_width': '80', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'version_check': 'True', 'introspect': 'True'}
[0m22:37:04.352831 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b5d7add8-5bfe-4c40-978f-a92d9d1685fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff4d80775d0>]}
[0m22:37:04.394605 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b5d7add8-5bfe-4c40-978f-a92d9d1685fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff4d5e985d0>]}
[0m22:37:04.397119 [info ] [MainThread]: Registered adapter: bigquery=1.5.3
[0m22:37:04.464381 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m22:37:05.898691 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:37:05.900949 [debug] [MainThread]: Partial parsing: updated file: retail://models/transform/dim_datetime.sql
[0m22:37:05.956986 [debug] [MainThread]: 1699: static parser successfully parsed transform/dim_datetime.sql
[0m22:37:06.017466 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b5d7add8-5bfe-4c40-978f-a92d9d1685fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff4d5ce1050>]}
[0m22:37:06.051608 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b5d7add8-5bfe-4c40-978f-a92d9d1685fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff4d5be9250>]}
[0m22:37:06.054012 [info ] [MainThread]: Found 4 models, 0 tests, 0 snapshots, 0 analyses, 474 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics, 0 groups
[0m22:37:06.056926 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b5d7add8-5bfe-4c40-978f-a92d9d1685fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff4db1539d0>]}
[0m22:37:06.062506 [info ] [MainThread]: 
[0m22:37:06.069173 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:37:06.074429 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sapient-cycling-413017'
[0m22:37:06.076771 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:37:07.095379 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017, now list_sapient-cycling-413017_retail)
[0m22:37:07.098843 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:37:08.150232 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b5d7add8-5bfe-4c40-978f-a92d9d1685fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff4db1539d0>]}
[0m22:37:08.157210 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:37:08.166751 [info ] [MainThread]: 
[0m22:37:08.250228 [debug] [Thread-1 (]: Began running node model.retail.dim_customer
[0m22:37:08.252734 [info ] [Thread-1 (]: 1 of 4 START sql table model retail.dim_customer ............................... [RUN]
[0m22:37:08.257014 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017_retail, now model.retail.dim_customer)
[0m22:37:08.259239 [debug] [Thread-1 (]: Began compiling node model.retail.dim_customer
[0m22:37:08.314868 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_customer"
[0m22:37:08.327939 [debug] [Thread-1 (]: Timing info for model.retail.dim_customer (compile): 22:37:08.260888 => 22:37:08.327178
[0m22:37:08.330131 [debug] [Thread-1 (]: Began executing node model.retail.dim_customer
[0m22:37:08.365180 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:37:09.489409 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_customer"
[0m22:37:09.505453 [debug] [Thread-1 (]: On model.retail.dim_customer: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_customer"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_customer`
    
    

    OPTIONS()
    as (
      with customer_cte as (
    select distinct to_hex(md5(cast(coalesce(cast(CustomerID as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Country as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as customer_id,
        Country as country
    from `sapient-cycling-413017`.`retail`.`raw_invoices`
    where CustomerID is not null
)
select
    t.*,
from customer_cte t
left join `sapient-cycling-413017`.`retail`.`country` cm on t.country = cm.nicename
    );
  
[0m22:37:12.950376 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:16707cef-f410-4b85-9538-8dafde1f12a3&page=queryresults
[0m22:37:13.025677 [debug] [Thread-1 (]: Timing info for model.retail.dim_customer (execute): 22:37:08.331934 => 22:37:13.025016
[0m22:37:13.028906 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b5d7add8-5bfe-4c40-978f-a92d9d1685fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff4d5da0850>]}
[0m22:37:13.031472 [info ] [Thread-1 (]: 1 of 4 OK created sql table model retail.dim_customer .......................... [[32mCREATE TABLE (4.4k rows, 11.1 MiB processed)[0m in 4.77s]
[0m22:37:13.035949 [debug] [Thread-1 (]: Finished running node model.retail.dim_customer
[0m22:37:13.038738 [debug] [Thread-1 (]: Began running node model.retail.dim_datetime
[0m22:37:13.040881 [info ] [Thread-1 (]: 2 of 4 START sql table model retail.dim_datetime ............................... [RUN]
[0m22:37:13.044957 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_customer, now model.retail.dim_datetime)
[0m22:37:13.047768 [debug] [Thread-1 (]: Began compiling node model.retail.dim_datetime
[0m22:37:13.079797 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_datetime"
[0m22:37:13.104983 [debug] [Thread-1 (]: Timing info for model.retail.dim_datetime (compile): 22:37:13.051018 => 22:37:13.104207
[0m22:37:13.107578 [debug] [Thread-1 (]: Began executing node model.retail.dim_datetime
[0m22:37:13.117453 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_datetime"
[0m22:37:13.134069 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:37:13.142833 [debug] [Thread-1 (]: On model.retail.dim_datetime: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_datetime"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_datetime`
    
    

    OPTIONS()
    as (
      -- dim_datetime.sql

-- Create a CTE to extract date and time components
WITH datetime_cte AS (  
  SELECT DISTINCT
    InvoiceDate AS datetime_id,
    CASE
      WHEN FORMAT_DATETIME('%d/%m/%Y %H:%M', PARSE_DATETIME('%m/%d/%Y %H:%M', InvoiceDate)) IS NOT NULL THEN
        -- Date format: "DD/MM/YYYY HH:MM"
        PARSE_DATETIME('%d/%m/%Y %H:%M', InvoiceDate)
      WHEN FORMAT_DATETIME('%d/%m/%Y %H:%M', PARSE_DATETIME('%m/%d/%y %H:%M', InvoiceDate)) IS NOT NULL THEN
        -- Date format: "MM/DD/YY HH:MM"
        PARSE_DATETIME('%m/%d/%y %H:%M', InvoiceDate)
      ELSE
        NULL
    END AS date_part
  FROM `sapient-cycling-413017`.`retail`.`raw_invoices`
  WHERE InvoiceDate IS NOT NULL
)
SELECT
  datetime_id,
  date_part AS datetime,
  EXTRACT(YEAR FROM date_part) AS year,
  EXTRACT(MONTH FROM date_part) AS month,
  EXTRACT(DAY FROM date_part) AS day,
  EXTRACT(HOUR FROM date_part) AS hour,
  EXTRACT(MINUTE FROM date_part) AS minute,
  EXTRACT(DAYOFWEEK FROM date_part) AS weekday
FROM datetime_cte;
    );
  
[0m22:37:14.179474 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected ")" but got ";" at [40:18]; reason: invalidQuery, location: query, message: Syntax error: Expected ")" but got ";" at [40:18]')
[0m22:37:15.510012 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:613f170f-1187-452a-94de-dabf3dc55d0b&page=queryresults
[0m22:37:15.523211 [debug] [Thread-1 (]: Timing info for model.retail.dim_datetime (execute): 22:37:13.109478 => 22:37:15.521022
[0m22:37:15.558433 [debug] [Thread-1 (]: Database Error in model dim_datetime (models/transform/dim_datetime.sql)
  Syntax error: Expected ")" but got ";" at [40:18]
  compiled Code at target/run/retail/models/transform/dim_datetime.sql
[0m22:37:15.561032 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b5d7add8-5bfe-4c40-978f-a92d9d1685fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff4d5d9bb10>]}
[0m22:37:15.565066 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model retail.dim_datetime ...................... [[31mERROR[0m in 2.52s]
[0m22:37:15.573262 [debug] [Thread-1 (]: Finished running node model.retail.dim_datetime
[0m22:37:15.576385 [debug] [Thread-1 (]: Began running node model.retail.dim_product
[0m22:37:15.579682 [info ] [Thread-1 (]: 3 of 4 START sql table model retail.dim_product ................................ [RUN]
[0m22:37:15.591207 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_datetime, now model.retail.dim_product)
[0m22:37:15.595253 [debug] [Thread-1 (]: Began compiling node model.retail.dim_product
[0m22:37:15.614887 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_product"
[0m22:37:15.640622 [debug] [Thread-1 (]: Timing info for model.retail.dim_product (compile): 22:37:15.597819 => 22:37:15.639846
[0m22:37:15.642597 [debug] [Thread-1 (]: Began executing node model.retail.dim_product
[0m22:37:15.649002 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:37:16.847613 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_product"
[0m22:37:16.894374 [debug] [Thread-1 (]: On model.retail.dim_product: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_product"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_product`
    
    

    OPTIONS()
    as (
      -- StockCode isn't unique, a product with the same id can have different and prices
-- Create the dimension table

select distinct
    to_hex(md5(cast(coalesce(cast(StockCode as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Description as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(UnitPrice as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as product_id,
    StockCode as stock_code,
    Description as description,
    UnitPrice as price,
from `sapient-cycling-413017`.`retail`.`raw_invoices`
where StockCode is not null
and UnitPrice > 0
    );
  
[0m22:37:21.148466 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:b3f7a756-be27-4757-9128-d02f7f26b95e&page=queryresults
[0m22:37:21.171149 [debug] [Thread-1 (]: Timing info for model.retail.dim_product (execute): 22:37:15.644002 => 22:37:21.170329
[0m22:37:21.190279 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b5d7add8-5bfe-4c40-978f-a92d9d1685fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff4d5d99110>]}
[0m22:37:21.194347 [info ] [Thread-1 (]: 3 of 4 OK created sql table model retail.dim_product ........................... [[32mCREATE TABLE (16.3k rows, 22.6 MiB processed)[0m in 5.60s]
[0m22:37:21.217354 [debug] [Thread-1 (]: Finished running node model.retail.dim_product
[0m22:37:21.221283 [debug] [Thread-1 (]: Began running node model.retail.fct_invoices
[0m22:37:21.223647 [info ] [Thread-1 (]: 4 of 4 SKIP relation retail.fct_invoices ....................................... [[33mSKIP[0m]
[0m22:37:21.238422 [debug] [Thread-1 (]: Finished running node model.retail.fct_invoices
[0m22:37:21.250945 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:37:21.278607 [debug] [MainThread]: Connection 'model.retail.dim_product' was properly closed.
[0m22:37:21.281500 [info ] [MainThread]: 
[0m22:37:21.286059 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 15.22 seconds (15.22s).
[0m22:37:21.292780 [debug] [MainThread]: Command end result
[0m22:37:21.446473 [info ] [MainThread]: 
[0m22:37:21.468272 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m22:37:21.473605 [info ] [MainThread]: 
[0m22:37:21.489924 [error] [MainThread]: [33mDatabase Error in model dim_datetime (models/transform/dim_datetime.sql)[0m
[0m22:37:21.493443 [error] [MainThread]:   Syntax error: Expected ")" but got ";" at [40:18]
[0m22:37:21.507500 [error] [MainThread]:   compiled Code at target/run/retail/models/transform/dim_datetime.sql
[0m22:37:21.511378 [info ] [MainThread]: 
[0m22:37:21.523387 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=1 TOTAL=4
[0m22:37:21.527187 [debug] [MainThread]: Command `dbt run` failed at 22:37:21.526800 after 17.98 seconds
[0m22:37:21.536394 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff4d808cf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff4d808c490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff4d8429dd0>]}
[0m22:37:21.538609 [debug] [MainThread]: Flushing usage events
[0m22:38:34.683442 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fec7b4bac90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fec7b077c90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fec7d0b6d90>]}


============================== 22:38:34.692337 | 12c7ec07-5339-4f04-be18-01226eeddb17 ==============================
[0m22:38:34.692337 [info ] [MainThread]: Running with dbt=1.5.9
[0m22:38:34.695488 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'warn_error': 'None', 'profiles_dir': '/usr/local/airflow/include/dbt/', 'static_parser': 'True', 'cache_selected_only': 'False', 'log_format': 'default', 'fail_fast': 'False', 'write_json': 'True', 'version_check': 'True', 'log_path': '/usr/local/airflow/include/dbt/logs', 'indirect_selection': 'eager', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_cache_events': 'False', 'introspect': 'True', 'debug': 'False', 'quiet': 'False', 'no_print': 'None', 'printer_width': '80'}
[0m22:38:35.499288 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '12c7ec07-5339-4f04-be18-01226eeddb17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fec792eba50>]}
[0m22:38:35.536375 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '12c7ec07-5339-4f04-be18-01226eeddb17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fec7b3e2710>]}
[0m22:38:35.538921 [info ] [MainThread]: Registered adapter: bigquery=1.5.3
[0m22:38:35.604623 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m22:38:37.022183 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 4 files changed.
[0m22:38:37.025056 [debug] [MainThread]: Partial parsing: updated file: retail://models/transform/dim_datetime.sql
[0m22:38:37.027536 [debug] [MainThread]: Partial parsing: updated file: retail://models/transform/fct_invoices.sql
[0m22:38:37.029940 [debug] [MainThread]: Partial parsing: updated file: retail://models/transform/dim_customer.sql
[0m22:38:37.032265 [debug] [MainThread]: Partial parsing: updated file: retail://models/transform/dim_product.sql
[0m22:38:37.125355 [debug] [MainThread]: 1699: static parser successfully parsed transform/dim_datetime.sql
[0m22:38:37.180447 [debug] [MainThread]: 1603: static parser failed on transform/fct_invoices.sql
[0m22:38:37.264337 [debug] [MainThread]: 1602: parser fallback to jinja rendering on transform/fct_invoices.sql
[0m22:38:37.278806 [debug] [MainThread]: 1603: static parser failed on transform/dim_customer.sql
[0m22:38:37.307127 [debug] [MainThread]: 1602: parser fallback to jinja rendering on transform/dim_customer.sql
[0m22:38:37.316524 [debug] [MainThread]: 1603: static parser failed on transform/dim_product.sql
[0m22:38:37.351500 [debug] [MainThread]: 1602: parser fallback to jinja rendering on transform/dim_product.sql
[0m22:38:37.411804 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '12c7ec07-5339-4f04-be18-01226eeddb17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fec790f5cd0>]}
[0m22:38:37.483128 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '12c7ec07-5339-4f04-be18-01226eeddb17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fec79145950>]}
[0m22:38:37.486061 [info ] [MainThread]: Found 4 models, 0 tests, 0 snapshots, 0 analyses, 474 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics, 0 groups
[0m22:38:37.492167 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '12c7ec07-5339-4f04-be18-01226eeddb17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fec7e593c50>]}
[0m22:38:37.499107 [info ] [MainThread]: 
[0m22:38:37.511458 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:38:37.517461 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sapient-cycling-413017'
[0m22:38:37.520126 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:38:38.503202 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017, now list_sapient-cycling-413017_retail)
[0m22:38:38.505217 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:38:39.587578 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '12c7ec07-5339-4f04-be18-01226eeddb17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fec7c298390>]}
[0m22:38:39.594368 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:38:39.601156 [info ] [MainThread]: 
[0m22:38:39.683766 [debug] [Thread-1 (]: Began running node model.retail.dim_customer
[0m22:38:39.686254 [info ] [Thread-1 (]: 1 of 4 START sql table model retail.dim_customer ............................... [RUN]
[0m22:38:39.691303 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017_retail, now model.retail.dim_customer)
[0m22:38:39.695170 [debug] [Thread-1 (]: Began compiling node model.retail.dim_customer
[0m22:38:39.754481 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_customer"
[0m22:38:39.771790 [debug] [Thread-1 (]: Timing info for model.retail.dim_customer (compile): 22:38:39.697085 => 22:38:39.770738
[0m22:38:39.774424 [debug] [Thread-1 (]: Began executing node model.retail.dim_customer
[0m22:38:39.828615 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:38:41.003926 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_customer"
[0m22:38:41.017043 [debug] [Thread-1 (]: On model.retail.dim_customer: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_customer"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_customer`
    
    

    OPTIONS()
    as (
      -- dim_customer.sql

-- Create the dimension table
WITH customer_cte AS (
	SELECT DISTINCT
	    to_hex(md5(cast(coalesce(cast(CustomerID as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Country as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as customer_id,
	    Country AS country
	FROM `sapient-cycling-413017`.`retail`.`raw_invoices`
	WHERE CustomerID IS NOT NULL
)
SELECT
    t.*,
	cm.iso
FROM customer_cte t
LEFT JOIN `sapient-cycling-413017`.`retail`.`country` cm ON t.country = cm.nicename
    );
  
[0m22:38:44.497878 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:2dd3fa03-d35c-49a9-89f0-de216037a05f&page=queryresults
[0m22:38:44.571978 [debug] [Thread-1 (]: Timing info for model.retail.dim_customer (execute): 22:38:39.777098 => 22:38:44.571185
[0m22:38:44.584527 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '12c7ec07-5339-4f04-be18-01226eeddb17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fec79181ad0>]}
[0m22:38:44.594341 [info ] [Thread-1 (]: 1 of 4 OK created sql table model retail.dim_customer .......................... [[32mCREATE TABLE (4.4k rows, 11.1 MiB processed)[0m in 4.89s]
[0m22:38:44.613467 [debug] [Thread-1 (]: Finished running node model.retail.dim_customer
[0m22:38:44.619095 [debug] [Thread-1 (]: Began running node model.retail.dim_datetime
[0m22:38:44.622527 [info ] [Thread-1 (]: 2 of 4 START sql table model retail.dim_datetime ............................... [RUN]
[0m22:38:44.631029 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_customer, now model.retail.dim_datetime)
[0m22:38:44.635585 [debug] [Thread-1 (]: Began compiling node model.retail.dim_datetime
[0m22:38:44.653439 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_datetime"
[0m22:38:44.675864 [debug] [Thread-1 (]: Timing info for model.retail.dim_datetime (compile): 22:38:44.639160 => 22:38:44.674898
[0m22:38:44.686291 [debug] [Thread-1 (]: Began executing node model.retail.dim_datetime
[0m22:38:44.699442 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_datetime"
[0m22:38:44.712163 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:38:44.721231 [debug] [Thread-1 (]: On model.retail.dim_datetime: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_datetime"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_datetime`
    
    

    OPTIONS()
    as (
      -- dim_datetime.sql

-- Create a CTE to extract date and time components
WITH datetime_cte AS (  
  SELECT DISTINCT
    InvoiceDate AS datetime_id,
    CASE
      WHEN LENGTH(InvoiceDate) = 16 THEN
        -- Date format: "DD/MM/YYYY HH:MM"
        PARSE_DATETIME('%m/%d/%Y %H:%M', InvoiceDate)
      WHEN LENGTH(InvoiceDate) <= 14 THEN
        -- Date format: "MM/DD/YY HH:MM"
        PARSE_DATETIME('%m/%d/%y %H:%M', InvoiceDate)
      ELSE
        NULL
    END AS date_part,
  FROM `sapient-cycling-413017`.`retail`.`raw_invoices`
  WHERE InvoiceDate IS NOT NULL
)
SELECT
  datetime_id,
  date_part as datetime,
  EXTRACT(YEAR FROM date_part) AS year,
  EXTRACT(MONTH FROM date_part) AS month,
  EXTRACT(DAY FROM date_part) AS day,
  EXTRACT(HOUR FROM date_part) AS hour,
  EXTRACT(MINUTE FROM date_part) AS minute,
  EXTRACT(DAYOFWEEK FROM date_part) AS weekday
FROM datetime_cte
    );
  
[0m22:38:46.783759 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('No matching signature for function LENGTH for argument types: TIMESTAMP. Supported signatures: LENGTH(STRING); LENGTH(BYTES) at [19:12]; reason: invalidQuery, location: query, message: No matching signature for function LENGTH for argument types: TIMESTAMP. Supported signatures: LENGTH(STRING); LENGTH(BYTES) at [19:12]')
[0m22:38:48.736706 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:02cb54d1-2b77-436a-be2c-649ff0be43b2&page=queryresults
[0m22:38:48.751711 [debug] [Thread-1 (]: Timing info for model.retail.dim_datetime (execute): 22:38:44.688397 => 22:38:48.749867
[0m22:38:48.792275 [debug] [Thread-1 (]: Database Error in model dim_datetime (models/transform/dim_datetime.sql)
  No matching signature for function LENGTH for argument types: TIMESTAMP. Supported signatures: LENGTH(STRING); LENGTH(BYTES) at [19:12]
  compiled Code at target/run/retail/models/transform/dim_datetime.sql
[0m22:38:48.797758 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '12c7ec07-5339-4f04-be18-01226eeddb17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fec79059410>]}
[0m22:38:48.801741 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model retail.dim_datetime ...................... [[31mERROR[0m in 4.17s]
[0m22:38:48.808231 [debug] [Thread-1 (]: Finished running node model.retail.dim_datetime
[0m22:38:48.815604 [debug] [Thread-1 (]: Began running node model.retail.dim_product
[0m22:38:48.819406 [info ] [Thread-1 (]: 3 of 4 START sql table model retail.dim_product ................................ [RUN]
[0m22:38:48.830797 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_datetime, now model.retail.dim_product)
[0m22:38:48.838783 [debug] [Thread-1 (]: Began compiling node model.retail.dim_product
[0m22:38:48.891449 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_product"
[0m22:38:48.908061 [debug] [Thread-1 (]: Timing info for model.retail.dim_product (compile): 22:38:48.841942 => 22:38:48.907134
[0m22:38:48.910963 [debug] [Thread-1 (]: Began executing node model.retail.dim_product
[0m22:38:48.918845 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:38:49.960952 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_product"
[0m22:38:49.978857 [debug] [Thread-1 (]: On model.retail.dim_product: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_product"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_product`
    
    

    OPTIONS()
    as (
      -- dim_product.sql
-- StockCode isn't unique, a product with the same id can have different and prices
-- Create the dimension table
SELECT DISTINCT
    to_hex(md5(cast(coalesce(cast(StockCode as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Description as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(UnitPrice as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as product_id,
		StockCode AS stock_code,
    Description AS description,
    UnitPrice AS price
FROM `sapient-cycling-413017`.`retail`.`raw_invoices`
WHERE StockCode IS NOT NULL
AND UnitPrice > 0
    );
  
[0m22:39:00.507676 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:876bf165-aaa6-4f69-a1cc-48b17e89fd6d&page=queryresults
[0m22:39:00.533188 [debug] [Thread-1 (]: Timing info for model.retail.dim_product (execute): 22:38:48.912993 => 22:39:00.531203
[0m22:39:00.539848 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '12c7ec07-5339-4f04-be18-01226eeddb17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fec78649b50>]}
[0m22:39:00.544122 [info ] [Thread-1 (]: 3 of 4 OK created sql table model retail.dim_product ........................... [[32mCREATE TABLE (16.3k rows, 22.6 MiB processed)[0m in 11.71s]
[0m22:39:00.557851 [debug] [Thread-1 (]: Finished running node model.retail.dim_product
[0m22:39:00.565407 [debug] [Thread-1 (]: Began running node model.retail.fct_invoices
[0m22:39:00.568114 [info ] [Thread-1 (]: 4 of 4 SKIP relation retail.fct_invoices ....................................... [[33mSKIP[0m]
[0m22:39:00.576401 [debug] [Thread-1 (]: Finished running node model.retail.fct_invoices
[0m22:39:00.586070 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:39:00.589001 [debug] [MainThread]: Connection 'model.retail.dim_product' was properly closed.
[0m22:39:00.591087 [info ] [MainThread]: 
[0m22:39:00.601884 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 23.09 seconds (23.09s).
[0m22:39:00.612919 [debug] [MainThread]: Command end result
[0m22:39:00.679853 [info ] [MainThread]: 
[0m22:39:00.686289 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m22:39:00.699615 [info ] [MainThread]: 
[0m22:39:00.703649 [error] [MainThread]: [33mDatabase Error in model dim_datetime (models/transform/dim_datetime.sql)[0m
[0m22:39:00.710804 [error] [MainThread]:   No matching signature for function LENGTH for argument types: TIMESTAMP. Supported signatures: LENGTH(STRING); LENGTH(BYTES) at [19:12]
[0m22:39:00.717620 [error] [MainThread]:   compiled Code at target/run/retail/models/transform/dim_datetime.sql
[0m22:39:00.720482 [info ] [MainThread]: 
[0m22:39:00.725189 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=1 TOTAL=4
[0m22:39:00.732872 [debug] [MainThread]: Command `dbt run` failed at 22:39:00.732028 after 26.09 seconds
[0m22:39:00.734556 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fec7b6cd010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fec7b3c8c90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fec7b693550>]}
[0m22:39:00.736314 [debug] [MainThread]: Flushing usage events
[0m22:39:20.816482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa805a1f1d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa805a1f510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa8056eb210>]}


============================== 22:39:20.826308 | 266bb270-7619-47d3-8ee7-58b280fdd2e3 ==============================
[0m22:39:20.826308 [info ] [MainThread]: Running with dbt=1.5.9
[0m22:39:20.830851 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'profiles_dir': '/usr/local/airflow/include/dbt/', 'quiet': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'debug': 'False', 'static_parser': 'True', 'write_json': 'True', 'fail_fast': 'False', 'partial_parse': 'True', 'log_path': '/usr/local/airflow/include/dbt/logs', 'send_anonymous_usage_stats': 'True', 'version_check': 'True', 'warn_error': 'None', 'introspect': 'True', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'use_experimental_parser': 'False', 'target_path': 'None', 'no_print': 'None', 'printer_width': '80', 'log_cache_events': 'False'}
[0m22:39:21.958449 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '266bb270-7619-47d3-8ee7-58b280fdd2e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa80333cb90>]}
[0m22:39:22.018759 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '266bb270-7619-47d3-8ee7-58b280fdd2e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa80331fd90>]}
[0m22:39:22.021293 [info ] [MainThread]: Registered adapter: bigquery=1.5.3
[0m22:39:22.105265 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m22:39:23.421396 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:39:23.423526 [debug] [MainThread]: Partial parsing: updated file: retail://models/transform/dim_datetime.sql
[0m22:39:23.479146 [debug] [MainThread]: 1699: static parser successfully parsed transform/dim_datetime.sql
[0m22:39:23.537495 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '266bb270-7619-47d3-8ee7-58b280fdd2e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa803336690>]}
[0m22:39:23.571935 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '266bb270-7619-47d3-8ee7-58b280fdd2e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa803250b10>]}
[0m22:39:23.574591 [info ] [MainThread]: Found 4 models, 0 tests, 0 snapshots, 0 analyses, 474 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics, 0 groups
[0m22:39:23.577493 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '266bb270-7619-47d3-8ee7-58b280fdd2e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa8087a8190>]}
[0m22:39:23.583426 [info ] [MainThread]: 
[0m22:39:23.587580 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:39:23.595011 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sapient-cycling-413017'
[0m22:39:23.602896 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:39:24.689024 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017, now list_sapient-cycling-413017_retail)
[0m22:39:24.694435 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:39:25.728644 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '266bb270-7619-47d3-8ee7-58b280fdd2e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa803e70150>]}
[0m22:39:25.731383 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:39:25.734618 [info ] [MainThread]: 
[0m22:39:25.799723 [debug] [Thread-1 (]: Began running node model.retail.dim_customer
[0m22:39:25.801673 [info ] [Thread-1 (]: 1 of 4 START sql table model retail.dim_customer ............................... [RUN]
[0m22:39:25.805519 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017_retail, now model.retail.dim_customer)
[0m22:39:25.808699 [debug] [Thread-1 (]: Began compiling node model.retail.dim_customer
[0m22:39:25.869206 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_customer"
[0m22:39:25.879402 [debug] [Thread-1 (]: Timing info for model.retail.dim_customer (compile): 22:39:25.810467 => 22:39:25.878598
[0m22:39:25.881002 [debug] [Thread-1 (]: Began executing node model.retail.dim_customer
[0m22:39:25.910554 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:39:27.152664 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_customer"
[0m22:39:27.172420 [debug] [Thread-1 (]: On model.retail.dim_customer: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_customer"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_customer`
    
    

    OPTIONS()
    as (
      -- dim_customer.sql

-- Create the dimension table
WITH customer_cte AS (
	SELECT DISTINCT
	    to_hex(md5(cast(coalesce(cast(CustomerID as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Country as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as customer_id,
	    Country AS country
	FROM `sapient-cycling-413017`.`retail`.`raw_invoices`
	WHERE CustomerID IS NOT NULL
)
SELECT
    t.*,
	cm.iso
FROM customer_cte t
LEFT JOIN `sapient-cycling-413017`.`retail`.`country` cm ON t.country = cm.nicename
    );
  
[0m22:39:30.955111 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:b1cfebf0-3db9-4dde-9824-da9dd1a4c4c3&page=queryresults
[0m22:39:31.020590 [debug] [Thread-1 (]: Timing info for model.retail.dim_customer (execute): 22:39:25.882275 => 22:39:31.020117
[0m22:39:31.023088 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '266bb270-7619-47d3-8ee7-58b280fdd2e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa8033ef8d0>]}
[0m22:39:31.025588 [info ] [Thread-1 (]: 1 of 4 OK created sql table model retail.dim_customer .......................... [[32mCREATE TABLE (4.4k rows, 11.1 MiB processed)[0m in 5.22s]
[0m22:39:31.030991 [debug] [Thread-1 (]: Finished running node model.retail.dim_customer
[0m22:39:31.033552 [debug] [Thread-1 (]: Began running node model.retail.dim_datetime
[0m22:39:31.035738 [info ] [Thread-1 (]: 2 of 4 START sql table model retail.dim_datetime ............................... [RUN]
[0m22:39:31.039074 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_customer, now model.retail.dim_datetime)
[0m22:39:31.041768 [debug] [Thread-1 (]: Began compiling node model.retail.dim_datetime
[0m22:39:31.080183 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_datetime"
[0m22:39:31.095295 [debug] [Thread-1 (]: Timing info for model.retail.dim_datetime (compile): 22:39:31.043795 => 22:39:31.094465
[0m22:39:31.097659 [debug] [Thread-1 (]: Began executing node model.retail.dim_datetime
[0m22:39:31.106413 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_datetime"
[0m22:39:31.118861 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:39:31.127782 [debug] [Thread-1 (]: On model.retail.dim_datetime: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_datetime"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_datetime`
    
    

    OPTIONS()
    as (
      -- dim_datetime.sql

-- Create a CTE to extract date and time components
WITH datetime_cte AS (  
  SELECT DISTINCT
    InvoiceDate AS datetime_id,
    CASE
      WHEN FORMAT_DATETIME('%d/%m/%Y %H:%M', PARSE_DATETIME('%m/%d/%Y %H:%M', InvoiceDate)) IS NOT NULL THEN
        -- Date format: "DD/MM/YYYY HH:MM"
        PARSE_DATETIME('%d/%m/%Y %H:%M', InvoiceDate)
      WHEN FORMAT_DATETIME('%d/%m/%Y %H:%M', PARSE_DATETIME('%m/%d/%y %H:%M', InvoiceDate)) IS NOT NULL THEN
        -- Date format: "MM/DD/YY HH:MM"
        PARSE_DATETIME('%m/%d/%y %H:%M', InvoiceDate)
      ELSE
        NULL
    END AS date_part
  FROM `sapient-cycling-413017`.`retail`.`raw_invoices`
  WHERE InvoiceDate IS NOT NULL
)
SELECT
  datetime_id,
  date_part AS datetime,
  EXTRACT(YEAR FROM date_part) AS year,
  EXTRACT(MONTH FROM date_part) AS month,
  EXTRACT(DAY FROM date_part) AS day,
  EXTRACT(HOUR FROM date_part) AS hour,
  EXTRACT(MINUTE FROM date_part) AS minute,
  EXTRACT(DAYOFWEEK FROM date_part) AS weekday
FROM datetime_cte;
    );
  
[0m22:39:32.095228 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected ")" but got ";" at [40:18]; reason: invalidQuery, location: query, message: Syntax error: Expected ")" but got ";" at [40:18]')
[0m22:39:33.478961 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:aa1611e7-12f1-4533-98fd-1066a315eb4b&page=queryresults
[0m22:39:33.501911 [debug] [Thread-1 (]: Timing info for model.retail.dim_datetime (execute): 22:39:31.099205 => 22:39:33.499005
[0m22:39:33.544733 [debug] [Thread-1 (]: Database Error in model dim_datetime (models/transform/dim_datetime.sql)
  Syntax error: Expected ")" but got ";" at [40:18]
  compiled Code at target/run/retail/models/transform/dim_datetime.sql
[0m22:39:33.547344 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '266bb270-7619-47d3-8ee7-58b280fdd2e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa8033b99d0>]}
[0m22:39:33.550244 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model retail.dim_datetime ...................... [[31mERROR[0m in 2.51s]
[0m22:39:33.558592 [debug] [Thread-1 (]: Finished running node model.retail.dim_datetime
[0m22:39:33.562480 [debug] [Thread-1 (]: Began running node model.retail.dim_product
[0m22:39:33.565216 [info ] [Thread-1 (]: 3 of 4 START sql table model retail.dim_product ................................ [RUN]
[0m22:39:33.570594 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_datetime, now model.retail.dim_product)
[0m22:39:33.573182 [debug] [Thread-1 (]: Began compiling node model.retail.dim_product
[0m22:39:33.596246 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_product"
[0m22:39:33.607561 [debug] [Thread-1 (]: Timing info for model.retail.dim_product (compile): 22:39:33.577079 => 22:39:33.606641
[0m22:39:33.610376 [debug] [Thread-1 (]: Began executing node model.retail.dim_product
[0m22:39:33.615748 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:39:34.751492 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_product"
[0m22:39:34.789615 [debug] [Thread-1 (]: On model.retail.dim_product: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_product"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_product`
    
    

    OPTIONS()
    as (
      -- dim_product.sql
-- StockCode isn't unique, a product with the same id can have different and prices
-- Create the dimension table
SELECT DISTINCT
    to_hex(md5(cast(coalesce(cast(StockCode as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Description as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(UnitPrice as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as product_id,
		StockCode AS stock_code,
    Description AS description,
    UnitPrice AS price
FROM `sapient-cycling-413017`.`retail`.`raw_invoices`
WHERE StockCode IS NOT NULL
AND UnitPrice > 0
    );
  
[0m22:39:39.175025 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:73c16c26-cc9f-48df-a738-eecc3ec9e52b&page=queryresults
[0m22:39:39.193367 [debug] [Thread-1 (]: Timing info for model.retail.dim_product (execute): 22:39:33.612032 => 22:39:39.192000
[0m22:39:39.200302 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '266bb270-7619-47d3-8ee7-58b280fdd2e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa8034078d0>]}
[0m22:39:39.206698 [info ] [Thread-1 (]: 3 of 4 OK created sql table model retail.dim_product ........................... [[32mCREATE TABLE (16.3k rows, 22.6 MiB processed)[0m in 5.63s]
[0m22:39:39.223843 [debug] [Thread-1 (]: Finished running node model.retail.dim_product
[0m22:39:39.233446 [debug] [Thread-1 (]: Began running node model.retail.fct_invoices
[0m22:39:39.241470 [info ] [Thread-1 (]: 4 of 4 SKIP relation retail.fct_invoices ....................................... [[33mSKIP[0m]
[0m22:39:39.280243 [debug] [Thread-1 (]: Finished running node model.retail.fct_invoices
[0m22:39:39.292454 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:39:39.297324 [debug] [MainThread]: Connection 'model.retail.dim_product' was properly closed.
[0m22:39:39.310813 [info ] [MainThread]: 
[0m22:39:39.315301 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 15.72 seconds (15.72s).
[0m22:39:39.321879 [debug] [MainThread]: Command end result
[0m22:39:39.540727 [info ] [MainThread]: 
[0m22:39:39.595419 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m22:39:39.647693 [info ] [MainThread]: 
[0m22:39:39.695479 [error] [MainThread]: [33mDatabase Error in model dim_datetime (models/transform/dim_datetime.sql)[0m
[0m22:39:39.707640 [error] [MainThread]:   Syntax error: Expected ")" but got ";" at [40:18]
[0m22:39:39.723539 [error] [MainThread]:   compiled Code at target/run/retail/models/transform/dim_datetime.sql
[0m22:39:39.736114 [info ] [MainThread]: 
[0m22:39:39.751558 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=1 TOTAL=4
[0m22:39:39.769825 [debug] [MainThread]: Command `dbt run` failed at 22:39:39.769232 after 18.99 seconds
[0m22:39:39.786168 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa80529bf90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa8055b3610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa80572a410>]}
[0m22:39:39.795716 [debug] [MainThread]: Flushing usage events
[0m22:40:09.462862 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe28f35fcd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe28f35f090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe28f35fb90>]}


============================== 22:40:09.471608 | dfa5a699-4b9e-4964-9eda-6abd8bf0f764 ==============================
[0m22:40:09.471608 [info ] [MainThread]: Running with dbt=1.5.9
[0m22:40:09.475419 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'printer_width': '80', 'indirect_selection': 'eager', 'log_path': '/usr/local/airflow/include/dbt/logs', 'write_json': 'True', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'partial_parse': 'True', 'log_cache_events': 'False', 'debug': 'False', 'profiles_dir': '/usr/local/airflow/include/dbt/', 'introspect': 'True', 'warn_error': 'None', 'cache_selected_only': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'quiet': 'False', 'fail_fast': 'False', 'log_format': 'default'}
[0m22:40:10.437917 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dfa5a699-4b9e-4964-9eda-6abd8bf0f764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe28d5e7f90>]}
[0m22:40:10.485789 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dfa5a699-4b9e-4964-9eda-6abd8bf0f764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe28df6e490>]}
[0m22:40:10.488647 [info ] [MainThread]: Registered adapter: bigquery=1.5.3
[0m22:40:10.578269 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m22:40:11.887104 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:40:11.889019 [debug] [MainThread]: Partial parsing: updated file: retail://models/transform/dim_datetime.sql
[0m22:40:11.939111 [debug] [MainThread]: 1699: static parser successfully parsed transform/dim_datetime.sql
[0m22:40:12.007278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dfa5a699-4b9e-4964-9eda-6abd8bf0f764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe28d615e10>]}
[0m22:40:12.039288 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dfa5a699-4b9e-4964-9eda-6abd8bf0f764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe28d3450d0>]}
[0m22:40:12.041767 [info ] [MainThread]: Found 4 models, 0 tests, 0 snapshots, 0 analyses, 474 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics, 0 groups
[0m22:40:12.044551 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dfa5a699-4b9e-4964-9eda-6abd8bf0f764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe2928afb90>]}
[0m22:40:12.051428 [info ] [MainThread]: 
[0m22:40:12.056328 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:40:12.060317 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sapient-cycling-413017'
[0m22:40:12.062344 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:40:12.946896 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017, now list_sapient-cycling-413017_retail)
[0m22:40:12.948767 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:40:13.936768 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dfa5a699-4b9e-4964-9eda-6abd8bf0f764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe28f803650>]}
[0m22:40:13.944506 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:40:13.951891 [info ] [MainThread]: 
[0m22:40:14.033416 [debug] [Thread-1 (]: Began running node model.retail.dim_customer
[0m22:40:14.036324 [info ] [Thread-1 (]: 1 of 4 START sql table model retail.dim_customer ............................... [RUN]
[0m22:40:14.042840 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017_retail, now model.retail.dim_customer)
[0m22:40:14.045709 [debug] [Thread-1 (]: Began compiling node model.retail.dim_customer
[0m22:40:14.103729 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_customer"
[0m22:40:14.114985 [debug] [Thread-1 (]: Timing info for model.retail.dim_customer (compile): 22:40:14.048040 => 22:40:14.114256
[0m22:40:14.116721 [debug] [Thread-1 (]: Began executing node model.retail.dim_customer
[0m22:40:14.146305 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:40:15.420017 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_customer"
[0m22:40:15.433253 [debug] [Thread-1 (]: On model.retail.dim_customer: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_customer"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_customer`
    
    

    OPTIONS()
    as (
      -- dim_customer.sql

-- Create the dimension table
WITH customer_cte AS (
	SELECT DISTINCT
	    to_hex(md5(cast(coalesce(cast(CustomerID as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Country as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as customer_id,
	    Country AS country
	FROM `sapient-cycling-413017`.`retail`.`raw_invoices`
	WHERE CustomerID IS NOT NULL
)
SELECT
    t.*,
	cm.iso
FROM customer_cte t
LEFT JOIN `sapient-cycling-413017`.`retail`.`country` cm ON t.country = cm.nicename
    );
  
[0m22:40:19.410791 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:f29fcdf5-294d-4835-852b-8b578c318827&page=queryresults
[0m22:40:19.450046 [debug] [Thread-1 (]: Timing info for model.retail.dim_customer (execute): 22:40:14.118011 => 22:40:19.449587
[0m22:40:19.452844 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dfa5a699-4b9e-4964-9eda-6abd8bf0f764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe28d49cf90>]}
[0m22:40:19.455273 [info ] [Thread-1 (]: 1 of 4 OK created sql table model retail.dim_customer .......................... [[32mCREATE TABLE (4.4k rows, 11.1 MiB processed)[0m in 5.41s]
[0m22:40:19.459622 [debug] [Thread-1 (]: Finished running node model.retail.dim_customer
[0m22:40:19.462835 [debug] [Thread-1 (]: Began running node model.retail.dim_datetime
[0m22:40:19.465129 [info ] [Thread-1 (]: 2 of 4 START sql table model retail.dim_datetime ............................... [RUN]
[0m22:40:19.469241 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_customer, now model.retail.dim_datetime)
[0m22:40:19.471926 [debug] [Thread-1 (]: Began compiling node model.retail.dim_datetime
[0m22:40:19.512163 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_datetime"
[0m22:40:19.530088 [debug] [Thread-1 (]: Timing info for model.retail.dim_datetime (compile): 22:40:19.474550 => 22:40:19.529435
[0m22:40:19.532343 [debug] [Thread-1 (]: Began executing node model.retail.dim_datetime
[0m22:40:19.544134 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_datetime"
[0m22:40:19.558503 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:40:19.568486 [debug] [Thread-1 (]: On model.retail.dim_datetime: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_datetime"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_datetime`
    
    

    OPTIONS()
    as (
      -- dim_datetime.sql

-- Create a CTE to extract date and time components
WITH datetime_cte AS (  
  SELECT DISTINCT
    InvoiceDate AS datetime_id,
    CASE
      WHEN FORMAT_DATETIME('%d/%m/%Y %H:%M', PARSE_DATETIME('%m/%d/%Y %H:%M', InvoiceDate)) IS NOT NULL THEN
        -- Date format: "DD/MM/YYYY HH:MM"
        PARSE_DATETIME('%d/%m/%Y %H:%M', InvoiceDate)
      WHEN FORMAT_DATETIME('%d/%m/%Y %H:%M', PARSE_DATETIME('%m/%d/%y %H:%M', InvoiceDate)) IS NOT NULL THEN
        -- Date format: "MM/DD/YY HH:MM"
        PARSE_DATETIME('%d/%m/%Y %H:%M', InvoiceDate)
      ELSE
        NULL
    END AS date_part
  FROM `sapient-cycling-413017`.`retail`.`raw_invoices`
  WHERE InvoiceDate IS NOT NULL
)
SELECT
  datetime_id,
  date_part AS datetime,
  EXTRACT(YEAR FROM TIMESTAMP(date_part)) AS year,
  EXTRACT(MONTH FROM TIMESTAMP(date_part)) AS month,
  EXTRACT(DAY FROM TIMESTAMP(date_part)) AS day,
  EXTRACT(HOUR FROM TIMESTAMP(date_part)) AS hour,
  EXTRACT(MINUTE FROM TIMESTAMP(date_part)) AS minute,
  EXTRACT(DAYOFWEEK FROM TIMESTAMP(date_part)) AS weekday
FROM datetime_cte;
    );
  
[0m22:40:20.653698 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected ")" but got ";" at [40:18]; reason: invalidQuery, location: query, message: Syntax error: Expected ")" but got ";" at [40:18]')
[0m22:40:22.004121 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:8b65e65b-a9da-4419-be8f-cda5598fdd28&page=queryresults
[0m22:40:22.009975 [debug] [Thread-1 (]: Timing info for model.retail.dim_datetime (execute): 22:40:19.534261 => 22:40:22.008995
[0m22:40:22.024475 [debug] [Thread-1 (]: Database Error in model dim_datetime (models/transform/dim_datetime.sql)
  Syntax error: Expected ")" but got ";" at [40:18]
  compiled Code at target/run/retail/models/transform/dim_datetime.sql
[0m22:40:22.026530 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dfa5a699-4b9e-4964-9eda-6abd8bf0f764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe28d46cc50>]}
[0m22:40:22.028649 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model retail.dim_datetime ...................... [[31mERROR[0m in 2.56s]
[0m22:40:22.039905 [debug] [Thread-1 (]: Finished running node model.retail.dim_datetime
[0m22:40:22.042862 [debug] [Thread-1 (]: Began running node model.retail.dim_product
[0m22:40:22.045601 [info ] [Thread-1 (]: 3 of 4 START sql table model retail.dim_product ................................ [RUN]
[0m22:40:22.049560 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_datetime, now model.retail.dim_product)
[0m22:40:22.051759 [debug] [Thread-1 (]: Began compiling node model.retail.dim_product
[0m22:40:22.068889 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_product"
[0m22:40:22.082898 [debug] [Thread-1 (]: Timing info for model.retail.dim_product (compile): 22:40:22.053513 => 22:40:22.082250
[0m22:40:22.084584 [debug] [Thread-1 (]: Began executing node model.retail.dim_product
[0m22:40:22.090900 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:40:23.214602 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_product"
[0m22:40:23.251513 [debug] [Thread-1 (]: On model.retail.dim_product: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_product"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_product`
    
    

    OPTIONS()
    as (
      -- dim_product.sql
-- StockCode isn't unique, a product with the same id can have different and prices
-- Create the dimension table
SELECT DISTINCT
    to_hex(md5(cast(coalesce(cast(StockCode as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Description as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(UnitPrice as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as product_id,
		StockCode AS stock_code,
    Description AS description,
    UnitPrice AS price
FROM `sapient-cycling-413017`.`retail`.`raw_invoices`
WHERE StockCode IS NOT NULL
AND UnitPrice > 0
    );
  
[0m22:40:27.500673 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:4d86f286-022d-41c6-8448-19455919b5bd&page=queryresults
[0m22:40:27.506370 [debug] [Thread-1 (]: Timing info for model.retail.dim_product (execute): 22:40:22.085908 => 22:40:27.505897
[0m22:40:27.509168 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dfa5a699-4b9e-4964-9eda-6abd8bf0f764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe28d4b9010>]}
[0m22:40:27.511868 [info ] [Thread-1 (]: 3 of 4 OK created sql table model retail.dim_product ........................... [[32mCREATE TABLE (16.3k rows, 22.6 MiB processed)[0m in 5.46s]
[0m22:40:27.516319 [debug] [Thread-1 (]: Finished running node model.retail.dim_product
[0m22:40:27.520168 [debug] [Thread-1 (]: Began running node model.retail.fct_invoices
[0m22:40:27.522621 [info ] [Thread-1 (]: 4 of 4 SKIP relation retail.fct_invoices ....................................... [[33mSKIP[0m]
[0m22:40:27.525299 [debug] [Thread-1 (]: Finished running node model.retail.fct_invoices
[0m22:40:27.531399 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:40:27.533414 [debug] [MainThread]: Connection 'model.retail.dim_product' was properly closed.
[0m22:40:27.535550 [info ] [MainThread]: 
[0m22:40:27.543678 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 15.48 seconds (15.48s).
[0m22:40:27.548585 [debug] [MainThread]: Command end result
[0m22:40:27.613869 [info ] [MainThread]: 
[0m22:40:27.618449 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m22:40:27.622279 [info ] [MainThread]: 
[0m22:40:27.636833 [error] [MainThread]: [33mDatabase Error in model dim_datetime (models/transform/dim_datetime.sql)[0m
[0m22:40:27.648708 [error] [MainThread]:   Syntax error: Expected ")" but got ";" at [40:18]
[0m22:40:27.658212 [error] [MainThread]:   compiled Code at target/run/retail/models/transform/dim_datetime.sql
[0m22:40:27.676122 [info ] [MainThread]: 
[0m22:40:27.689935 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=1 TOTAL=4
[0m22:40:27.701595 [debug] [MainThread]: Command `dbt run` failed at 22:40:27.700891 after 18.28 seconds
[0m22:40:27.707940 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe28f35f490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe28fae7010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe29384d9d0>]}
[0m22:40:27.715704 [debug] [MainThread]: Flushing usage events
[0m22:41:40.586079 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67eb5c2cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67eb9017d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67eb92cb90>]}


============================== 22:41:40.594800 | af669d80-ac17-4280-b5d6-0f328628533a ==============================
[0m22:41:40.594800 [info ] [MainThread]: Running with dbt=1.5.9
[0m22:41:40.599900 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'warn_error': 'None', 'introspect': 'True', 'profiles_dir': '/usr/local/airflow/include/dbt/', 'log_format': 'default', 'version_check': 'True', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'partial_parse': 'True', 'debug': 'False', 'fail_fast': 'False', 'target_path': 'None', 'static_parser': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'log_path': '/usr/local/airflow/include/dbt/logs', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'write_json': 'True'}
[0m22:41:41.485515 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'af669d80-ac17-4280-b5d6-0f328628533a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67e9d44190>]}
[0m22:41:41.534468 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'af669d80-ac17-4280-b5d6-0f328628533a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67e92109d0>]}
[0m22:41:41.537079 [info ] [MainThread]: Registered adapter: bigquery=1.5.3
[0m22:41:41.598762 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m22:41:43.153569 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:41:43.155183 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:41:43.166301 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'af669d80-ac17-4280-b5d6-0f328628533a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67e922ac50>]}
[0m22:41:43.195987 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'af669d80-ac17-4280-b5d6-0f328628533a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67e9265310>]}
[0m22:41:43.198446 [info ] [MainThread]: Found 4 models, 0 tests, 0 snapshots, 0 analyses, 474 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics, 0 groups
[0m22:41:43.201060 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'af669d80-ac17-4280-b5d6-0f328628533a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67ee69bc50>]}
[0m22:41:43.206630 [info ] [MainThread]: 
[0m22:41:43.218004 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:41:43.224299 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sapient-cycling-413017'
[0m22:41:43.225797 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:41:44.158727 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017, now list_sapient-cycling-413017_retail)
[0m22:41:44.165036 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:41:45.342567 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'af669d80-ac17-4280-b5d6-0f328628533a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67ec3a0310>]}
[0m22:41:45.350168 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:41:45.361940 [info ] [MainThread]: 
[0m22:41:45.449624 [debug] [Thread-1 (]: Began running node model.retail.dim_customer
[0m22:41:45.455292 [info ] [Thread-1 (]: 1 of 4 START sql table model retail.dim_customer ............................... [RUN]
[0m22:41:45.460260 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017_retail, now model.retail.dim_customer)
[0m22:41:45.464198 [debug] [Thread-1 (]: Began compiling node model.retail.dim_customer
[0m22:41:45.528019 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_customer"
[0m22:41:45.538201 [debug] [Thread-1 (]: Timing info for model.retail.dim_customer (compile): 22:41:45.467097 => 22:41:45.537624
[0m22:41:45.539749 [debug] [Thread-1 (]: Began executing node model.retail.dim_customer
[0m22:41:45.569161 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:41:46.779434 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_customer"
[0m22:41:46.796722 [debug] [Thread-1 (]: On model.retail.dim_customer: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_customer"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_customer`
    
    

    OPTIONS()
    as (
      -- dim_customer.sql

-- Create the dimension table
WITH customer_cte AS (
	SELECT DISTINCT
	    to_hex(md5(cast(coalesce(cast(CustomerID as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Country as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as customer_id,
	    Country AS country
	FROM `sapient-cycling-413017`.`retail`.`raw_invoices`
	WHERE CustomerID IS NOT NULL
)
SELECT
    t.*,
	cm.iso
FROM customer_cte t
LEFT JOIN `sapient-cycling-413017`.`retail`.`country` cm ON t.country = cm.nicename
    );
  
[0m22:41:51.470875 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:274a851f-eea2-47b7-8f41-87acf2c361f2&page=queryresults
[0m22:41:51.515088 [debug] [Thread-1 (]: Timing info for model.retail.dim_customer (execute): 22:41:45.540915 => 22:41:51.514606
[0m22:41:51.519221 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'af669d80-ac17-4280-b5d6-0f328628533a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67e92673d0>]}
[0m22:41:51.521519 [info ] [Thread-1 (]: 1 of 4 OK created sql table model retail.dim_customer .......................... [[32mCREATE TABLE (4.4k rows, 11.1 MiB processed)[0m in 6.06s]
[0m22:41:51.525935 [debug] [Thread-1 (]: Finished running node model.retail.dim_customer
[0m22:41:51.528922 [debug] [Thread-1 (]: Began running node model.retail.dim_datetime
[0m22:41:51.531393 [info ] [Thread-1 (]: 2 of 4 START sql table model retail.dim_datetime ............................... [RUN]
[0m22:41:51.535278 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_customer, now model.retail.dim_datetime)
[0m22:41:51.541288 [debug] [Thread-1 (]: Began compiling node model.retail.dim_datetime
[0m22:41:51.550363 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_datetime"
[0m22:41:51.567763 [debug] [Thread-1 (]: Timing info for model.retail.dim_datetime (compile): 22:41:51.544394 => 22:41:51.566687
[0m22:41:51.570652 [debug] [Thread-1 (]: Began executing node model.retail.dim_datetime
[0m22:41:51.598314 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_datetime"
[0m22:41:51.612525 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:41:51.622227 [debug] [Thread-1 (]: On model.retail.dim_datetime: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_datetime"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_datetime`
    
    

    OPTIONS()
    as (
      -- dim_datetime.sql

-- Create a CTE to extract date and time components
WITH datetime_cte AS (  
  SELECT DISTINCT
    InvoiceDate AS datetime_id,
    CASE
      WHEN FORMAT_DATETIME('%d/%m/%Y %H:%M', PARSE_DATETIME('%m/%d/%Y %H:%M', InvoiceDate)) IS NOT NULL THEN
        -- Date format: "DD/MM/YYYY HH:MM"
        PARSE_DATETIME('%d/%m/%Y %H:%M', InvoiceDate)
      WHEN FORMAT_DATETIME('%d/%m/%Y %H:%M', PARSE_DATETIME('%m/%d/%y %H:%M', InvoiceDate)) IS NOT NULL THEN
        -- Date format: "MM/DD/YY HH:MM"
        PARSE_DATETIME('%d/%m/%Y %H:%M', InvoiceDate)
      ELSE
        NULL
    END AS date_part
  FROM `sapient-cycling-413017`.`retail`.`raw_invoices`
  WHERE InvoiceDate IS NOT NULL
)
SELECT
  datetime_id,
  date_part AS datetime,
  EXTRACT(YEAR FROM TIMESTAMP(date_part)) AS year,
  EXTRACT(MONTH FROM TIMESTAMP(date_part)) AS month,
  EXTRACT(DAY FROM TIMESTAMP(date_part)) AS day,
  EXTRACT(HOUR FROM TIMESTAMP(date_part)) AS hour,
  EXTRACT(MINUTE FROM TIMESTAMP(date_part)) AS minute,
  EXTRACT(DAYOFWEEK FROM TIMESTAMP(date_part)) AS weekday
FROM datetime_cte;
    );
  
[0m22:41:52.574507 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected ")" but got ";" at [40:18]; reason: invalidQuery, location: query, message: Syntax error: Expected ")" but got ";" at [40:18]')
[0m22:41:53.728501 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:52a61ad5-f24e-4671-8ea5-be61d7470dee&page=queryresults
[0m22:41:53.742159 [debug] [Thread-1 (]: Timing info for model.retail.dim_datetime (execute): 22:41:51.572929 => 22:41:53.741227
[0m22:41:53.757856 [debug] [Thread-1 (]: Database Error in model dim_datetime (models/transform/dim_datetime.sql)
  Syntax error: Expected ")" but got ";" at [40:18]
  compiled Code at target/run/retail/models/transform/dim_datetime.sql
[0m22:41:53.761040 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'af669d80-ac17-4280-b5d6-0f328628533a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67e91572d0>]}
[0m22:41:53.767949 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model retail.dim_datetime ...................... [[31mERROR[0m in 2.23s]
[0m22:41:53.774443 [debug] [Thread-1 (]: Finished running node model.retail.dim_datetime
[0m22:41:53.776989 [debug] [Thread-1 (]: Began running node model.retail.dim_product
[0m22:41:53.779155 [info ] [Thread-1 (]: 3 of 4 START sql table model retail.dim_product ................................ [RUN]
[0m22:41:53.783594 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_datetime, now model.retail.dim_product)
[0m22:41:53.787764 [debug] [Thread-1 (]: Began compiling node model.retail.dim_product
[0m22:41:53.811861 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_product"
[0m22:41:53.828510 [debug] [Thread-1 (]: Timing info for model.retail.dim_product (compile): 22:41:53.794269 => 22:41:53.827681
[0m22:41:53.830481 [debug] [Thread-1 (]: Began executing node model.retail.dim_product
[0m22:41:53.837524 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:41:54.974957 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_product"
[0m22:41:55.000358 [debug] [Thread-1 (]: On model.retail.dim_product: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_product"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_product`
    
    

    OPTIONS()
    as (
      -- dim_product.sql
-- StockCode isn't unique, a product with the same id can have different and prices
-- Create the dimension table
SELECT DISTINCT
    to_hex(md5(cast(coalesce(cast(StockCode as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Description as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(UnitPrice as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as product_id,
		StockCode AS stock_code,
    Description AS description,
    UnitPrice AS price
FROM `sapient-cycling-413017`.`retail`.`raw_invoices`
WHERE StockCode IS NOT NULL
AND UnitPrice > 0
    );
  
[0m22:41:59.164436 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:c75a2a0a-f064-46a2-b1df-e1861cf2044b&page=queryresults
[0m22:41:59.186640 [debug] [Thread-1 (]: Timing info for model.retail.dim_product (execute): 22:41:53.831984 => 22:41:59.184499
[0m22:41:59.193307 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'af669d80-ac17-4280-b5d6-0f328628533a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67e9160410>]}
[0m22:41:59.202038 [info ] [Thread-1 (]: 3 of 4 OK created sql table model retail.dim_product ........................... [[32mCREATE TABLE (16.3k rows, 22.6 MiB processed)[0m in 5.41s]
[0m22:41:59.229329 [debug] [Thread-1 (]: Finished running node model.retail.dim_product
[0m22:41:59.250268 [debug] [Thread-1 (]: Began running node model.retail.fct_invoices
[0m22:41:59.260281 [info ] [Thread-1 (]: 4 of 4 SKIP relation retail.fct_invoices ....................................... [[33mSKIP[0m]
[0m22:41:59.281418 [debug] [Thread-1 (]: Finished running node model.retail.fct_invoices
[0m22:41:59.291121 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:41:59.293989 [debug] [MainThread]: Connection 'model.retail.dim_product' was properly closed.
[0m22:41:59.295642 [info ] [MainThread]: 
[0m22:41:59.298367 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 16.08 seconds (16.08s).
[0m22:41:59.308961 [debug] [MainThread]: Command end result
[0m22:41:59.352817 [info ] [MainThread]: 
[0m22:41:59.357919 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m22:41:59.362204 [info ] [MainThread]: 
[0m22:41:59.376456 [error] [MainThread]: [33mDatabase Error in model dim_datetime (models/transform/dim_datetime.sql)[0m
[0m22:41:59.382420 [error] [MainThread]:   Syntax error: Expected ")" but got ";" at [40:18]
[0m22:41:59.395223 [error] [MainThread]:   compiled Code at target/run/retail/models/transform/dim_datetime.sql
[0m22:41:59.399457 [info ] [MainThread]: 
[0m22:41:59.405933 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=1 TOTAL=4
[0m22:41:59.413635 [debug] [MainThread]: Command `dbt run` failed at 22:41:59.413111 after 18.86 seconds
[0m22:41:59.416554 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67ebbe1bd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67eb918c90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67eb5c2ed0>]}
[0m22:41:59.419351 [debug] [MainThread]: Flushing usage events
[0m22:43:20.320837 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe09e84a290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe09eb724d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe09e3b2910>]}


============================== 22:43:20.329651 | c3ac7037-052e-4ec3-8968-d086998bdf57 ==============================
[0m22:43:20.329651 [info ] [MainThread]: Running with dbt=1.5.9
[0m22:43:20.333082 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'log_format': 'default', 'profiles_dir': '/usr/local/airflow/include/dbt/', 'cache_selected_only': 'False', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'indirect_selection': 'eager', 'introspect': 'True', 'use_colors': 'True', 'version_check': 'True', 'no_print': 'None', 'printer_width': '80', 'use_experimental_parser': 'False', 'static_parser': 'True', 'partial_parse': 'True', 'fail_fast': 'False', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'log_cache_events': 'False', 'log_path': '/usr/local/airflow/include/dbt/logs', 'debug': 'False'}
[0m22:43:21.204610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c3ac7037-052e-4ec3-8968-d086998bdf57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe09e3cd0d0>]}
[0m22:43:21.242772 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c3ac7037-052e-4ec3-8968-d086998bdf57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe09c63bdd0>]}
[0m22:43:21.244877 [info ] [MainThread]: Registered adapter: bigquery=1.5.3
[0m22:43:21.320666 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m22:43:22.600507 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:43:22.602509 [debug] [MainThread]: Partial parsing: updated file: retail://models/transform/dim_datetime.sql
[0m22:43:22.674034 [debug] [MainThread]: 1699: static parser successfully parsed transform/dim_datetime.sql
[0m22:43:22.736571 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c3ac7037-052e-4ec3-8968-d086998bdf57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe09c4defd0>]}
[0m22:43:22.773798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c3ac7037-052e-4ec3-8968-d086998bdf57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe09c3b60d0>]}
[0m22:43:22.776539 [info ] [MainThread]: Found 4 models, 0 tests, 0 snapshots, 0 analyses, 474 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics, 0 groups
[0m22:43:22.779812 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c3ac7037-052e-4ec3-8968-d086998bdf57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe09c46a750>]}
[0m22:43:22.793559 [info ] [MainThread]: 
[0m22:43:22.798240 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:43:22.805797 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sapient-cycling-413017'
[0m22:43:22.808831 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:43:23.952626 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017, now list_sapient-cycling-413017_retail)
[0m22:43:23.958735 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:43:25.056861 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c3ac7037-052e-4ec3-8968-d086998bdf57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe09c46a610>]}
[0m22:43:25.063882 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:43:25.072682 [info ] [MainThread]: 
[0m22:43:25.155780 [debug] [Thread-1 (]: Began running node model.retail.dim_customer
[0m22:43:25.159915 [info ] [Thread-1 (]: 1 of 4 START sql table model retail.dim_customer ............................... [RUN]
[0m22:43:25.168392 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017_retail, now model.retail.dim_customer)
[0m22:43:25.174600 [debug] [Thread-1 (]: Began compiling node model.retail.dim_customer
[0m22:43:25.265482 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_customer"
[0m22:43:25.289773 [debug] [Thread-1 (]: Timing info for model.retail.dim_customer (compile): 22:43:25.178786 => 22:43:25.288228
[0m22:43:25.293655 [debug] [Thread-1 (]: Began executing node model.retail.dim_customer
[0m22:43:25.347679 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:43:26.568835 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_customer"
[0m22:43:26.581254 [debug] [Thread-1 (]: On model.retail.dim_customer: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_customer"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_customer`
    
    

    OPTIONS()
    as (
      -- dim_customer.sql

-- Create the dimension table
WITH customer_cte AS (
	SELECT DISTINCT
	    to_hex(md5(cast(coalesce(cast(CustomerID as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Country as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as customer_id,
	    Country AS country
	FROM `sapient-cycling-413017`.`retail`.`raw_invoices`
	WHERE CustomerID IS NOT NULL
)
SELECT
    t.*,
	cm.iso
FROM customer_cte t
LEFT JOIN `sapient-cycling-413017`.`retail`.`country` cm ON t.country = cm.nicename
    );
  
[0m22:43:29.995117 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:a7149e04-51c5-4de5-9d78-8b2fe908584c&page=queryresults
[0m22:43:30.073365 [debug] [Thread-1 (]: Timing info for model.retail.dim_customer (execute): 22:43:25.296775 => 22:43:30.072559
[0m22:43:30.076842 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c3ac7037-052e-4ec3-8968-d086998bdf57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe09c4550d0>]}
[0m22:43:30.088182 [info ] [Thread-1 (]: 1 of 4 OK created sql table model retail.dim_customer .......................... [[32mCREATE TABLE (4.4k rows, 11.1 MiB processed)[0m in 4.91s]
[0m22:43:30.092815 [debug] [Thread-1 (]: Finished running node model.retail.dim_customer
[0m22:43:30.096331 [debug] [Thread-1 (]: Began running node model.retail.dim_datetime
[0m22:43:30.100430 [info ] [Thread-1 (]: 2 of 4 START sql table model retail.dim_datetime ............................... [RUN]
[0m22:43:30.105437 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_customer, now model.retail.dim_datetime)
[0m22:43:30.111736 [debug] [Thread-1 (]: Began compiling node model.retail.dim_datetime
[0m22:43:30.161697 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_datetime"
[0m22:43:30.178790 [debug] [Thread-1 (]: Timing info for model.retail.dim_datetime (compile): 22:43:30.118547 => 22:43:30.177976
[0m22:43:30.182276 [debug] [Thread-1 (]: Began executing node model.retail.dim_datetime
[0m22:43:30.202891 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_datetime"
[0m22:43:30.255856 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:43:30.300624 [debug] [Thread-1 (]: On model.retail.dim_datetime: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_datetime"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_datetime`
    
    

    OPTIONS()
    as (
      WITH datetime_cte AS (  
  SELECT DISTINCT
    InvoiceDate AS datetime_id,
    CASE
      WHEN LENGTH(InvoiceDate) = 16 THEN
        -- Date format: "DD/MM/YYYY HH:MM"
        PARSE_DATETIME('%m/%d/%Y %H:%M', InvoiceDate)
      WHEN LENGTH(InvoiceDate) <= 14 THEN
        -- Date format: "MM/DD/YY HH:MM"
        PARSE_DATETIME('%m/%d/%y %H:%M', InvoiceDate)
      ELSE
        NULL
    END AS date_part,
  FROM `sapient-cycling-413017`.`retail`.`raw_invoices`
  WHERE InvoiceDate IS NOT NULL
)
SELECT
  datetime_id,
  date_part as datetime,
  EXTRACT(YEAR FROM date_part) AS year,
  EXTRACT(MONTH FROM date_part) AS month,
  EXTRACT(DAY FROM date_part) AS day,
  EXTRACT(HOUR FROM date_part) AS hour,
  EXTRACT(MINUTE FROM date_part) AS minute,
  EXTRACT(DAYOFWEEK FROM date_part) AS weekday
FROM datetime_cte
    );
  
[0m22:43:32.555009 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('No matching signature for function LENGTH for argument types: TIMESTAMP. Supported signatures: LENGTH(STRING); LENGTH(BYTES) at [16:12]; reason: invalidQuery, location: query, message: No matching signature for function LENGTH for argument types: TIMESTAMP. Supported signatures: LENGTH(STRING); LENGTH(BYTES) at [16:12]')
[0m22:43:34.708150 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:d0711b66-aded-420b-b1b8-d2ec19621a88&page=queryresults
[0m22:43:34.713264 [debug] [Thread-1 (]: Timing info for model.retail.dim_datetime (execute): 22:43:30.184256 => 22:43:34.712280
[0m22:43:34.725441 [debug] [Thread-1 (]: Database Error in model dim_datetime (models/transform/dim_datetime.sql)
  No matching signature for function LENGTH for argument types: TIMESTAMP. Supported signatures: LENGTH(STRING); LENGTH(BYTES) at [16:12]
  compiled Code at target/run/retail/models/transform/dim_datetime.sql
[0m22:43:34.729001 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c3ac7037-052e-4ec3-8968-d086998bdf57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe09c4179d0>]}
[0m22:43:34.735926 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model retail.dim_datetime ...................... [[31mERROR[0m in 4.62s]
[0m22:43:34.742504 [debug] [Thread-1 (]: Finished running node model.retail.dim_datetime
[0m22:43:34.746495 [debug] [Thread-1 (]: Began running node model.retail.dim_product
[0m22:43:34.752074 [info ] [Thread-1 (]: 3 of 4 START sql table model retail.dim_product ................................ [RUN]
[0m22:43:34.762717 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_datetime, now model.retail.dim_product)
[0m22:43:34.769878 [debug] [Thread-1 (]: Began compiling node model.retail.dim_product
[0m22:43:34.801184 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_product"
[0m22:43:34.946132 [debug] [Thread-1 (]: Timing info for model.retail.dim_product (compile): 22:43:34.773274 => 22:43:34.945082
[0m22:43:34.948703 [debug] [Thread-1 (]: Began executing node model.retail.dim_product
[0m22:43:34.955351 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:43:36.242049 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_product"
[0m22:43:36.286097 [debug] [Thread-1 (]: On model.retail.dim_product: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_product"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_product`
    
    

    OPTIONS()
    as (
      -- dim_product.sql
-- StockCode isn't unique, a product with the same id can have different and prices
-- Create the dimension table
SELECT DISTINCT
    to_hex(md5(cast(coalesce(cast(StockCode as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Description as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(UnitPrice as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as product_id,
		StockCode AS stock_code,
    Description AS description,
    UnitPrice AS price
FROM `sapient-cycling-413017`.`retail`.`raw_invoices`
WHERE StockCode IS NOT NULL
AND UnitPrice > 0
    );
  
[0m22:43:40.252093 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:ae2790d2-f20a-4af8-b4ac-1319902896f2&page=queryresults
[0m22:43:40.262391 [debug] [Thread-1 (]: Timing info for model.retail.dim_product (execute): 22:43:34.950647 => 22:43:40.261676
[0m22:43:40.265651 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c3ac7037-052e-4ec3-8968-d086998bdf57', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe09c4e5390>]}
[0m22:43:40.271806 [info ] [Thread-1 (]: 3 of 4 OK created sql table model retail.dim_product ........................... [[32mCREATE TABLE (16.3k rows, 22.6 MiB processed)[0m in 5.50s]
[0m22:43:40.276370 [debug] [Thread-1 (]: Finished running node model.retail.dim_product
[0m22:43:40.281614 [debug] [Thread-1 (]: Began running node model.retail.fct_invoices
[0m22:43:40.286030 [info ] [Thread-1 (]: 4 of 4 SKIP relation retail.fct_invoices ....................................... [[33mSKIP[0m]
[0m22:43:40.293981 [debug] [Thread-1 (]: Finished running node model.retail.fct_invoices
[0m22:43:40.302686 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:43:40.304665 [debug] [MainThread]: Connection 'model.retail.dim_product' was properly closed.
[0m22:43:40.306539 [info ] [MainThread]: 
[0m22:43:40.309718 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 17.51 seconds (17.51s).
[0m22:43:40.320677 [debug] [MainThread]: Command end result
[0m22:43:40.378673 [info ] [MainThread]: 
[0m22:43:40.387290 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m22:43:40.390341 [info ] [MainThread]: 
[0m22:43:40.393684 [error] [MainThread]: [33mDatabase Error in model dim_datetime (models/transform/dim_datetime.sql)[0m
[0m22:43:40.406170 [error] [MainThread]:   No matching signature for function LENGTH for argument types: TIMESTAMP. Supported signatures: LENGTH(STRING); LENGTH(BYTES) at [16:12]
[0m22:43:40.410070 [error] [MainThread]:   compiled Code at target/run/retail/models/transform/dim_datetime.sql
[0m22:43:40.412761 [info ] [MainThread]: 
[0m22:43:40.416637 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=1 TOTAL=4
[0m22:43:40.423522 [debug] [MainThread]: Command `dbt run` failed at 22:43:40.423009 after 20.15 seconds
[0m22:43:40.435266 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe09eb72210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe09eb48c90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe09c5e2950>]}
[0m22:43:40.440109 [debug] [MainThread]: Flushing usage events
[0m22:46:08.645269 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4cab3eaad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4cab3dd8d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4cab6e5110>]}


============================== 22:46:08.654487 | 7eca8d32-d84f-4f5b-8c80-6719f25eeabd ==============================
[0m22:46:08.654487 [info ] [MainThread]: Running with dbt=1.5.9
[0m22:46:08.657974 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'version_check': 'True', 'static_parser': 'True', 'cache_selected_only': 'False', 'quiet': 'False', 'target_path': 'None', 'log_path': '/usr/local/airflow/include/dbt/logs', 'printer_width': '80', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'profiles_dir': '/usr/local/airflow/include/dbt/', 'partial_parse': 'True', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'debug': 'False', 'log_format': 'default', 'write_json': 'True', 'fail_fast': 'False', 'warn_error': 'None', 'introspect': 'True', 'indirect_selection': 'eager'}
[0m22:46:09.415876 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7eca8d32-d84f-4f5b-8c80-6719f25eeabd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4caaf74750>]}
[0m22:46:09.448592 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7eca8d32-d84f-4f5b-8c80-6719f25eeabd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4ca8edbf50>]}
[0m22:46:09.451569 [info ] [MainThread]: Registered adapter: bigquery=1.5.3
[0m22:46:09.516217 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m22:46:11.003134 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:46:11.005170 [debug] [MainThread]: Partial parsing: updated file: retail://models/transform/dim_datetime.sql
[0m22:46:11.059080 [debug] [MainThread]: 1699: static parser successfully parsed transform/dim_datetime.sql
[0m22:46:11.123087 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7eca8d32-d84f-4f5b-8c80-6719f25eeabd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4ca8d40350>]}
[0m22:46:11.154961 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7eca8d32-d84f-4f5b-8c80-6719f25eeabd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4ca8de0290>]}
[0m22:46:11.157354 [info ] [MainThread]: Found 4 models, 0 tests, 0 snapshots, 0 analyses, 474 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics, 0 groups
[0m22:46:11.160453 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7eca8d32-d84f-4f5b-8c80-6719f25eeabd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4cae183c10>]}
[0m22:46:11.165581 [info ] [MainThread]: 
[0m22:46:11.169597 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:46:11.177269 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sapient-cycling-413017'
[0m22:46:11.182477 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:46:12.298889 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017, now list_sapient-cycling-413017_retail)
[0m22:46:12.306535 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:46:13.442783 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7eca8d32-d84f-4f5b-8c80-6719f25eeabd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4cabe88410>]}
[0m22:46:13.450506 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:46:13.461274 [info ] [MainThread]: 
[0m22:46:13.546165 [debug] [Thread-1 (]: Began running node model.retail.dim_customer
[0m22:46:13.549357 [info ] [Thread-1 (]: 1 of 4 START sql table model retail.dim_customer ............................... [RUN]
[0m22:46:13.556696 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017_retail, now model.retail.dim_customer)
[0m22:46:13.561533 [debug] [Thread-1 (]: Began compiling node model.retail.dim_customer
[0m22:46:13.646927 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_customer"
[0m22:46:13.658447 [debug] [Thread-1 (]: Timing info for model.retail.dim_customer (compile): 22:46:13.564160 => 22:46:13.657838
[0m22:46:13.660309 [debug] [Thread-1 (]: Began executing node model.retail.dim_customer
[0m22:46:13.692850 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:46:14.943477 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_customer"
[0m22:46:14.955897 [debug] [Thread-1 (]: On model.retail.dim_customer: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_customer"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_customer`
    
    

    OPTIONS()
    as (
      -- dim_customer.sql

-- Create the dimension table
WITH customer_cte AS (
	SELECT DISTINCT
	    to_hex(md5(cast(coalesce(cast(CustomerID as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Country as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as customer_id,
	    Country AS country
	FROM `sapient-cycling-413017`.`retail`.`raw_invoices`
	WHERE CustomerID IS NOT NULL
)
SELECT
    t.*,
	cm.iso
FROM customer_cte t
LEFT JOIN `sapient-cycling-413017`.`retail`.`country` cm ON t.country = cm.nicename
    );
  
[0m22:46:27.569751 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:6275e3d2-66c9-4326-a306-3f05795ce5d9&page=queryresults
[0m22:46:27.652559 [debug] [Thread-1 (]: Timing info for model.retail.dim_customer (execute): 22:46:13.661655 => 22:46:27.651792
[0m22:46:27.655863 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7eca8d32-d84f-4f5b-8c80-6719f25eeabd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4ca8cdc950>]}
[0m22:46:27.658427 [info ] [Thread-1 (]: 1 of 4 OK created sql table model retail.dim_customer .......................... [[32mCREATE TABLE (4.4k rows, 11.1 MiB processed)[0m in 14.10s]
[0m22:46:27.662223 [debug] [Thread-1 (]: Finished running node model.retail.dim_customer
[0m22:46:27.664792 [debug] [Thread-1 (]: Began running node model.retail.dim_datetime
[0m22:46:27.666906 [info ] [Thread-1 (]: 2 of 4 START sql table model retail.dim_datetime ............................... [RUN]
[0m22:46:27.670883 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_customer, now model.retail.dim_datetime)
[0m22:46:27.673494 [debug] [Thread-1 (]: Began compiling node model.retail.dim_datetime
[0m22:46:27.709397 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_datetime"
[0m22:46:27.723964 [debug] [Thread-1 (]: Timing info for model.retail.dim_datetime (compile): 22:46:27.676139 => 22:46:27.722956
[0m22:46:27.726958 [debug] [Thread-1 (]: Began executing node model.retail.dim_datetime
[0m22:46:27.734873 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_datetime"
[0m22:46:27.749168 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:46:27.759026 [debug] [Thread-1 (]: On model.retail.dim_datetime: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_datetime"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_datetime`
    
    

    OPTIONS()
    as (
      WITH datetime_cte AS (  
  SELECT DISTINCT
    InvoiceDate AS datetime_id,
    CASE
    
      WHEN LENGTH(FORMAT_TIMESTAMP('%Y-%m-%d %H:%M:%S', InvoiceDate)) = 16 THEN
        -- Date format: "DD/MM/YYYY HH:MM"
        PARSE_DATETIME('%m/%d/%Y %H:%M', InvoiceDate)
      WHEN LENGTH(FORMAT_TIMESTAMP('%Y-%m-%d %H:%M:%S', InvoiceDate)) <= 14 THEN
        -- Date format: "MM/DD/YY HH:MM"
        PARSE_DATETIME('%m/%d/%y %H:%M', InvoiceDate)
      ELSE
        NULL
    END AS date_part,
  FROM `sapient-cycling-413017`.`retail`.`raw_invoices`
  WHERE InvoiceDate IS NOT NULL
)
SELECT
  datetime_id,
  date_part as datetime,
  EXTRACT(YEAR FROM date_part) AS year,
  EXTRACT(MONTH FROM date_part) AS month,
  EXTRACT(DAY FROM date_part) AS day,
  EXTRACT(HOUR FROM date_part) AS hour,
  EXTRACT(MINUTE FROM date_part) AS minute,
  EXTRACT(DAYOFWEEK FROM date_part) AS weekday
FROM datetime_cte
    );
  
[0m22:46:29.723858 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('No matching signature for function PARSE_DATETIME for argument types: STRING, TIMESTAMP. Supported signature: PARSE_DATETIME(STRING, STRING) at [19:9]; reason: invalidQuery, location: query, message: No matching signature for function PARSE_DATETIME for argument types: STRING, TIMESTAMP. Supported signature: PARSE_DATETIME(STRING, STRING) at [19:9]')
[0m22:46:31.259322 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:e8672cd2-09cc-4b28-b23e-5f423c96fd16&page=queryresults
[0m22:46:31.263731 [debug] [Thread-1 (]: Timing info for model.retail.dim_datetime (execute): 22:46:27.728891 => 22:46:31.262722
[0m22:46:31.275941 [debug] [Thread-1 (]: Database Error in model dim_datetime (models/transform/dim_datetime.sql)
  No matching signature for function PARSE_DATETIME for argument types: STRING, TIMESTAMP. Supported signature: PARSE_DATETIME(STRING, STRING) at [19:9]
  compiled Code at target/run/retail/models/transform/dim_datetime.sql
[0m22:46:31.280193 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7eca8d32-d84f-4f5b-8c80-6719f25eeabd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4ca8d1fd10>]}
[0m22:46:31.283896 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model retail.dim_datetime ...................... [[31mERROR[0m in 3.61s]
[0m22:46:31.294550 [debug] [Thread-1 (]: Finished running node model.retail.dim_datetime
[0m22:46:31.299027 [debug] [Thread-1 (]: Began running node model.retail.dim_product
[0m22:46:31.301542 [info ] [Thread-1 (]: 3 of 4 START sql table model retail.dim_product ................................ [RUN]
[0m22:46:31.307826 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_datetime, now model.retail.dim_product)
[0m22:46:31.311010 [debug] [Thread-1 (]: Began compiling node model.retail.dim_product
[0m22:46:31.329980 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_product"
[0m22:46:31.349058 [debug] [Thread-1 (]: Timing info for model.retail.dim_product (compile): 22:46:31.313431 => 22:46:31.348222
[0m22:46:31.351355 [debug] [Thread-1 (]: Began executing node model.retail.dim_product
[0m22:46:31.360971 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:46:32.460486 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_product"
[0m22:46:32.480466 [debug] [Thread-1 (]: On model.retail.dim_product: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_product"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_product`
    
    

    OPTIONS()
    as (
      -- dim_product.sql
-- StockCode isn't unique, a product with the same id can have different and prices
-- Create the dimension table
SELECT DISTINCT
    to_hex(md5(cast(coalesce(cast(StockCode as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Description as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(UnitPrice as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as product_id,
		StockCode AS stock_code,
    Description AS description,
    UnitPrice AS price
FROM `sapient-cycling-413017`.`retail`.`raw_invoices`
WHERE StockCode IS NOT NULL
AND UnitPrice > 0
    );
  
[0m22:46:36.509918 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:08cc996f-720f-4380-b8d4-0346c2bec40b&page=queryresults
[0m22:46:36.528620 [debug] [Thread-1 (]: Timing info for model.retail.dim_product (execute): 22:46:31.353153 => 22:46:36.527406
[0m22:46:36.535939 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7eca8d32-d84f-4f5b-8c80-6719f25eeabd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4ca830d7d0>]}
[0m22:46:36.542462 [info ] [Thread-1 (]: 3 of 4 OK created sql table model retail.dim_product ........................... [[32mCREATE TABLE (16.3k rows, 22.6 MiB processed)[0m in 5.23s]
[0m22:46:36.560404 [debug] [Thread-1 (]: Finished running node model.retail.dim_product
[0m22:46:36.571691 [debug] [Thread-1 (]: Began running node model.retail.fct_invoices
[0m22:46:36.580566 [info ] [Thread-1 (]: 4 of 4 SKIP relation retail.fct_invoices ....................................... [[33mSKIP[0m]
[0m22:46:36.595936 [debug] [Thread-1 (]: Finished running node model.retail.fct_invoices
[0m22:46:36.614456 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:46:36.620992 [debug] [MainThread]: Connection 'model.retail.dim_product' was properly closed.
[0m22:46:36.629365 [info ] [MainThread]: 
[0m22:46:36.644108 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 25.46 seconds (25.46s).
[0m22:46:36.665568 [debug] [MainThread]: Command end result
[0m22:46:36.766043 [info ] [MainThread]: 
[0m22:46:36.774327 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m22:46:36.788329 [info ] [MainThread]: 
[0m22:46:36.794608 [error] [MainThread]: [33mDatabase Error in model dim_datetime (models/transform/dim_datetime.sql)[0m
[0m22:46:36.803954 [error] [MainThread]:   No matching signature for function PARSE_DATETIME for argument types: STRING, TIMESTAMP. Supported signature: PARSE_DATETIME(STRING, STRING) at [19:9]
[0m22:46:36.809968 [error] [MainThread]:   compiled Code at target/run/retail/models/transform/dim_datetime.sql
[0m22:46:36.824341 [info ] [MainThread]: 
[0m22:46:36.835499 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=1 TOTAL=4
[0m22:46:36.839949 [debug] [MainThread]: Command `dbt run` failed at 22:46:36.839446 after 28.23 seconds
[0m22:46:36.846275 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4cac8f3c50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4cab0d6590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4caef9f390>]}
[0m22:46:36.849959 [debug] [MainThread]: Flushing usage events
[0m22:47:56.931228 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb29af90810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb29b3a2e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb29ae56690>]}


============================== 22:47:56.940097 | 1bb91fbe-2006-4dcf-ad41-9322a0ea148c ==============================
[0m22:47:56.940097 [info ] [MainThread]: Running with dbt=1.5.9
[0m22:47:56.943040 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'quiet': 'False', 'log_cache_events': 'False', 'target_path': 'None', 'warn_error': 'None', 'printer_width': '80', 'use_experimental_parser': 'False', 'debug': 'False', 'indirect_selection': 'eager', 'log_path': '/usr/local/airflow/include/dbt/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'version_check': 'True', 'fail_fast': 'False', 'introspect': 'True', 'use_colors': 'True', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'no_print': 'None', 'partial_parse': 'True', 'profiles_dir': '/usr/local/airflow/include/dbt/', 'write_json': 'True'}
[0m22:47:57.972510 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1bb91fbe-2006-4dcf-ad41-9322a0ea148c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb29a9db750>]}
[0m22:47:58.007833 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1bb91fbe-2006-4dcf-ad41-9322a0ea148c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb298d27ed0>]}
[0m22:47:58.010409 [info ] [MainThread]: Registered adapter: bigquery=1.5.3
[0m22:47:58.083400 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m22:47:59.467478 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:47:59.469514 [debug] [MainThread]: Partial parsing: updated file: retail://models/transform/dim_datetime.sql
[0m22:47:59.512551 [debug] [MainThread]: 1699: static parser successfully parsed transform/dim_datetime.sql
[0m22:47:59.567224 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1bb91fbe-2006-4dcf-ad41-9322a0ea148c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb298b656d0>]}
[0m22:47:59.604036 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1bb91fbe-2006-4dcf-ad41-9322a0ea148c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb298a4a750>]}
[0m22:47:59.606221 [info ] [MainThread]: Found 4 models, 0 tests, 0 snapshots, 0 analyses, 474 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics, 0 groups
[0m22:47:59.609465 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1bb91fbe-2006-4dcf-ad41-9322a0ea148c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb29dfdba50>]}
[0m22:47:59.615797 [info ] [MainThread]: 
[0m22:47:59.622485 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:47:59.628764 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sapient-cycling-413017'
[0m22:47:59.630836 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:48:00.646633 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017, now list_sapient-cycling-413017_retail)
[0m22:48:00.648875 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:48:01.669378 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1bb91fbe-2006-4dcf-ad41-9322a0ea148c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb29bcdbf10>]}
[0m22:48:01.671966 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:48:01.674605 [info ] [MainThread]: 
[0m22:48:01.706814 [debug] [Thread-1 (]: Began running node model.retail.dim_customer
[0m22:48:01.708938 [info ] [Thread-1 (]: 1 of 4 START sql table model retail.dim_customer ............................... [RUN]
[0m22:48:01.714447 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017_retail, now model.retail.dim_customer)
[0m22:48:01.716952 [debug] [Thread-1 (]: Began compiling node model.retail.dim_customer
[0m22:48:01.775845 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_customer"
[0m22:48:01.791821 [debug] [Thread-1 (]: Timing info for model.retail.dim_customer (compile): 22:48:01.718899 => 22:48:01.790893
[0m22:48:01.794315 [debug] [Thread-1 (]: Began executing node model.retail.dim_customer
[0m22:48:01.831836 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:48:03.139634 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_customer"
[0m22:48:03.154731 [debug] [Thread-1 (]: On model.retail.dim_customer: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_customer"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_customer`
    
    

    OPTIONS()
    as (
      -- dim_customer.sql

-- Create the dimension table
WITH customer_cte AS (
	SELECT DISTINCT
	    to_hex(md5(cast(coalesce(cast(CustomerID as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Country as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as customer_id,
	    Country AS country
	FROM `sapient-cycling-413017`.`retail`.`raw_invoices`
	WHERE CustomerID IS NOT NULL
)
SELECT
    t.*,
	cm.iso
FROM customer_cte t
LEFT JOIN `sapient-cycling-413017`.`retail`.`country` cm ON t.country = cm.nicename
    );
  
[0m22:48:06.248354 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:f19f5a28-7713-4872-a85f-5ef983ce6164&page=queryresults
[0m22:48:06.305344 [debug] [Thread-1 (]: Timing info for model.retail.dim_customer (execute): 22:48:01.796098 => 22:48:06.304677
[0m22:48:06.310879 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1bb91fbe-2006-4dcf-ad41-9322a0ea148c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb2994c4850>]}
[0m22:48:06.319391 [info ] [Thread-1 (]: 1 of 4 OK created sql table model retail.dim_customer .......................... [[32mCREATE TABLE (4.4k rows, 11.1 MiB processed)[0m in 4.60s]
[0m22:48:06.326960 [debug] [Thread-1 (]: Finished running node model.retail.dim_customer
[0m22:48:06.330290 [debug] [Thread-1 (]: Began running node model.retail.dim_datetime
[0m22:48:06.332763 [info ] [Thread-1 (]: 2 of 4 START sql table model retail.dim_datetime ............................... [RUN]
[0m22:48:06.340521 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_customer, now model.retail.dim_datetime)
[0m22:48:06.343618 [debug] [Thread-1 (]: Began compiling node model.retail.dim_datetime
[0m22:48:06.389793 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_datetime"
[0m22:48:06.419719 [debug] [Thread-1 (]: Timing info for model.retail.dim_datetime (compile): 22:48:06.345112 => 22:48:06.418793
[0m22:48:06.422064 [debug] [Thread-1 (]: Began executing node model.retail.dim_datetime
[0m22:48:06.432177 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_datetime"
[0m22:48:06.444469 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:48:06.453013 [debug] [Thread-1 (]: On model.retail.dim_datetime: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_datetime"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_datetime`
    
    

    OPTIONS()
    as (
      WITH datetime_cte AS (  
  SELECT DISTINCT
    InvoiceDate AS datetime_id,
    CASE
      WHEN LENGTH(FORMAT_TIMESTAMP('%Y-%m-%d %H:%M:%S', InvoiceDate)) = 16 THEN
        -- Date format: "DD/MM/YYYY HH:MM"
        PARSE_DATETIME('%m/%d/%Y %H:%M', FORMAT_TIMESTAMP('%Y-%m-%d %H:%M:%S', InvoiceDate))
      WHEN LENGTH(FORMAT_TIMESTAMP('%Y-%m-%d %H:%M:%S', InvoiceDate)) <= 14 THEN
        -- Date format: "MM/DD/YY HH:MM"
        PARSE_DATETIME('%m/%d/%y %H:%M', FORMAT_TIMESTAMP('%Y-%m-%d %H:%M:%S', InvoiceDate))
      ELSE
        NULL
    END AS date_part
  FROM `sapient-cycling-413017`.`retail`.`raw_invoices`
  WHERE InvoiceDate IS NOT NULL
)
SELECT
  datetime_id,
  date_part as datetime,
  EXTRACT(YEAR FROM date_part) AS year,
  EXTRACT(MONTH FROM date_part) AS month,
  EXTRACT(DAY FROM date_part) AS day,
  EXTRACT(HOUR FROM date_part) AS hour,
  EXTRACT(MINUTE FROM date_part) AS minute,
  EXTRACT(DAYOFWEEK FROM date_part) AS weekday
FROM datetime_cte
    );
  
[0m22:48:11.688143 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:0044fd7d-b27c-4f47-9137-83af027bc296&page=queryresults
[0m22:48:11.698337 [debug] [Thread-1 (]: Timing info for model.retail.dim_datetime (execute): 22:48:06.423655 => 22:48:11.697624
[0m22:48:11.701283 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1bb91fbe-2006-4dcf-ad41-9322a0ea148c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb298c01450>]}
[0m22:48:11.703690 [info ] [Thread-1 (]: 2 of 4 OK created sql table model retail.dim_datetime .......................... [[32mCREATE TABLE (23.3k rows, 4.1 MiB processed)[0m in 5.36s]
[0m22:48:11.708184 [debug] [Thread-1 (]: Finished running node model.retail.dim_datetime
[0m22:48:11.711142 [debug] [Thread-1 (]: Began running node model.retail.dim_product
[0m22:48:11.713790 [info ] [Thread-1 (]: 3 of 4 START sql table model retail.dim_product ................................ [RUN]
[0m22:48:11.718366 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_datetime, now model.retail.dim_product)
[0m22:48:11.720986 [debug] [Thread-1 (]: Began compiling node model.retail.dim_product
[0m22:48:11.742947 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_product"
[0m22:48:11.759004 [debug] [Thread-1 (]: Timing info for model.retail.dim_product (compile): 22:48:11.722820 => 22:48:11.758232
[0m22:48:11.760957 [debug] [Thread-1 (]: Began executing node model.retail.dim_product
[0m22:48:11.767045 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:48:12.920302 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_product"
[0m22:48:12.957183 [debug] [Thread-1 (]: On model.retail.dim_product: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_product"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_product`
    
    

    OPTIONS()
    as (
      -- dim_product.sql
-- StockCode isn't unique, a product with the same id can have different and prices
-- Create the dimension table
SELECT DISTINCT
    to_hex(md5(cast(coalesce(cast(StockCode as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Description as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(UnitPrice as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as product_id,
		StockCode AS stock_code,
    Description AS description,
    UnitPrice AS price
FROM `sapient-cycling-413017`.`retail`.`raw_invoices`
WHERE StockCode IS NOT NULL
AND UnitPrice > 0
    );
  
[0m22:48:16.927310 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:98ffc32f-bfea-4a59-b7aa-cff929ab3938&page=queryresults
[0m22:48:16.935126 [debug] [Thread-1 (]: Timing info for model.retail.dim_product (execute): 22:48:11.762595 => 22:48:16.934565
[0m22:48:16.942511 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1bb91fbe-2006-4dcf-ad41-9322a0ea148c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb298c02cd0>]}
[0m22:48:16.945424 [info ] [Thread-1 (]: 3 of 4 OK created sql table model retail.dim_product ........................... [[32mCREATE TABLE (16.3k rows, 22.6 MiB processed)[0m in 5.23s]
[0m22:48:16.950702 [debug] [Thread-1 (]: Finished running node model.retail.dim_product
[0m22:48:16.955565 [debug] [Thread-1 (]: Began running node model.retail.fct_invoices
[0m22:48:16.957726 [info ] [Thread-1 (]: 4 of 4 START sql table model retail.fct_invoices ............................... [RUN]
[0m22:48:16.962718 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_product, now model.retail.fct_invoices)
[0m22:48:16.965183 [debug] [Thread-1 (]: Began compiling node model.retail.fct_invoices
[0m22:48:16.994168 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.fct_invoices"
[0m22:48:17.019315 [debug] [Thread-1 (]: Timing info for model.retail.fct_invoices (compile): 22:48:16.969596 => 22:48:17.018371
[0m22:48:17.022160 [debug] [Thread-1 (]: Began executing node model.retail.fct_invoices
[0m22:48:17.030413 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.fct_invoices"
[0m22:48:17.043673 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:48:17.052237 [debug] [Thread-1 (]: On model.retail.fct_invoices: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.fct_invoices"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`fct_invoices`
    
    

    OPTIONS()
    as (
      -- fct_invoices.sql

-- Create the fact table by joining the relevant keys from dimension table
WITH fct_invoices_cte AS (
    SELECT
        InvoiceNo AS invoice_id,
        InvoiceDate AS datetime_id,
        to_hex(md5(cast(coalesce(cast(StockCode as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Description as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(UnitPrice as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as product_id,
        to_hex(md5(cast(coalesce(cast(CustomerID as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Country as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as customer_id,
        Quantity AS quantity,
        Quantity * UnitPrice AS total
    FROM `sapient-cycling-413017`.`retail`.`raw_invoices`
    WHERE Quantity > 0
)
SELECT
    invoice_id,
    dt.datetime_id,
    dp.product_id,
    dc.customer_id,
    quantity,
    total
FROM fct_invoices_cte fi
INNER JOIN `sapient-cycling-413017`.`retail`.`dim_datetime` dt ON fi.datetime_id = dt.datetime_id
INNER JOIN `sapient-cycling-413017`.`retail`.`dim_product` dp ON fi.product_id = dp.product_id
INNER JOIN `sapient-cycling-413017`.`retail`.`dim_customer` dc ON fi.customer_id = dc.customer_id
    );
  
[0m22:48:23.892015 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:ecf26a4a-5bfc-48b2-ae41-2058b4d9570e&page=queryresults
[0m22:48:23.907862 [debug] [Thread-1 (]: Timing info for model.retail.fct_invoices (execute): 22:48:17.024048 => 22:48:23.906898
[0m22:48:23.912794 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1bb91fbe-2006-4dcf-ad41-9322a0ea148c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb298b573d0>]}
[0m22:48:23.917109 [info ] [Thread-1 (]: 4 of 4 OK created sql table model retail.fct_invoices .......................... [[32mCREATE TABLE (397.9k rows, 46.9 MiB processed)[0m in 6.95s]
[0m22:48:23.928649 [debug] [Thread-1 (]: Finished running node model.retail.fct_invoices
[0m22:48:23.936129 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:48:23.938966 [debug] [MainThread]: Connection 'model.retail.fct_invoices' was properly closed.
[0m22:48:23.945289 [info ] [MainThread]: 
[0m22:48:23.952861 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 24.32 seconds (24.32s).
[0m22:48:23.962640 [debug] [MainThread]: Command end result
[0m22:48:24.174278 [info ] [MainThread]: 
[0m22:48:24.177704 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:48:24.181960 [info ] [MainThread]: 
[0m22:48:24.184815 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m22:48:24.190950 [debug] [MainThread]: Command `dbt run` succeeded at 22:48:24.190359 after 27.30 seconds
[0m22:48:24.201217 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb29b263a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb29af82290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb29aebf310>]}
[0m22:48:24.204310 [debug] [MainThread]: Flushing usage events
[0m23:37:20.338141 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd945f3550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd949770d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd948e6350>]}


============================== 23:37:20.382162 | 8d827729-5d86-4dee-8fd9-2c952d64ebf1 ==============================
[0m23:37:20.382162 [info ] [MainThread]: Running with dbt=1.5.0
[0m23:37:20.385293 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'use_experimental_parser': 'False', 'printer_width': '80', 'write_json': 'True', 'static_parser': 'True', 'no_print': 'None', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'version_check': 'True', 'profiles_dir': '/usr/local/airflow/include/dbt/', 'indirect_selection': 'eager', 'quiet': 'False', 'log_cache_events': 'False', 'introspect': 'True', 'use_colors': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'log_path': '/usr/local/airflow/include/dbt/logs', 'log_format': 'default', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True'}
[0m23:37:21.759372 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8d827729-5d86-4dee-8fd9-2c952d64ebf1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd946c1510>]}
[0m23:37:21.794169 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8d827729-5d86-4dee-8fd9-2c952d64ebf1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd7be08290>]}
[0m23:37:21.918558 [debug] [MainThread]: checksum: 4568eb639a77b8fcb3a1f4a07856f42b1ff63f1376652889143968e1dbdafbda, vars: {}, profile: , target: , version: 1.5.0
[0m23:37:22.014666 [info ] [MainThread]: Unable to do partial parsing because of a version mismatch
[0m23:37:22.018646 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '8d827729-5d86-4dee-8fd9-2c952d64ebf1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd7bd65250>]}
[0m23:37:25.717289 [debug] [MainThread]: 1699: static parser successfully parsed report/report_customer_invoices.sql
[0m23:37:25.743218 [debug] [MainThread]: 1699: static parser successfully parsed report/report_product_invoices.sql
[0m23:37:25.751180 [debug] [MainThread]: 1699: static parser successfully parsed report/report_year_invoices.sql
[0m23:37:25.760503 [debug] [MainThread]: 1603: static parser failed on transform/dim_customer.sql
[0m23:37:25.803283 [debug] [MainThread]: 1602: parser fallback to jinja rendering on transform/dim_customer.sql
[0m23:37:25.807778 [debug] [MainThread]: 1699: static parser successfully parsed transform/dim_datetime.sql
[0m23:37:25.815001 [debug] [MainThread]: 1603: static parser failed on transform/dim_product.sql
[0m23:37:25.829102 [debug] [MainThread]: 1602: parser fallback to jinja rendering on transform/dim_product.sql
[0m23:37:25.833373 [debug] [MainThread]: 1603: static parser failed on transform/fct_invoices.sql
[0m23:37:25.851727 [debug] [MainThread]: 1602: parser fallback to jinja rendering on transform/fct_invoices.sql
[0m23:37:25.998189 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8d827729-5d86-4dee-8fd9-2c952d64ebf1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd7bec05d0>]}
[0m23:37:26.036183 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8d827729-5d86-4dee-8fd9-2c952d64ebf1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd7bd5a190>]}
[0m23:37:26.038675 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 471 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics, 0 groups
[0m23:37:26.041361 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8d827729-5d86-4dee-8fd9-2c952d64ebf1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd7beb3610>]}
[0m23:37:26.051075 [info ] [MainThread]: 
[0m23:37:26.056520 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:37:26.061367 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sapient-cycling-413017'
[0m23:37:26.064069 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:37:27.251495 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017, now list_sapient-cycling-413017_retail)
[0m23:37:27.273723 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:37:28.481461 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8d827729-5d86-4dee-8fd9-2c952d64ebf1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd7be8f010>]}
[0m23:37:28.488587 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:37:28.505981 [info ] [MainThread]: 
[0m23:37:28.591272 [debug] [Thread-1 (]: Began running node model.retail.report_customer_invoices
[0m23:37:28.594532 [info ] [Thread-1 (]: 1 of 3 START sql table model retail.report_customer_invoices ................... [RUN]
[0m23:37:28.603324 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017_retail, now model.retail.report_customer_invoices)
[0m23:37:28.610003 [debug] [Thread-1 (]: Began compiling node model.retail.report_customer_invoices
[0m23:37:28.626480 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.report_customer_invoices"
[0m23:37:28.658917 [debug] [Thread-1 (]: Timing info for model.retail.report_customer_invoices (compile): 23:37:28.612332 => 23:37:28.657177
[0m23:37:28.662181 [debug] [Thread-1 (]: Began executing node model.retail.report_customer_invoices
[0m23:37:28.756539 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.report_customer_invoices"
[0m23:37:28.782139 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:37:28.840374 [debug] [Thread-1 (]: On model.retail.report_customer_invoices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.report_customer_invoices"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`report_customer_invoices`
    
    

    OPTIONS()
    as (
      SELECT
  c.country,
  c.iso,
  COUNT(fi.invoice_id) AS total_invoices,
  SUM(fi.total) AS total_revenue
FROM `sapient-cycling-413017`.`retail`.`fct_invoices` fi
JOIN `sapient-cycling-413017`.`retail`.`dim_customer` c ON fi.customer_id = c.customer_id
GROUP BY c.country, c.iso
ORDER BY total_revenue DESC
LIMIT 10
    );
  
[0m23:37:33.580010 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:60bdc01b-b5fd-40e7-9cb0-f745c79ed869&page=queryresults
[0m23:37:33.621039 [debug] [Thread-1 (]: Timing info for model.retail.report_customer_invoices (execute): 23:37:28.665158 => 23:37:33.620635
[0m23:37:33.625497 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8d827729-5d86-4dee-8fd9-2c952d64ebf1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd7becd510>]}
[0m23:37:33.628195 [info ] [Thread-1 (]: 1 of 3 OK created sql table model retail.report_customer_invoices .............. [[32mCREATE TABLE (10.0 rows, 19.2 MiB processed)[0m in 5.02s]
[0m23:37:33.631772 [debug] [Thread-1 (]: Finished running node model.retail.report_customer_invoices
[0m23:37:33.633889 [debug] [Thread-1 (]: Began running node model.retail.report_product_invoices
[0m23:37:33.635946 [info ] [Thread-1 (]: 2 of 3 START sql table model retail.report_product_invoices .................... [RUN]
[0m23:37:33.641432 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.report_customer_invoices, now model.retail.report_product_invoices)
[0m23:37:33.646545 [debug] [Thread-1 (]: Began compiling node model.retail.report_product_invoices
[0m23:37:33.657787 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.report_product_invoices"
[0m23:37:33.671826 [debug] [Thread-1 (]: Timing info for model.retail.report_product_invoices (compile): 23:37:33.649895 => 23:37:33.671169
[0m23:37:33.673484 [debug] [Thread-1 (]: Began executing node model.retail.report_product_invoices
[0m23:37:33.685986 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.report_product_invoices"
[0m23:37:33.698544 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:37:33.787266 [debug] [Thread-1 (]: On model.retail.report_product_invoices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.report_product_invoices"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`report_product_invoices`
    
    

    OPTIONS()
    as (
      SELECT
  p.product_id,
  p.stock_code,
  p.description,
  SUM(fi.quantity) AS total_quantity_sold
FROM `sapient-cycling-413017`.`retail`.`fct_invoices` fi
JOIN `sapient-cycling-413017`.`retail`.`dim_product` p ON fi.product_id = p.product_id
GROUP BY p.product_id, p.stock_code, p.description
ORDER BY total_quantity_sold DESC
LIMIT 10
    );
  
[0m23:37:38.089360 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:6477dd97-ebf5-4116-89ae-84985523d1fb&page=queryresults
[0m23:37:38.096323 [debug] [Thread-1 (]: Timing info for model.retail.report_product_invoices (execute): 23:37:33.674818 => 23:37:38.095393
[0m23:37:38.099418 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8d827729-5d86-4dee-8fd9-2c952d64ebf1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd7bff5a50>]}
[0m23:37:38.102811 [info ] [Thread-1 (]: 2 of 3 OK created sql table model retail.report_product_invoices ............... [[32mCREATE TABLE (10.0 rows, 17.0 MiB processed)[0m in 4.46s]
[0m23:37:38.108177 [debug] [Thread-1 (]: Finished running node model.retail.report_product_invoices
[0m23:37:38.114185 [debug] [Thread-1 (]: Began running node model.retail.report_year_invoices
[0m23:37:38.117041 [info ] [Thread-1 (]: 3 of 3 START sql table model retail.report_year_invoices ....................... [RUN]
[0m23:37:38.125382 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.report_product_invoices, now model.retail.report_year_invoices)
[0m23:37:38.128713 [debug] [Thread-1 (]: Began compiling node model.retail.report_year_invoices
[0m23:37:38.139769 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.report_year_invoices"
[0m23:37:38.154060 [debug] [Thread-1 (]: Timing info for model.retail.report_year_invoices (compile): 23:37:38.133900 => 23:37:38.153052
[0m23:37:38.156937 [debug] [Thread-1 (]: Began executing node model.retail.report_year_invoices
[0m23:37:38.172351 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.report_year_invoices"
[0m23:37:38.193032 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:37:38.260562 [debug] [Thread-1 (]: On model.retail.report_year_invoices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.report_year_invoices"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`report_year_invoices`
    
    

    OPTIONS()
    as (
      SELECT
  dt.year,
  dt.month,
  COUNT(DISTINCT fi.invoice_id) AS num_invoices,
  SUM(fi.total) AS total_revenue
FROM `sapient-cycling-413017`.`retail`.`fct_invoices` fi
JOIN `sapient-cycling-413017`.`retail`.`dim_datetime` dt ON fi.datetime_id = dt.datetime_id
GROUP BY dt.year, dt.month
ORDER BY dt.year, dt.month
    );
  
[0m23:37:42.299747 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:aadf3c9a-5be1-42af-8b18-4f6f8d83d0b5&page=queryresults
[0m23:37:42.320173 [debug] [Thread-1 (]: Timing info for model.retail.report_year_invoices (execute): 23:37:38.158391 => 23:37:42.318696
[0m23:37:42.328382 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8d827729-5d86-4dee-8fd9-2c952d64ebf1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd7bd14550>]}
[0m23:37:42.336553 [info ] [Thread-1 (]: 3 of 3 OK created sql table model retail.report_year_invoices .................. [[32mCREATE TABLE (1.0 rows, 9.3 MiB processed)[0m in 4.20s]
[0m23:37:42.355406 [debug] [Thread-1 (]: Finished running node model.retail.report_year_invoices
[0m23:37:42.378907 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:37:42.389805 [debug] [MainThread]: Connection 'model.retail.report_year_invoices' was properly closed.
[0m23:37:42.393293 [info ] [MainThread]: 
[0m23:37:42.401316 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 16.34 seconds (16.34s).
[0m23:37:42.416517 [debug] [MainThread]: Command end result
[0m23:37:42.500481 [info ] [MainThread]: 
[0m23:37:42.503808 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:37:42.513732 [info ] [MainThread]: 
[0m23:37:42.517328 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m23:37:42.522141 [debug] [MainThread]: Command `dbt run` succeeded at 23:37:42.521655 after 22.22 seconds
[0m23:37:42.524624 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd94a994d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd98826bd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd988406d0>]}
[0m23:37:42.527037 [debug] [MainThread]: Flushing usage events
[0m10:06:40.545266 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd831ce310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd84910550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd82e06010>]}


============================== 10:06:40.557230 | a7456b68-f8c0-470f-9757-6efeb33049ca ==============================
[0m10:06:40.557230 [info ] [MainThread]: Running with dbt=1.5.9
[0m10:06:40.558506 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/usr/local/airflow/include/dbt/logs', 'profiles_dir': '/usr/local/airflow/include/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m10:06:40.584038 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a7456b68-f8c0-470f-9757-6efeb33049ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd82f73a50>]}
[0m10:06:40.590765 [debug] [MainThread]: Set downloads directory='/tmp/dbt-downloads-p_zp9ooy'
[0m10:06:40.592479 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m10:06:40.644289 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m10:06:40.647243 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m10:06:40.689321 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m10:06:40.700178 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m10:06:44.974994 [info ] [MainThread]: Installed from version 1.1.1
[0m10:06:44.976409 [info ] [MainThread]: Up to date!
[0m10:06:44.977950 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'a7456b68-f8c0-470f-9757-6efeb33049ca', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd8326d8d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd828f6290>]}
[0m10:06:44.979622 [debug] [MainThread]: Command `dbt deps` succeeded at 10:06:44.979461 after 4.45 seconds
[0m10:06:44.980686 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd86932f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd86851310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd86851250>]}
[0m10:06:44.981774 [debug] [MainThread]: Flushing usage events
[0m10:06:54.589399 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9568481150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9568606bd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f95681b1c50>]}


============================== 10:06:54.595611 | 65564337-afea-49db-90d1-65cdeb7ac20a ==============================
[0m10:06:54.595611 [info ] [MainThread]: Running with dbt=1.5.9
[0m10:06:54.597047 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/usr/local/airflow/include/dbt/logs', 'version_check': 'True', 'profiles_dir': '/usr/local/airflow/include/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m10:06:55.321127 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '65564337-afea-49db-90d1-65cdeb7ac20a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9566737450>]}
[0m10:06:55.335843 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '65564337-afea-49db-90d1-65cdeb7ac20a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9566737450>]}
[0m10:06:55.338226 [info ] [MainThread]: Registered adapter: bigquery=1.5.3
[0m10:06:55.367254 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m10:06:55.388161 [info ] [MainThread]: Unable to do partial parsing because of a version mismatch
[0m10:06:55.391003 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '65564337-afea-49db-90d1-65cdeb7ac20a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9566175050>]}
[0m10:06:56.972183 [debug] [MainThread]: 1699: static parser successfully parsed report/report_customer_invoices.sql
[0m10:06:56.992919 [debug] [MainThread]: 1699: static parser successfully parsed report/report_product_invoices.sql
[0m10:06:56.998385 [debug] [MainThread]: 1699: static parser successfully parsed report/report_year_invoices.sql
[0m10:06:57.005479 [debug] [MainThread]: 1603: static parser failed on transform/dim_customer.sql
[0m10:06:57.027392 [debug] [MainThread]: 1602: parser fallback to jinja rendering on transform/dim_customer.sql
[0m10:06:57.030899 [debug] [MainThread]: 1699: static parser successfully parsed transform/dim_datetime.sql
[0m10:06:57.036269 [debug] [MainThread]: 1603: static parser failed on transform/dim_product.sql
[0m10:06:57.045132 [debug] [MainThread]: 1602: parser fallback to jinja rendering on transform/dim_product.sql
[0m10:06:57.047513 [debug] [MainThread]: 1603: static parser failed on transform/fct_invoices.sql
[0m10:06:57.057380 [debug] [MainThread]: 1602: parser fallback to jinja rendering on transform/fct_invoices.sql
[0m10:06:57.169452 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '65564337-afea-49db-90d1-65cdeb7ac20a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f95666b4390>]}
[0m10:06:57.196453 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '65564337-afea-49db-90d1-65cdeb7ac20a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9565292210>]}
[0m10:06:57.197875 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 474 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics, 0 groups
[0m10:06:57.199165 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '65564337-afea-49db-90d1-65cdeb7ac20a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f956ac53a90>]}
[0m10:06:57.201791 [info ] [MainThread]: 
[0m10:06:57.204841 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m10:06:57.208077 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sapient-cycling-413017'
[0m10:06:57.209193 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:06:58.211926 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017, now list_sapient-cycling-413017_retail)
[0m10:06:58.215518 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:06:59.165841 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '65564337-afea-49db-90d1-65cdeb7ac20a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f956643d710>]}
[0m10:06:59.167588 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:06:59.168790 [info ] [MainThread]: 
[0m10:06:59.190414 [debug] [Thread-1 (]: Began running node model.retail.dim_customer
[0m10:06:59.192141 [info ] [Thread-1 (]: 1 of 7 START sql table model retail.dim_customer ............................... [RUN]
[0m10:06:59.194041 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017_retail, now model.retail.dim_customer)
[0m10:06:59.194965 [debug] [Thread-1 (]: Began compiling node model.retail.dim_customer
[0m10:06:59.205021 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_customer"
[0m10:06:59.216177 [debug] [Thread-1 (]: Timing info for model.retail.dim_customer (compile): 10:06:59.195814 => 10:06:59.215899
[0m10:06:59.217083 [debug] [Thread-1 (]: Began executing node model.retail.dim_customer
[0m10:06:59.232605 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:07:00.175987 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_customer"
[0m10:07:00.190729 [debug] [Thread-1 (]: On model.retail.dim_customer: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_customer"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_customer`
    
    

    OPTIONS()
    as (
      -- dim_customer.sql

-- Create the dimension table
WITH customer_cte AS (
	SELECT DISTINCT
	    to_hex(md5(cast(coalesce(cast(CustomerID as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Country as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as customer_id,
	    Country AS country
	FROM `sapient-cycling-413017`.`retail`.`raw_invoices`
	WHERE CustomerID IS NOT NULL
)
SELECT
    t.*,
	cm.iso
FROM customer_cte t
LEFT JOIN `sapient-cycling-413017`.`retail`.`country` cm ON t.country = cm.nicename
    );
  
[0m10:07:03.939192 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:44ad3018-b283-48ab-8dae-9edb2c88ee74&page=queryresults
[0m10:07:03.962759 [debug] [Thread-1 (]: Timing info for model.retail.dim_customer (execute): 10:06:59.217860 => 10:07:03.962558
[0m10:07:03.964571 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '65564337-afea-49db-90d1-65cdeb7ac20a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9566221e50>]}
[0m10:07:03.966268 [info ] [Thread-1 (]: 1 of 7 OK created sql table model retail.dim_customer .......................... [[32mCREATE TABLE (4.4k rows, 11.1 MiB processed)[0m in 4.77s]
[0m10:07:03.968382 [debug] [Thread-1 (]: Finished running node model.retail.dim_customer
[0m10:07:03.969692 [debug] [Thread-1 (]: Began running node model.retail.dim_datetime
[0m10:07:03.970890 [info ] [Thread-1 (]: 2 of 7 START sql table model retail.dim_datetime ............................... [RUN]
[0m10:07:03.972412 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_customer, now model.retail.dim_datetime)
[0m10:07:03.973259 [debug] [Thread-1 (]: Began compiling node model.retail.dim_datetime
[0m10:07:03.977027 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_datetime"
[0m10:07:03.987079 [debug] [Thread-1 (]: Timing info for model.retail.dim_datetime (compile): 10:07:03.973961 => 10:07:03.986565
[0m10:07:03.988807 [debug] [Thread-1 (]: Began executing node model.retail.dim_datetime
[0m10:07:03.994509 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:07:04.944621 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_datetime"
[0m10:07:04.954223 [debug] [Thread-1 (]: On model.retail.dim_datetime: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_datetime"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_datetime`
    
    

    OPTIONS()
    as (
      WITH datetime_cte AS (  
  SELECT DISTINCT
    InvoiceDate AS datetime_id,
    CASE
      WHEN LENGTH(FORMAT_TIMESTAMP('%Y-%m-%d %H:%M:%S', InvoiceDate)) = 16 THEN
        -- Date format: "DD/MM/YYYY HH:MM"
        PARSE_DATETIME('%m/%d/%Y %H:%M', FORMAT_TIMESTAMP('%Y-%m-%d %H:%M:%S', InvoiceDate))
      WHEN LENGTH(FORMAT_TIMESTAMP('%Y-%m-%d %H:%M:%S', InvoiceDate)) <= 14 THEN
        -- Date format: "MM/DD/YY HH:MM"
        PARSE_DATETIME('%m/%d/%y %H:%M', FORMAT_TIMESTAMP('%Y-%m-%d %H:%M:%S', InvoiceDate))
      ELSE
        NULL
    END AS date_part
  FROM `sapient-cycling-413017`.`retail`.`raw_invoices`
  WHERE InvoiceDate IS NOT NULL
)
SELECT
  datetime_id,
  date_part as datetime,
  EXTRACT(YEAR FROM date_part) AS year,
  EXTRACT(MONTH FROM date_part) AS month,
  EXTRACT(DAY FROM date_part) AS day,
  EXTRACT(HOUR FROM date_part) AS hour,
  EXTRACT(MINUTE FROM date_part) AS minute,
  EXTRACT(DAYOFWEEK FROM date_part) AS weekday
FROM datetime_cte
    );
  
[0m10:07:10.794604 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:6869609d-c122-473c-86af-b2a59353fc7f&page=queryresults
[0m10:07:10.798227 [debug] [Thread-1 (]: Timing info for model.retail.dim_datetime (execute): 10:07:03.989882 => 10:07:10.798018
[0m10:07:10.800328 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '65564337-afea-49db-90d1-65cdeb7ac20a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f95662943d0>]}
[0m10:07:10.802219 [info ] [Thread-1 (]: 2 of 7 OK created sql table model retail.dim_datetime .......................... [[32mCREATE TABLE (23.3k rows, 4.1 MiB processed)[0m in 6.83s]
[0m10:07:10.803997 [debug] [Thread-1 (]: Finished running node model.retail.dim_datetime
[0m10:07:10.805093 [debug] [Thread-1 (]: Began running node model.retail.dim_product
[0m10:07:10.806119 [info ] [Thread-1 (]: 3 of 7 START sql table model retail.dim_product ................................ [RUN]
[0m10:07:10.807553 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_datetime, now model.retail.dim_product)
[0m10:07:10.808389 [debug] [Thread-1 (]: Began compiling node model.retail.dim_product
[0m10:07:10.814101 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_product"
[0m10:07:10.827058 [debug] [Thread-1 (]: Timing info for model.retail.dim_product (compile): 10:07:10.809091 => 10:07:10.826733
[0m10:07:10.828136 [debug] [Thread-1 (]: Began executing node model.retail.dim_product
[0m10:07:10.831217 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:07:11.751826 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_product"
[0m10:07:11.772735 [debug] [Thread-1 (]: On model.retail.dim_product: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_product"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_product`
    
    

    OPTIONS()
    as (
      -- dim_product.sql
-- StockCode isn't unique, a product with the same id can have different and prices
-- Create the dimension table
SELECT DISTINCT
    to_hex(md5(cast(coalesce(cast(StockCode as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Description as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(UnitPrice as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as product_id,
		StockCode AS stock_code,
    Description AS description,
    UnitPrice AS price
FROM `sapient-cycling-413017`.`retail`.`raw_invoices`
WHERE StockCode IS NOT NULL
AND UnitPrice > 0
    );
  
[0m10:07:15.609386 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:7cec76ee-d270-4205-982e-e12397d33ca1&page=queryresults
[0m10:07:15.612587 [debug] [Thread-1 (]: Timing info for model.retail.dim_product (execute): 10:07:10.829074 => 10:07:15.612452
[0m10:07:15.614252 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '65564337-afea-49db-90d1-65cdeb7ac20a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f956625c610>]}
[0m10:07:15.615673 [info ] [Thread-1 (]: 3 of 7 OK created sql table model retail.dim_product ........................... [[32mCREATE TABLE (16.3k rows, 22.6 MiB processed)[0m in 4.81s]
[0m10:07:15.617031 [debug] [Thread-1 (]: Finished running node model.retail.dim_product
[0m10:07:15.619131 [debug] [Thread-1 (]: Began running node model.retail.fct_invoices
[0m10:07:15.620236 [info ] [Thread-1 (]: 4 of 7 START sql table model retail.fct_invoices ............................... [RUN]
[0m10:07:15.621699 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_product, now model.retail.fct_invoices)
[0m10:07:15.622544 [debug] [Thread-1 (]: Began compiling node model.retail.fct_invoices
[0m10:07:15.630775 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.fct_invoices"
[0m10:07:15.641383 [debug] [Thread-1 (]: Timing info for model.retail.fct_invoices (compile): 10:07:15.623327 => 10:07:15.640962
[0m10:07:15.643713 [debug] [Thread-1 (]: Began executing node model.retail.fct_invoices
[0m10:07:15.647283 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:07:16.560715 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.fct_invoices"
[0m10:07:16.570823 [debug] [Thread-1 (]: On model.retail.fct_invoices: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.fct_invoices"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`fct_invoices`
    
    

    OPTIONS()
    as (
      -- fct_invoices.sql

-- Create the fact table by joining the relevant keys from dimension table
WITH fct_invoices_cte AS (
    SELECT
        InvoiceNo AS invoice_id,
        InvoiceDate AS datetime_id,
        to_hex(md5(cast(coalesce(cast(StockCode as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Description as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(UnitPrice as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as product_id,
        to_hex(md5(cast(coalesce(cast(CustomerID as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Country as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as customer_id,
        Quantity AS quantity,
        Quantity * UnitPrice AS total
    FROM `sapient-cycling-413017`.`retail`.`raw_invoices`
    WHERE Quantity > 0
)
SELECT
    invoice_id,
    dt.datetime_id,
    dp.product_id,
    dc.customer_id,
    quantity,
    total
FROM fct_invoices_cte fi
INNER JOIN `sapient-cycling-413017`.`retail`.`dim_datetime` dt ON fi.datetime_id = dt.datetime_id
INNER JOIN `sapient-cycling-413017`.`retail`.`dim_product` dp ON fi.product_id = dp.product_id
INNER JOIN `sapient-cycling-413017`.`retail`.`dim_customer` dc ON fi.customer_id = dc.customer_id
    );
  
[0m10:07:23.679837 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:1531adb8-fc6b-4d3b-a767-ee599a3ca7a0&page=queryresults
[0m10:07:23.683461 [debug] [Thread-1 (]: Timing info for model.retail.fct_invoices (execute): 10:07:15.645096 => 10:07:23.683249
[0m10:07:23.685284 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '65564337-afea-49db-90d1-65cdeb7ac20a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9566330410>]}
[0m10:07:23.686770 [info ] [Thread-1 (]: 4 of 7 OK created sql table model retail.fct_invoices .......................... [[32mCREATE TABLE (397.9k rows, 46.9 MiB processed)[0m in 8.06s]
[0m10:07:23.688302 [debug] [Thread-1 (]: Finished running node model.retail.fct_invoices
[0m10:07:23.690124 [debug] [Thread-1 (]: Began running node model.retail.report_customer_invoices
[0m10:07:23.691142 [info ] [Thread-1 (]: 5 of 7 START sql table model retail.report_customer_invoices ................... [RUN]
[0m10:07:23.692478 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.fct_invoices, now model.retail.report_customer_invoices)
[0m10:07:23.693289 [debug] [Thread-1 (]: Began compiling node model.retail.report_customer_invoices
[0m10:07:23.696882 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.report_customer_invoices"
[0m10:07:23.707367 [debug] [Thread-1 (]: Timing info for model.retail.report_customer_invoices (compile): 10:07:23.694085 => 10:07:23.706816
[0m10:07:23.708929 [debug] [Thread-1 (]: Began executing node model.retail.report_customer_invoices
[0m10:07:23.730856 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:07:24.658597 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.report_customer_invoices"
[0m10:07:24.668429 [debug] [Thread-1 (]: On model.retail.report_customer_invoices: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.report_customer_invoices"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`report_customer_invoices`
    
    

    OPTIONS()
    as (
      SELECT
  c.country,
  c.iso,
  COUNT(fi.invoice_id) AS total_invoices,
  SUM(fi.total) AS total_revenue
FROM `sapient-cycling-413017`.`retail`.`fct_invoices` fi
JOIN `sapient-cycling-413017`.`retail`.`dim_customer` c ON fi.customer_id = c.customer_id
GROUP BY c.country, c.iso
ORDER BY total_revenue DESC
LIMIT 10
    );
  
[0m10:07:27.762184 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:b9d52a6e-429f-4e2f-9164-4b94de17ef65&page=queryresults
[0m10:07:27.765649 [debug] [Thread-1 (]: Timing info for model.retail.report_customer_invoices (execute): 10:07:23.711203 => 10:07:27.765457
[0m10:07:27.767477 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '65564337-afea-49db-90d1-65cdeb7ac20a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f956530a610>]}
[0m10:07:27.768758 [info ] [Thread-1 (]: 5 of 7 OK created sql table model retail.report_customer_invoices .............. [[32mCREATE TABLE (10.0 rows, 19.2 MiB processed)[0m in 4.08s]
[0m10:07:27.770139 [debug] [Thread-1 (]: Finished running node model.retail.report_customer_invoices
[0m10:07:27.771274 [debug] [Thread-1 (]: Began running node model.retail.report_product_invoices
[0m10:07:27.772500 [info ] [Thread-1 (]: 6 of 7 START sql table model retail.report_product_invoices .................... [RUN]
[0m10:07:27.774166 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.report_customer_invoices, now model.retail.report_product_invoices)
[0m10:07:27.775213 [debug] [Thread-1 (]: Began compiling node model.retail.report_product_invoices
[0m10:07:27.778762 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.report_product_invoices"
[0m10:07:27.791969 [debug] [Thread-1 (]: Timing info for model.retail.report_product_invoices (compile): 10:07:27.775950 => 10:07:27.791335
[0m10:07:27.794440 [debug] [Thread-1 (]: Began executing node model.retail.report_product_invoices
[0m10:07:27.800583 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:07:28.682351 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.report_product_invoices"
[0m10:07:28.691432 [debug] [Thread-1 (]: On model.retail.report_product_invoices: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.report_product_invoices"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`report_product_invoices`
    
    

    OPTIONS()
    as (
      SELECT
  p.product_id,
  p.stock_code,
  p.description,
  SUM(fi.quantity) AS total_quantity_sold
FROM `sapient-cycling-413017`.`retail`.`fct_invoices` fi
JOIN `sapient-cycling-413017`.`retail`.`dim_product` p ON fi.product_id = p.product_id
GROUP BY p.product_id, p.stock_code, p.description
ORDER BY total_quantity_sold DESC
LIMIT 10
    );
  
[0m10:07:39.442870 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:56927de4-9803-4b0d-90d5-cbfa8aa53cdb&page=queryresults
[0m10:07:39.446032 [debug] [Thread-1 (]: Timing info for model.retail.report_product_invoices (execute): 10:07:27.797331 => 10:07:39.445879
[0m10:07:39.447595 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '65564337-afea-49db-90d1-65cdeb7ac20a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f95652a0f50>]}
[0m10:07:39.449013 [info ] [Thread-1 (]: 6 of 7 OK created sql table model retail.report_product_invoices ............... [[32mCREATE TABLE (10.0 rows, 17.0 MiB processed)[0m in 11.67s]
[0m10:07:39.450498 [debug] [Thread-1 (]: Finished running node model.retail.report_product_invoices
[0m10:07:39.451661 [debug] [Thread-1 (]: Began running node model.retail.report_year_invoices
[0m10:07:39.452887 [info ] [Thread-1 (]: 7 of 7 START sql table model retail.report_year_invoices ....................... [RUN]
[0m10:07:39.454242 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.report_product_invoices, now model.retail.report_year_invoices)
[0m10:07:39.455131 [debug] [Thread-1 (]: Began compiling node model.retail.report_year_invoices
[0m10:07:39.458729 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.report_year_invoices"
[0m10:07:39.470894 [debug] [Thread-1 (]: Timing info for model.retail.report_year_invoices (compile): 10:07:39.455826 => 10:07:39.470595
[0m10:07:39.471891 [debug] [Thread-1 (]: Began executing node model.retail.report_year_invoices
[0m10:07:39.474788 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:07:40.409940 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.report_year_invoices"
[0m10:07:40.418940 [debug] [Thread-1 (]: On model.retail.report_year_invoices: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.report_year_invoices"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`report_year_invoices`
    
    

    OPTIONS()
    as (
      SELECT
  dt.year,
  dt.month,
  COUNT(DISTINCT fi.invoice_id) AS num_invoices,
  SUM(fi.total) AS total_revenue
FROM `sapient-cycling-413017`.`retail`.`fct_invoices` fi
JOIN `sapient-cycling-413017`.`retail`.`dim_datetime` dt ON fi.datetime_id = dt.datetime_id
GROUP BY dt.year, dt.month
ORDER BY dt.year, dt.month
    );
  
[0m10:07:47.009559 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:5167e2d9-76e7-41ab-8b83-97c4c582d447&page=queryresults
[0m10:07:47.014025 [debug] [Thread-1 (]: Timing info for model.retail.report_year_invoices (execute): 10:07:39.472673 => 10:07:47.013678
[0m10:07:47.016116 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '65564337-afea-49db-90d1-65cdeb7ac20a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f95652d4590>]}
[0m10:07:47.017762 [info ] [Thread-1 (]: 7 of 7 OK created sql table model retail.report_year_invoices .................. [[32mCREATE TABLE (1.0 rows, 9.3 MiB processed)[0m in 7.56s]
[0m10:07:47.019524 [debug] [Thread-1 (]: Finished running node model.retail.report_year_invoices
[0m10:07:47.022563 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:07:47.023845 [debug] [MainThread]: Connection 'model.retail.report_year_invoices' was properly closed.
[0m10:07:47.025089 [info ] [MainThread]: 
[0m10:07:47.026150 [info ] [MainThread]: Finished running 7 table models in 0 hours 0 minutes and 49.82 seconds (49.82s).
[0m10:07:47.029085 [debug] [MainThread]: Command end result
[0m10:07:47.064595 [info ] [MainThread]: 
[0m10:07:47.066478 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:07:47.068027 [info ] [MainThread]: 
[0m10:07:47.069433 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m10:07:47.071467 [debug] [MainThread]: Command `dbt run` succeeded at 10:07:47.071250 after 52.51 seconds
[0m10:07:47.074343 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f95684bcd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9567f367d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f956ac53d90>]}
[0m10:07:47.075948 [debug] [MainThread]: Flushing usage events
[0m10:08:27.419005 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9b942a710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9b97346d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9b97378d0>]}


============================== 10:08:27.425021 | fab07dd3-c5e6-444c-9cb8-7f9ca5ad48c9 ==============================
[0m10:08:27.425021 [info ] [MainThread]: Running with dbt=1.5.9
[0m10:08:27.426544 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/local/airflow/include/dbt/', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/local/airflow/include/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m10:08:27.684272 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fab07dd3-c5e6-444c-9cb8-7f9ca5ad48c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9b793e510>]}
[0m10:08:27.707850 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fab07dd3-c5e6-444c-9cb8-7f9ca5ad48c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9b9734e10>]}
[0m10:08:27.745503 [info ] [MainThread]: Registered adapter: bigquery=1.5.3
[0m10:08:27.788380 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m10:08:28.543840 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:08:28.544611 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:08:28.550354 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fab07dd3-c5e6-444c-9cb8-7f9ca5ad48c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9b7430050>]}
[0m10:08:28.568644 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fab07dd3-c5e6-444c-9cb8-7f9ca5ad48c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9b74e8d10>]}
[0m10:08:28.570006 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 474 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics, 0 groups
[0m10:08:28.571068 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fab07dd3-c5e6-444c-9cb8-7f9ca5ad48c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9bbee7c10>]}
[0m10:08:28.574740 [info ] [MainThread]: 
[0m10:08:28.576562 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m10:08:28.578595 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sapient-cycling-413017'
[0m10:08:28.579542 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:08:29.473675 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017, now list_sapient-cycling-413017_retail)
[0m10:08:29.477801 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:08:30.358147 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fab07dd3-c5e6-444c-9cb8-7f9ca5ad48c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9b77daa10>]}
[0m10:08:30.359678 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:08:30.360765 [info ] [MainThread]: 
[0m10:08:30.376332 [debug] [Thread-1 (]: Began running node model.retail.report_customer_invoices
[0m10:08:30.377692 [info ] [Thread-1 (]: 1 of 3 START sql table model retail.report_customer_invoices ................... [RUN]
[0m10:08:30.379335 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017_retail, now model.retail.report_customer_invoices)
[0m10:08:30.380768 [debug] [Thread-1 (]: Began compiling node model.retail.report_customer_invoices
[0m10:08:30.393953 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.report_customer_invoices"
[0m10:08:30.405955 [debug] [Thread-1 (]: Timing info for model.retail.report_customer_invoices (compile): 10:08:30.382425 => 10:08:30.405654
[0m10:08:30.406943 [debug] [Thread-1 (]: Began executing node model.retail.report_customer_invoices
[0m10:08:30.470930 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:08:31.590987 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.report_customer_invoices"
[0m10:08:31.606140 [debug] [Thread-1 (]: On model.retail.report_customer_invoices: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.report_customer_invoices"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`report_customer_invoices`
    
    

    OPTIONS()
    as (
      SELECT
  c.country,
  c.iso,
  COUNT(fi.invoice_id) AS total_invoices,
  SUM(fi.total) AS total_revenue
FROM `sapient-cycling-413017`.`retail`.`fct_invoices` fi
JOIN `sapient-cycling-413017`.`retail`.`dim_customer` c ON fi.customer_id = c.customer_id
GROUP BY c.country, c.iso
ORDER BY total_revenue DESC
LIMIT 10
    );
  
[0m10:08:35.263592 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:a191f68e-3d44-4747-bfab-ea95b9d942e7&page=queryresults
[0m10:08:35.278938 [debug] [Thread-1 (]: Timing info for model.retail.report_customer_invoices (execute): 10:08:30.407666 => 10:08:35.278766
[0m10:08:35.281212 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fab07dd3-c5e6-444c-9cb8-7f9ca5ad48c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9b74f0fd0>]}
[0m10:08:35.282822 [info ] [Thread-1 (]: 1 of 3 OK created sql table model retail.report_customer_invoices .............. [[32mCREATE TABLE (10.0 rows, 19.2 MiB processed)[0m in 4.90s]
[0m10:08:35.284457 [debug] [Thread-1 (]: Finished running node model.retail.report_customer_invoices
[0m10:08:35.285980 [debug] [Thread-1 (]: Began running node model.retail.report_product_invoices
[0m10:08:35.287408 [info ] [Thread-1 (]: 2 of 3 START sql table model retail.report_product_invoices .................... [RUN]
[0m10:08:35.288781 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.report_customer_invoices, now model.retail.report_product_invoices)
[0m10:08:35.289662 [debug] [Thread-1 (]: Began compiling node model.retail.report_product_invoices
[0m10:08:35.293339 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.report_product_invoices"
[0m10:08:35.300925 [debug] [Thread-1 (]: Timing info for model.retail.report_product_invoices (compile): 10:08:35.290350 => 10:08:35.300561
[0m10:08:35.301932 [debug] [Thread-1 (]: Began executing node model.retail.report_product_invoices
[0m10:08:35.305231 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:08:36.197793 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.report_product_invoices"
[0m10:08:36.208068 [debug] [Thread-1 (]: On model.retail.report_product_invoices: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.report_product_invoices"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`report_product_invoices`
    
    

    OPTIONS()
    as (
      SELECT
  p.product_id,
  p.stock_code,
  p.description,
  SUM(fi.quantity) AS total_quantity_sold
FROM `sapient-cycling-413017`.`retail`.`fct_invoices` fi
JOIN `sapient-cycling-413017`.`retail`.`dim_product` p ON fi.product_id = p.product_id
GROUP BY p.product_id, p.stock_code, p.description
ORDER BY total_quantity_sold DESC
LIMIT 10
    );
  
[0m10:08:39.779448 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:ddde47dc-9c13-4022-b7b3-bc5325a6a320&page=queryresults
[0m10:08:39.782508 [debug] [Thread-1 (]: Timing info for model.retail.report_product_invoices (execute): 10:08:35.302737 => 10:08:39.782335
[0m10:08:39.784052 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fab07dd3-c5e6-444c-9cb8-7f9ca5ad48c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9b7693f10>]}
[0m10:08:39.785507 [info ] [Thread-1 (]: 2 of 3 OK created sql table model retail.report_product_invoices ............... [[32mCREATE TABLE (10.0 rows, 17.0 MiB processed)[0m in 4.50s]
[0m10:08:39.787112 [debug] [Thread-1 (]: Finished running node model.retail.report_product_invoices
[0m10:08:39.788117 [debug] [Thread-1 (]: Began running node model.retail.report_year_invoices
[0m10:08:39.789104 [info ] [Thread-1 (]: 3 of 3 START sql table model retail.report_year_invoices ....................... [RUN]
[0m10:08:39.790562 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.report_product_invoices, now model.retail.report_year_invoices)
[0m10:08:39.791772 [debug] [Thread-1 (]: Began compiling node model.retail.report_year_invoices
[0m10:08:39.797198 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.report_year_invoices"
[0m10:08:39.805542 [debug] [Thread-1 (]: Timing info for model.retail.report_year_invoices (compile): 10:08:39.792753 => 10:08:39.805251
[0m10:08:39.806487 [debug] [Thread-1 (]: Began executing node model.retail.report_year_invoices
[0m10:08:39.809355 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:08:40.720463 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.report_year_invoices"
[0m10:08:40.730247 [debug] [Thread-1 (]: On model.retail.report_year_invoices: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.report_year_invoices"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`report_year_invoices`
    
    

    OPTIONS()
    as (
      SELECT
  dt.year,
  dt.month,
  COUNT(DISTINCT fi.invoice_id) AS num_invoices,
  SUM(fi.total) AS total_revenue
FROM `sapient-cycling-413017`.`retail`.`fct_invoices` fi
JOIN `sapient-cycling-413017`.`retail`.`dim_datetime` dt ON fi.datetime_id = dt.datetime_id
GROUP BY dt.year, dt.month
ORDER BY dt.year, dt.month
    );
  
[0m10:08:44.254961 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:57ef488b-ffdb-4d67-9187-f1f4c5f94419&page=queryresults
[0m10:08:44.257667 [debug] [Thread-1 (]: Timing info for model.retail.report_year_invoices (execute): 10:08:39.807370 => 10:08:44.257530
[0m10:08:44.259196 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fab07dd3-c5e6-444c-9cb8-7f9ca5ad48c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9b7581bd0>]}
[0m10:08:44.260998 [info ] [Thread-1 (]: 3 of 3 OK created sql table model retail.report_year_invoices .................. [[32mCREATE TABLE (1.0 rows, 9.3 MiB processed)[0m in 4.47s]
[0m10:08:44.262736 [debug] [Thread-1 (]: Finished running node model.retail.report_year_invoices
[0m10:08:44.265457 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:08:44.266275 [debug] [MainThread]: Connection 'model.retail.report_year_invoices' was properly closed.
[0m10:08:44.267050 [info ] [MainThread]: 
[0m10:08:44.268003 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 15.69 seconds (15.69s).
[0m10:08:44.270497 [debug] [MainThread]: Command end result
[0m10:08:44.314199 [info ] [MainThread]: 
[0m10:08:44.316372 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:08:44.319712 [info ] [MainThread]: 
[0m10:08:44.321262 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m10:08:44.323397 [debug] [MainThread]: Command `dbt run` succeeded at 10:08:44.323104 after 16.93 seconds
[0m10:08:44.324925 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9b9244d50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9b92444d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9b95ee190>]}
[0m10:08:44.326349 [debug] [MainThread]: Flushing usage events
[0m11:55:11.479798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbc7ebc6490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbc7ea59b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbc7e8a2350>]}


============================== 11:55:11.485568 | fa06cf6c-7939-415e-87dc-d40125b669fa ==============================
[0m11:55:11.485568 [info ] [MainThread]: Running with dbt=1.5.0
[0m11:55:11.486792 [debug] [MainThread]: running dbt with arguments {'log_cache_events': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'introspect': 'True', 'warn_error': 'None', 'log_path': '/usr/local/airflow/include/dbt/logs', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'version_check': 'True', 'no_print': 'None', 'fail_fast': 'False', 'debug': 'False', 'printer_width': '80', 'cache_selected_only': 'False', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '/usr/local/airflow/include/dbt/', 'quiet': 'False', 'write_json': 'True'}
[0m11:55:12.170521 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fa06cf6c-7939-415e-87dc-d40125b669fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbc7e7abed0>]}
[0m11:55:12.184004 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fa06cf6c-7939-415e-87dc-d40125b669fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbc7ebc42d0>]}
[0m11:55:12.227282 [debug] [MainThread]: checksum: 4568eb639a77b8fcb3a1f4a07856f42b1ff63f1376652889143968e1dbdafbda, vars: {}, profile: , target: , version: 1.5.0
[0m11:55:12.271493 [info ] [MainThread]: Unable to do partial parsing because of a version mismatch
[0m11:55:12.273192 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'fa06cf6c-7939-415e-87dc-d40125b669fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbc5be33510>]}
[0m11:55:14.007721 [debug] [MainThread]: 1699: static parser successfully parsed report/report_customer_invoices.sql
[0m11:55:14.024511 [debug] [MainThread]: 1699: static parser successfully parsed report/report_product_invoices.sql
[0m11:55:14.029962 [debug] [MainThread]: 1699: static parser successfully parsed report/report_year_invoices.sql
[0m11:55:14.034586 [debug] [MainThread]: 1603: static parser failed on transform/dim_customer.sql
[0m11:55:14.058371 [debug] [MainThread]: 1602: parser fallback to jinja rendering on transform/dim_customer.sql
[0m11:55:14.061823 [debug] [MainThread]: 1699: static parser successfully parsed transform/dim_datetime.sql
[0m11:55:14.066519 [debug] [MainThread]: 1603: static parser failed on transform/dim_product.sql
[0m11:55:14.074481 [debug] [MainThread]: 1602: parser fallback to jinja rendering on transform/dim_product.sql
[0m11:55:14.078000 [debug] [MainThread]: 1603: static parser failed on transform/fct_invoices.sql
[0m11:55:14.089505 [debug] [MainThread]: 1602: parser fallback to jinja rendering on transform/fct_invoices.sql
[0m11:55:14.160055 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fa06cf6c-7939-415e-87dc-d40125b669fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbc5bfcf310>]}
[0m11:55:14.179358 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fa06cf6c-7939-415e-87dc-d40125b669fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbc5ad19710>]}
[0m11:55:14.180401 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 471 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics, 0 groups
[0m11:55:14.181640 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fa06cf6c-7939-415e-87dc-d40125b669fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbc5becb5d0>]}
[0m11:55:14.185496 [info ] [MainThread]: 
[0m11:55:14.187160 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m11:55:14.189292 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sapient-cycling-413017'
[0m11:55:14.190417 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:55:16.686324 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017, now list_sapient-cycling-413017_retail)
[0m11:55:16.688386 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:55:17.571852 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fa06cf6c-7939-415e-87dc-d40125b669fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbc5bef90d0>]}
[0m11:55:17.574498 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:55:17.575817 [info ] [MainThread]: 
[0m11:55:17.600722 [debug] [Thread-1 (]: Began running node model.retail.report_customer_invoices
[0m11:55:17.602519 [info ] [Thread-1 (]: 1 of 3 START sql table model retail.report_customer_invoices ................... [RUN]
[0m11:55:17.604542 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017_retail, now model.retail.report_customer_invoices)
[0m11:55:17.605572 [debug] [Thread-1 (]: Began compiling node model.retail.report_customer_invoices
[0m11:55:17.611497 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.report_customer_invoices"
[0m11:55:17.620809 [debug] [Thread-1 (]: Timing info for model.retail.report_customer_invoices (compile): 11:55:17.606312 => 11:55:17.620396
[0m11:55:17.621955 [debug] [Thread-1 (]: Began executing node model.retail.report_customer_invoices
[0m11:55:17.636996 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:55:18.632560 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.report_customer_invoices"
[0m11:55:18.646815 [debug] [Thread-1 (]: On model.retail.report_customer_invoices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.report_customer_invoices"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`report_customer_invoices`
    
    

    OPTIONS()
    as (
      SELECT
  c.country,
  c.iso,
  COUNT(fi.invoice_id) AS total_invoices,
  SUM(fi.total) AS total_revenue
FROM `sapient-cycling-413017`.`retail`.`fct_invoices` fi
JOIN `sapient-cycling-413017`.`retail`.`dim_customer` c ON fi.customer_id = c.customer_id
GROUP BY c.country, c.iso
ORDER BY total_revenue DESC
LIMIT 10
    );
  
[0m11:55:22.028872 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:b7288c18-33f4-40d5-af0a-43f63d0ab471&page=queryresults
[0m11:55:22.043174 [debug] [Thread-1 (]: Timing info for model.retail.report_customer_invoices (execute): 11:55:17.622734 => 11:55:22.042984
[0m11:55:22.045349 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fa06cf6c-7939-415e-87dc-d40125b669fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbc5beb2590>]}
[0m11:55:22.047140 [info ] [Thread-1 (]: 1 of 3 OK created sql table model retail.report_customer_invoices .............. [[32mCREATE TABLE (10.0 rows, 19.2 MiB processed)[0m in 4.44s]
[0m11:55:22.049189 [debug] [Thread-1 (]: Finished running node model.retail.report_customer_invoices
[0m11:55:22.050484 [debug] [Thread-1 (]: Began running node model.retail.report_product_invoices
[0m11:55:22.051542 [info ] [Thread-1 (]: 2 of 3 START sql table model retail.report_product_invoices .................... [RUN]
[0m11:55:22.052857 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.report_customer_invoices, now model.retail.report_product_invoices)
[0m11:55:22.053796 [debug] [Thread-1 (]: Began compiling node model.retail.report_product_invoices
[0m11:55:22.057211 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.report_product_invoices"
[0m11:55:22.065306 [debug] [Thread-1 (]: Timing info for model.retail.report_product_invoices (compile): 11:55:22.054586 => 11:55:22.064876
[0m11:55:22.067176 [debug] [Thread-1 (]: Began executing node model.retail.report_product_invoices
[0m11:55:22.071010 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:55:23.032186 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.report_product_invoices"
[0m11:55:23.044131 [debug] [Thread-1 (]: On model.retail.report_product_invoices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.report_product_invoices"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`report_product_invoices`
    
    

    OPTIONS()
    as (
      SELECT
  p.product_id,
  p.stock_code,
  p.description,
  SUM(fi.quantity) AS total_quantity_sold
FROM `sapient-cycling-413017`.`retail`.`fct_invoices` fi
JOIN `sapient-cycling-413017`.`retail`.`dim_product` p ON fi.product_id = p.product_id
GROUP BY p.product_id, p.stock_code, p.description
ORDER BY total_quantity_sold DESC
LIMIT 10
    );
  
[0m11:55:26.205428 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:2bb95385-d9b8-4924-b4a1-ec04896e182d&page=queryresults
[0m11:55:26.208754 [debug] [Thread-1 (]: Timing info for model.retail.report_product_invoices (execute): 11:55:22.068844 => 11:55:26.208468
[0m11:55:26.210619 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fa06cf6c-7939-415e-87dc-d40125b669fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbc5bf4f110>]}
[0m11:55:26.211928 [info ] [Thread-1 (]: 2 of 3 OK created sql table model retail.report_product_invoices ............... [[32mCREATE TABLE (10.0 rows, 17.0 MiB processed)[0m in 4.16s]
[0m11:55:26.213320 [debug] [Thread-1 (]: Finished running node model.retail.report_product_invoices
[0m11:55:26.214331 [debug] [Thread-1 (]: Began running node model.retail.report_year_invoices
[0m11:55:26.215183 [info ] [Thread-1 (]: 3 of 3 START sql table model retail.report_year_invoices ....................... [RUN]
[0m11:55:26.216458 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.report_product_invoices, now model.retail.report_year_invoices)
[0m11:55:26.217259 [debug] [Thread-1 (]: Began compiling node model.retail.report_year_invoices
[0m11:55:26.220511 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.report_year_invoices"
[0m11:55:26.229350 [debug] [Thread-1 (]: Timing info for model.retail.report_year_invoices (compile): 11:55:26.217929 => 11:55:26.229009
[0m11:55:26.230500 [debug] [Thread-1 (]: Began executing node model.retail.report_year_invoices
[0m11:55:26.245790 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:55:27.187208 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.report_year_invoices"
[0m11:55:27.197923 [debug] [Thread-1 (]: On model.retail.report_year_invoices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.report_year_invoices"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`report_year_invoices`
    
    

    OPTIONS()
    as (
      SELECT
  dt.year,
  dt.month,
  COUNT(DISTINCT fi.invoice_id) AS num_invoices,
  SUM(fi.total) AS total_revenue
FROM `sapient-cycling-413017`.`retail`.`fct_invoices` fi
JOIN `sapient-cycling-413017`.`retail`.`dim_datetime` dt ON fi.datetime_id = dt.datetime_id
GROUP BY dt.year, dt.month
ORDER BY dt.year, dt.month
    );
  
[0m11:55:30.789016 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:6acce79e-2446-42a8-8769-e2c27473630c&page=queryresults
[0m11:55:30.792006 [debug] [Thread-1 (]: Timing info for model.retail.report_year_invoices (execute): 11:55:26.231464 => 11:55:30.791725
[0m11:55:30.794160 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fa06cf6c-7939-415e-87dc-d40125b669fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbc5ad3e190>]}
[0m11:55:30.795381 [info ] [Thread-1 (]: 3 of 3 OK created sql table model retail.report_year_invoices .................. [[32mCREATE TABLE (1.0 rows, 9.3 MiB processed)[0m in 4.58s]
[0m11:55:30.796940 [debug] [Thread-1 (]: Finished running node model.retail.report_year_invoices
[0m11:55:30.800350 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:55:30.801389 [debug] [MainThread]: Connection 'model.retail.report_year_invoices' was properly closed.
[0m11:55:30.802361 [info ] [MainThread]: 
[0m11:55:30.803432 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 16.62 seconds (16.62s).
[0m11:55:30.806418 [debug] [MainThread]: Command end result
[0m11:55:30.837581 [info ] [MainThread]: 
[0m11:55:30.839589 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:55:30.841180 [info ] [MainThread]: 
[0m11:55:30.843557 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m11:55:30.847748 [debug] [MainThread]: Command `dbt run` succeeded at 11:55:30.847039 after 19.39 seconds
[0m11:55:30.849890 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbc7ebc0910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbc7ebc7110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbc82ac8610>]}
[0m11:55:30.852345 [debug] [MainThread]: Flushing usage events
[0m12:00:35.464565 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f408aceb4d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f408acd62d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f408aceb690>]}


============================== 12:00:35.472312 | d4ba0444-4606-405b-a0f5-b0b0d5e436de ==============================
[0m12:00:35.472312 [info ] [MainThread]: Running with dbt=1.5.9
[0m12:00:35.474038 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/usr/local/airflow/include/dbt', 'log_path': '/usr/local/airflow/include/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m12:00:35.500937 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd4ba0444-4606-405b-a0f5-b0b0d5e436de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f408ab25010>]}
[0m12:00:35.508342 [debug] [MainThread]: Set downloads directory='/tmp/dbt-downloads-iu5wrquj'
[0m12:00:35.510288 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m12:00:36.011525 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m12:00:36.014115 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m12:00:36.075044 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m12:00:36.086238 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m12:00:39.561790 [info ] [MainThread]: Installed from version 1.1.1
[0m12:00:39.563330 [info ] [MainThread]: Up to date!
[0m12:00:39.565072 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'd4ba0444-4606-405b-a0f5-b0b0d5e436de', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f408ad128d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f408a35f290>]}
[0m12:00:39.566740 [debug] [MainThread]: Command `dbt deps` succeeded at 12:00:39.566571 after 4.13 seconds
[0m12:00:39.567741 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f408aceb690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f408e3b5010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f408e445910>]}
[0m12:00:39.568825 [debug] [MainThread]: Flushing usage events
[0m12:00:47.715426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb12e4590d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb12e5ba9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb12e59a190>]}


============================== 12:00:47.720951 | f13a0f95-898f-4cf4-a1f3-83450548a0c2 ==============================
[0m12:00:47.720951 [info ] [MainThread]: Running with dbt=1.5.9
[0m12:00:47.722194 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/usr/local/airflow/include/dbt/', 'log_path': '/usr/local/airflow/include/dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m12:00:48.054215 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f13a0f95-898f-4cf4-a1f3-83450548a0c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb12cb16610>]}
[0m12:00:48.071538 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f13a0f95-898f-4cf4-a1f3-83450548a0c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb12cb16610>]}
[0m12:00:48.073448 [info ] [MainThread]: Registered adapter: bigquery=1.5.3
[0m12:00:48.106442 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m12:00:48.132512 [info ] [MainThread]: Unable to do partial parsing because of a version mismatch
[0m12:00:48.134514 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'f13a0f95-898f-4cf4-a1f3-83450548a0c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb12cadb6d0>]}
[0m12:00:49.700658 [debug] [MainThread]: 1699: static parser successfully parsed report/report_customer_invoices.sql
[0m12:00:49.712332 [debug] [MainThread]: 1699: static parser successfully parsed report/report_product_invoices.sql
[0m12:00:49.716409 [debug] [MainThread]: 1699: static parser successfully parsed report/report_year_invoices.sql
[0m12:00:49.720204 [debug] [MainThread]: 1603: static parser failed on transform/dim_customer.sql
[0m12:00:49.735006 [debug] [MainThread]: 1602: parser fallback to jinja rendering on transform/dim_customer.sql
[0m12:00:49.737599 [debug] [MainThread]: 1699: static parser successfully parsed transform/dim_datetime.sql
[0m12:00:49.741520 [debug] [MainThread]: 1603: static parser failed on transform/dim_product.sql
[0m12:00:49.747800 [debug] [MainThread]: 1602: parser fallback to jinja rendering on transform/dim_product.sql
[0m12:00:49.750216 [debug] [MainThread]: 1603: static parser failed on transform/fct_invoices.sql
[0m12:00:49.758529 [debug] [MainThread]: 1602: parser fallback to jinja rendering on transform/fct_invoices.sql
[0m12:00:49.828751 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f13a0f95-898f-4cf4-a1f3-83450548a0c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb12c728f10>]}
[0m12:00:49.845266 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f13a0f95-898f-4cf4-a1f3-83450548a0c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb12b500690>]}
[0m12:00:49.846334 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 474 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics, 0 groups
[0m12:00:49.847393 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f13a0f95-898f-4cf4-a1f3-83450548a0c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb13108ba50>]}
[0m12:00:49.849447 [info ] [MainThread]: 
[0m12:00:49.851101 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m12:00:49.852930 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sapient-cycling-413017'
[0m12:00:49.853711 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:00:50.943375 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017, now list_sapient-cycling-413017_retail)
[0m12:00:50.945465 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:00:51.826984 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f13a0f95-898f-4cf4-a1f3-83450548a0c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb12c9a42d0>]}
[0m12:00:51.829902 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:00:51.831890 [info ] [MainThread]: 
[0m12:00:51.848106 [debug] [Thread-1 (]: Began running node model.retail.dim_customer
[0m12:00:51.850933 [info ] [Thread-1 (]: 1 of 7 START sql table model retail.dim_customer ............................... [RUN]
[0m12:00:51.853176 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017_retail, now model.retail.dim_customer)
[0m12:00:51.854673 [debug] [Thread-1 (]: Began compiling node model.retail.dim_customer
[0m12:00:51.867169 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_customer"
[0m12:00:51.878040 [debug] [Thread-1 (]: Timing info for model.retail.dim_customer (compile): 12:00:51.855639 => 12:00:51.877472
[0m12:00:51.879630 [debug] [Thread-1 (]: Began executing node model.retail.dim_customer
[0m12:00:51.897222 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:00:52.864001 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_customer"
[0m12:00:52.875365 [debug] [Thread-1 (]: On model.retail.dim_customer: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_customer"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_customer`
    
    

    OPTIONS()
    as (
      -- dim_customer.sql

-- Create the dimension table
WITH customer_cte AS (
	SELECT DISTINCT
	    to_hex(md5(cast(coalesce(cast(CustomerID as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Country as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as customer_id,
	    Country AS country
	FROM `sapient-cycling-413017`.`retail`.`raw_invoices`
	WHERE CustomerID IS NOT NULL
)
SELECT
    t.*,
	cm.iso
FROM customer_cte t
LEFT JOIN `sapient-cycling-413017`.`retail`.`country` cm ON t.country = cm.nicename
    );
  
[0m12:00:56.867282 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:4b148e2e-9d10-46a8-91d9-30cdb8239478&page=queryresults
[0m12:00:56.885187 [debug] [Thread-1 (]: Timing info for model.retail.dim_customer (execute): 12:00:51.880592 => 12:00:56.884952
[0m12:00:56.887241 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f13a0f95-898f-4cf4-a1f3-83450548a0c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb12c5b3c10>]}
[0m12:00:56.888870 [info ] [Thread-1 (]: 1 of 7 OK created sql table model retail.dim_customer .......................... [[32mCREATE TABLE (4.4k rows, 11.1 MiB processed)[0m in 5.03s]
[0m12:00:56.890426 [debug] [Thread-1 (]: Finished running node model.retail.dim_customer
[0m12:00:56.891633 [debug] [Thread-1 (]: Began running node model.retail.dim_datetime
[0m12:00:56.892757 [info ] [Thread-1 (]: 2 of 7 START sql table model retail.dim_datetime ............................... [RUN]
[0m12:00:56.894434 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_customer, now model.retail.dim_datetime)
[0m12:00:56.895585 [debug] [Thread-1 (]: Began compiling node model.retail.dim_datetime
[0m12:00:56.899833 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_datetime"
[0m12:00:56.910996 [debug] [Thread-1 (]: Timing info for model.retail.dim_datetime (compile): 12:00:56.896611 => 12:00:56.910679
[0m12:00:56.912358 [debug] [Thread-1 (]: Began executing node model.retail.dim_datetime
[0m12:00:56.916919 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:00:57.829051 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_datetime"
[0m12:00:57.838181 [debug] [Thread-1 (]: On model.retail.dim_datetime: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_datetime"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_datetime`
    
    

    OPTIONS()
    as (
      WITH datetime_cte AS (  
  SELECT DISTINCT
    InvoiceDate AS datetime_id,
    CASE
      WHEN LENGTH(FORMAT_TIMESTAMP('%Y-%m-%d %H:%M:%S', InvoiceDate)) = 16 THEN
        -- Date format: "DD/MM/YYYY HH:MM"
        PARSE_DATETIME('%m/%d/%Y %H:%M', FORMAT_TIMESTAMP('%Y-%m-%d %H:%M:%S', InvoiceDate))
      WHEN LENGTH(FORMAT_TIMESTAMP('%Y-%m-%d %H:%M:%S', InvoiceDate)) <= 14 THEN
        -- Date format: "MM/DD/YY HH:MM"
        PARSE_DATETIME('%m/%d/%y %H:%M', FORMAT_TIMESTAMP('%Y-%m-%d %H:%M:%S', InvoiceDate))
      ELSE
        NULL
    END AS date_part
  FROM `sapient-cycling-413017`.`retail`.`raw_invoices`
  WHERE InvoiceDate IS NOT NULL
)
SELECT
  datetime_id,
  date_part as datetime,
  EXTRACT(YEAR FROM date_part) AS year,
  EXTRACT(MONTH FROM date_part) AS month,
  EXTRACT(DAY FROM date_part) AS day,
  EXTRACT(HOUR FROM date_part) AS hour,
  EXTRACT(MINUTE FROM date_part) AS minute,
  EXTRACT(DAYOFWEEK FROM date_part) AS weekday
FROM datetime_cte
    );
  
[0m12:01:03.248925 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:5b9a6746-63e6-4cfb-8b4e-91dc91c74d71&page=queryresults
[0m12:01:03.252474 [debug] [Thread-1 (]: Timing info for model.retail.dim_datetime (execute): 12:00:56.914615 => 12:01:03.252276
[0m12:01:03.254258 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f13a0f95-898f-4cf4-a1f3-83450548a0c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb12c5b39d0>]}
[0m12:01:03.255716 [info ] [Thread-1 (]: 2 of 7 OK created sql table model retail.dim_datetime .......................... [[32mCREATE TABLE (23.3k rows, 4.1 MiB processed)[0m in 6.36s]
[0m12:01:03.257621 [debug] [Thread-1 (]: Finished running node model.retail.dim_datetime
[0m12:01:03.258849 [debug] [Thread-1 (]: Began running node model.retail.dim_product
[0m12:01:03.260008 [info ] [Thread-1 (]: 3 of 7 START sql table model retail.dim_product ................................ [RUN]
[0m12:01:03.261741 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_datetime, now model.retail.dim_product)
[0m12:01:03.263006 [debug] [Thread-1 (]: Began compiling node model.retail.dim_product
[0m12:01:03.268940 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.dim_product"
[0m12:01:03.278383 [debug] [Thread-1 (]: Timing info for model.retail.dim_product (compile): 12:01:03.264019 => 12:01:03.277964
[0m12:01:03.279658 [debug] [Thread-1 (]: Began executing node model.retail.dim_product
[0m12:01:03.283825 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:01:04.243156 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.dim_product"
[0m12:01:04.253652 [debug] [Thread-1 (]: On model.retail.dim_product: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.dim_product"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`dim_product`
    
    

    OPTIONS()
    as (
      -- dim_product.sql
-- StockCode isn't unique, a product with the same id can have different and prices
-- Create the dimension table
SELECT DISTINCT
    to_hex(md5(cast(coalesce(cast(StockCode as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Description as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(UnitPrice as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as product_id,
		StockCode AS stock_code,
    Description AS description,
    UnitPrice AS price
FROM `sapient-cycling-413017`.`retail`.`raw_invoices`
WHERE StockCode IS NOT NULL
AND UnitPrice > 0
    );
  
[0m12:01:08.410265 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:6c1b5d51-199f-4c00-b640-d6c4c330c871&page=queryresults
[0m12:01:08.413661 [debug] [Thread-1 (]: Timing info for model.retail.dim_product (execute): 12:01:03.280642 => 12:01:08.413499
[0m12:01:08.415241 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f13a0f95-898f-4cf4-a1f3-83450548a0c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb12c674110>]}
[0m12:01:08.416496 [info ] [Thread-1 (]: 3 of 7 OK created sql table model retail.dim_product ........................... [[32mCREATE TABLE (16.3k rows, 22.6 MiB processed)[0m in 5.15s]
[0m12:01:08.417862 [debug] [Thread-1 (]: Finished running node model.retail.dim_product
[0m12:01:08.419612 [debug] [Thread-1 (]: Began running node model.retail.fct_invoices
[0m12:01:08.420483 [info ] [Thread-1 (]: 4 of 7 START sql table model retail.fct_invoices ............................... [RUN]
[0m12:01:08.421727 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.dim_product, now model.retail.fct_invoices)
[0m12:01:08.422595 [debug] [Thread-1 (]: Began compiling node model.retail.fct_invoices
[0m12:01:08.430262 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.fct_invoices"
[0m12:01:08.439857 [debug] [Thread-1 (]: Timing info for model.retail.fct_invoices (compile): 12:01:08.423272 => 12:01:08.439550
[0m12:01:08.440951 [debug] [Thread-1 (]: Began executing node model.retail.fct_invoices
[0m12:01:08.444798 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:01:09.321315 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.fct_invoices"
[0m12:01:09.331984 [debug] [Thread-1 (]: On model.retail.fct_invoices: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.fct_invoices"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`fct_invoices`
    
    

    OPTIONS()
    as (
      -- fct_invoices.sql

-- Create the fact table by joining the relevant keys from dimension table
WITH fct_invoices_cte AS (
    SELECT
        InvoiceNo AS invoice_id,
        InvoiceDate AS datetime_id,
        to_hex(md5(cast(coalesce(cast(StockCode as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Description as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(UnitPrice as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as product_id,
        to_hex(md5(cast(coalesce(cast(CustomerID as STRING), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Country as STRING), '_dbt_utils_surrogate_key_null_') as STRING))) as customer_id,
        Quantity AS quantity,
        Quantity * UnitPrice AS total
    FROM `sapient-cycling-413017`.`retail`.`raw_invoices`
    WHERE Quantity > 0
)
SELECT
    invoice_id,
    dt.datetime_id,
    dp.product_id,
    dc.customer_id,
    quantity,
    total
FROM fct_invoices_cte fi
INNER JOIN `sapient-cycling-413017`.`retail`.`dim_datetime` dt ON fi.datetime_id = dt.datetime_id
INNER JOIN `sapient-cycling-413017`.`retail`.`dim_product` dp ON fi.product_id = dp.product_id
INNER JOIN `sapient-cycling-413017`.`retail`.`dim_customer` dc ON fi.customer_id = dc.customer_id
    );
  
[0m12:01:18.526233 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:e90c0f25-71c2-4c1e-a94d-1d21f64f60f8&page=queryresults
[0m12:01:18.530129 [debug] [Thread-1 (]: Timing info for model.retail.fct_invoices (execute): 12:01:08.442472 => 12:01:18.529936
[0m12:01:18.532169 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f13a0f95-898f-4cf4-a1f3-83450548a0c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb12c681410>]}
[0m12:01:18.533779 [info ] [Thread-1 (]: 4 of 7 OK created sql table model retail.fct_invoices .......................... [[32mCREATE TABLE (397.9k rows, 46.9 MiB processed)[0m in 10.11s]
[0m12:01:18.536497 [debug] [Thread-1 (]: Finished running node model.retail.fct_invoices
[0m12:01:18.539646 [debug] [Thread-1 (]: Began running node model.retail.report_customer_invoices
[0m12:01:18.541716 [info ] [Thread-1 (]: 5 of 7 START sql table model retail.report_customer_invoices ................... [RUN]
[0m12:01:18.543655 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.fct_invoices, now model.retail.report_customer_invoices)
[0m12:01:18.544665 [debug] [Thread-1 (]: Began compiling node model.retail.report_customer_invoices
[0m12:01:18.548247 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.report_customer_invoices"
[0m12:01:18.557866 [debug] [Thread-1 (]: Timing info for model.retail.report_customer_invoices (compile): 12:01:18.545381 => 12:01:18.557414
[0m12:01:18.559018 [debug] [Thread-1 (]: Began executing node model.retail.report_customer_invoices
[0m12:01:18.575723 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:01:19.635202 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.report_customer_invoices"
[0m12:01:19.642018 [debug] [Thread-1 (]: On model.retail.report_customer_invoices: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.report_customer_invoices"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`report_customer_invoices`
    
    

    OPTIONS()
    as (
      SELECT
  c.country,
  c.iso,
  COUNT(fi.invoice_id) AS total_invoices,
  SUM(fi.total) AS total_revenue
FROM `sapient-cycling-413017`.`retail`.`fct_invoices` fi
JOIN `sapient-cycling-413017`.`retail`.`dim_customer` c ON fi.customer_id = c.customer_id
GROUP BY c.country, c.iso
ORDER BY total_revenue DESC
LIMIT 10
    );
  
[0m12:01:23.066599 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:3081769a-58be-4aa1-b0a4-8d73315c3cf7&page=queryresults
[0m12:01:23.076428 [debug] [Thread-1 (]: Timing info for model.retail.report_customer_invoices (execute): 12:01:18.559925 => 12:01:23.075999
[0m12:01:23.080662 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f13a0f95-898f-4cf4-a1f3-83450548a0c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb12b571510>]}
[0m12:01:23.087742 [info ] [Thread-1 (]: 5 of 7 OK created sql table model retail.report_customer_invoices .............. [[32mCREATE TABLE (10.0 rows, 19.2 MiB processed)[0m in 4.54s]
[0m12:01:23.100514 [debug] [Thread-1 (]: Finished running node model.retail.report_customer_invoices
[0m12:01:23.107201 [debug] [Thread-1 (]: Began running node model.retail.report_product_invoices
[0m12:01:23.118487 [info ] [Thread-1 (]: 6 of 7 START sql table model retail.report_product_invoices .................... [RUN]
[0m12:01:23.127141 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.report_customer_invoices, now model.retail.report_product_invoices)
[0m12:01:23.128906 [debug] [Thread-1 (]: Began compiling node model.retail.report_product_invoices
[0m12:01:23.134071 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.report_product_invoices"
[0m12:01:23.254965 [debug] [Thread-1 (]: Timing info for model.retail.report_product_invoices (compile): 12:01:23.130076 => 12:01:23.254527
[0m12:01:23.267079 [debug] [Thread-1 (]: Began executing node model.retail.report_product_invoices
[0m12:01:23.277113 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:01:24.188229 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.report_product_invoices"
[0m12:01:24.201805 [debug] [Thread-1 (]: On model.retail.report_product_invoices: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.report_product_invoices"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`report_product_invoices`
    
    

    OPTIONS()
    as (
      SELECT
  p.product_id,
  p.stock_code,
  p.description,
  SUM(fi.quantity) AS total_quantity_sold
FROM `sapient-cycling-413017`.`retail`.`fct_invoices` fi
JOIN `sapient-cycling-413017`.`retail`.`dim_product` p ON fi.product_id = p.product_id
GROUP BY p.product_id, p.stock_code, p.description
ORDER BY total_quantity_sold DESC
LIMIT 10
    );
  
[0m12:01:28.225906 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:28deb9d8-e355-43f2-981b-539073958ecd&page=queryresults
[0m12:01:28.228846 [debug] [Thread-1 (]: Timing info for model.retail.report_product_invoices (execute): 12:01:23.273440 => 12:01:28.228685
[0m12:01:28.230219 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f13a0f95-898f-4cf4-a1f3-83450548a0c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb12c851d10>]}
[0m12:01:28.231422 [info ] [Thread-1 (]: 6 of 7 OK created sql table model retail.report_product_invoices ............... [[32mCREATE TABLE (10.0 rows, 17.0 MiB processed)[0m in 5.10s]
[0m12:01:28.232659 [debug] [Thread-1 (]: Finished running node model.retail.report_product_invoices
[0m12:01:28.233619 [debug] [Thread-1 (]: Began running node model.retail.report_year_invoices
[0m12:01:28.234563 [info ] [Thread-1 (]: 7 of 7 START sql table model retail.report_year_invoices ....................... [RUN]
[0m12:01:28.235957 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.report_product_invoices, now model.retail.report_year_invoices)
[0m12:01:28.236919 [debug] [Thread-1 (]: Began compiling node model.retail.report_year_invoices
[0m12:01:28.240434 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.report_year_invoices"
[0m12:01:28.248581 [debug] [Thread-1 (]: Timing info for model.retail.report_year_invoices (compile): 12:01:28.237649 => 12:01:28.248290
[0m12:01:28.249786 [debug] [Thread-1 (]: Began executing node model.retail.report_year_invoices
[0m12:01:28.254457 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:01:29.179961 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.report_year_invoices"
[0m12:01:29.190666 [debug] [Thread-1 (]: On model.retail.report_year_invoices: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.report_year_invoices"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`report_year_invoices`
    
    

    OPTIONS()
    as (
      SELECT
  dt.year,
  dt.month,
  COUNT(DISTINCT fi.invoice_id) AS num_invoices,
  SUM(fi.total) AS total_revenue
FROM `sapient-cycling-413017`.`retail`.`fct_invoices` fi
JOIN `sapient-cycling-413017`.`retail`.`dim_datetime` dt ON fi.datetime_id = dt.datetime_id
GROUP BY dt.year, dt.month
ORDER BY dt.year, dt.month
    );
  
[0m12:01:33.306265 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:d176f8d0-0415-4f17-a76d-54ef171c676f&page=queryresults
[0m12:01:33.309470 [debug] [Thread-1 (]: Timing info for model.retail.report_year_invoices (execute): 12:01:28.250862 => 12:01:33.309256
[0m12:01:33.311129 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f13a0f95-898f-4cf4-a1f3-83450548a0c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb12b50cc10>]}
[0m12:01:33.312525 [info ] [Thread-1 (]: 7 of 7 OK created sql table model retail.report_year_invoices .................. [[32mCREATE TABLE (1.0 rows, 9.3 MiB processed)[0m in 5.08s]
[0m12:01:33.314040 [debug] [Thread-1 (]: Finished running node model.retail.report_year_invoices
[0m12:01:33.316637 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:01:33.317458 [debug] [MainThread]: Connection 'model.retail.report_year_invoices' was properly closed.
[0m12:01:33.318361 [info ] [MainThread]: 
[0m12:01:33.319439 [info ] [MainThread]: Finished running 7 table models in 0 hours 0 minutes and 43.47 seconds (43.47s).
[0m12:01:33.322050 [debug] [MainThread]: Command end result
[0m12:01:33.339603 [info ] [MainThread]: 
[0m12:01:33.342988 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:01:33.344752 [info ] [MainThread]: 
[0m12:01:33.346053 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m12:01:33.348053 [debug] [MainThread]: Command `dbt run` succeeded at 12:01:33.347836 after 45.65 seconds
[0m12:01:33.350362 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb12e599fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb12e7784d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb12cad8a90>]}
[0m12:01:33.352429 [debug] [MainThread]: Flushing usage events
[0m12:04:28.577784 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed78fdac50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed78dc20d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed78fd95d0>]}


============================== 12:04:28.584264 | dbbd9c61-06a6-4abe-a915-42cc1d0ccece ==============================
[0m12:04:28.584264 [info ] [MainThread]: Running with dbt=1.5.0
[0m12:04:28.585553 [debug] [MainThread]: running dbt with arguments {'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'target_path': 'None', 'use_experimental_parser': 'False', 'quiet': 'False', 'use_colors': 'True', 'log_path': '/usr/local/airflow/include/dbt/logs', 'debug': 'False', 'version_check': 'True', 'introspect': 'True', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'indirect_selection': 'eager', 'printer_width': '80', 'warn_error': 'None', 'log_format': 'default', 'static_parser': 'True', 'no_print': 'None', 'partial_parse': 'True', 'profiles_dir': '/usr/local/airflow/include/dbt/', 'log_cache_events': 'False', 'write_json': 'True'}
[0m12:04:29.546574 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dbbd9c61-06a6-4abe-a915-42cc1d0ccece', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed78fdac50>]}
[0m12:04:29.561397 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dbbd9c61-06a6-4abe-a915-42cc1d0ccece', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed573d2f90>]}
[0m12:04:29.597944 [debug] [MainThread]: checksum: 4568eb639a77b8fcb3a1f4a07856f42b1ff63f1376652889143968e1dbdafbda, vars: {}, profile: , target: , version: 1.5.0
[0m12:04:29.621263 [info ] [MainThread]: Unable to do partial parsing because of a version mismatch
[0m12:04:29.623078 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'dbbd9c61-06a6-4abe-a915-42cc1d0ccece', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed56e4ca10>]}
[0m12:04:31.360494 [debug] [MainThread]: 1699: static parser successfully parsed report/report_customer_invoices.sql
[0m12:04:31.376157 [debug] [MainThread]: 1699: static parser successfully parsed report/report_product_invoices.sql
[0m12:04:31.381658 [debug] [MainThread]: 1699: static parser successfully parsed report/report_year_invoices.sql
[0m12:04:31.386303 [debug] [MainThread]: 1603: static parser failed on transform/dim_customer.sql
[0m12:04:31.405821 [debug] [MainThread]: 1602: parser fallback to jinja rendering on transform/dim_customer.sql
[0m12:04:31.409632 [debug] [MainThread]: 1699: static parser successfully parsed transform/dim_datetime.sql
[0m12:04:31.416576 [debug] [MainThread]: 1603: static parser failed on transform/dim_product.sql
[0m12:04:31.425117 [debug] [MainThread]: 1602: parser fallback to jinja rendering on transform/dim_product.sql
[0m12:04:31.427742 [debug] [MainThread]: 1603: static parser failed on transform/fct_invoices.sql
[0m12:04:31.439365 [debug] [MainThread]: 1602: parser fallback to jinja rendering on transform/fct_invoices.sql
[0m12:04:31.530103 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dbbd9c61-06a6-4abe-a915-42cc1d0ccece', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed5651ad50>]}
[0m12:04:31.553281 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dbbd9c61-06a6-4abe-a915-42cc1d0ccece', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed555b6a10>]}
[0m12:04:31.554678 [info ] [MainThread]: Found 7 models, 0 tests, 0 snapshots, 0 analyses, 471 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics, 0 groups
[0m12:04:31.556002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dbbd9c61-06a6-4abe-a915-42cc1d0ccece', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed7881e650>]}
[0m12:04:31.561590 [info ] [MainThread]: 
[0m12:04:31.564618 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m12:04:31.567271 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_sapient-cycling-413017'
[0m12:04:31.569111 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:04:32.591746 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017, now list_sapient-cycling-413017_retail)
[0m12:04:32.593062 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:04:33.520025 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dbbd9c61-06a6-4abe-a915-42cc1d0ccece', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed5656e790>]}
[0m12:04:33.521880 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:04:33.523266 [info ] [MainThread]: 
[0m12:04:33.538242 [debug] [Thread-1 (]: Began running node model.retail.report_customer_invoices
[0m12:04:33.540018 [info ] [Thread-1 (]: 1 of 3 START sql table model retail.report_customer_invoices ................... [RUN]
[0m12:04:33.541959 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_sapient-cycling-413017_retail, now model.retail.report_customer_invoices)
[0m12:04:33.543255 [debug] [Thread-1 (]: Began compiling node model.retail.report_customer_invoices
[0m12:04:33.548841 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.report_customer_invoices"
[0m12:04:33.563806 [debug] [Thread-1 (]: Timing info for model.retail.report_customer_invoices (compile): 12:04:33.544558 => 12:04:33.563258
[0m12:04:33.565672 [debug] [Thread-1 (]: Began executing node model.retail.report_customer_invoices
[0m12:04:33.588358 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:04:34.788391 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.report_customer_invoices"
[0m12:04:34.802492 [debug] [Thread-1 (]: On model.retail.report_customer_invoices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.report_customer_invoices"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`report_customer_invoices`
    
    

    OPTIONS()
    as (
      -- report_customer_invoices.sql
SELECT
  c.country,
  c.iso,
  COUNT(fi.invoice_id) AS total_invoices,
  SUM(fi.total) AS total_revenue
FROM `sapient-cycling-413017`.`retail`.`fct_invoices` fi
JOIN `sapient-cycling-413017`.`retail`.`dim_customer` c ON fi.customer_id = c.customer_id
GROUP BY c.country, c.iso
ORDER BY total_revenue DESC
LIMIT 10
    );
  
[0m12:04:38.205123 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:3a125956-bcc8-4462-924b-3e484877efc6&page=queryresults
[0m12:04:38.222339 [debug] [Thread-1 (]: Timing info for model.retail.report_customer_invoices (execute): 12:04:33.567058 => 12:04:38.222112
[0m12:04:38.224170 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dbbd9c61-06a6-4abe-a915-42cc1d0ccece', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed555b6c10>]}
[0m12:04:38.225778 [info ] [Thread-1 (]: 1 of 3 OK created sql table model retail.report_customer_invoices .............. [[32mCREATE TABLE (10.0 rows, 19.2 MiB processed)[0m in 4.68s]
[0m12:04:38.227733 [debug] [Thread-1 (]: Finished running node model.retail.report_customer_invoices
[0m12:04:38.229241 [debug] [Thread-1 (]: Began running node model.retail.report_product_invoices
[0m12:04:38.230884 [info ] [Thread-1 (]: 2 of 3 START sql table model retail.report_product_invoices .................... [RUN]
[0m12:04:38.232746 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.report_customer_invoices, now model.retail.report_product_invoices)
[0m12:04:38.234004 [debug] [Thread-1 (]: Began compiling node model.retail.report_product_invoices
[0m12:04:38.237998 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.report_product_invoices"
[0m12:04:38.248093 [debug] [Thread-1 (]: Timing info for model.retail.report_product_invoices (compile): 12:04:38.234926 => 12:04:38.247622
[0m12:04:38.249248 [debug] [Thread-1 (]: Began executing node model.retail.report_product_invoices
[0m12:04:38.252665 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:04:39.276265 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.report_product_invoices"
[0m12:04:39.285089 [debug] [Thread-1 (]: On model.retail.report_product_invoices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.report_product_invoices"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`report_product_invoices`
    
    

    OPTIONS()
    as (
      -- report_product_invoices.sql
SELECT
  p.product_id,
  p.stock_code,
  p.description,
  SUM(fi.quantity) AS total_quantity_sold
FROM `sapient-cycling-413017`.`retail`.`fct_invoices` fi
JOIN `sapient-cycling-413017`.`retail`.`dim_product` p ON fi.product_id = p.product_id
GROUP BY p.product_id, p.stock_code, p.description
ORDER BY total_quantity_sold DESC
LIMIT 10
    );
  
[0m12:04:42.919659 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:b2594261-4191-4b75-855d-22f5d45600ca&page=queryresults
[0m12:04:42.922893 [debug] [Thread-1 (]: Timing info for model.retail.report_product_invoices (execute): 12:04:38.250135 => 12:04:42.922721
[0m12:04:42.924732 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dbbd9c61-06a6-4abe-a915-42cc1d0ccece', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed55581f90>]}
[0m12:04:42.926437 [info ] [Thread-1 (]: 2 of 3 OK created sql table model retail.report_product_invoices ............... [[32mCREATE TABLE (10.0 rows, 17.0 MiB processed)[0m in 4.69s]
[0m12:04:42.928455 [debug] [Thread-1 (]: Finished running node model.retail.report_product_invoices
[0m12:04:42.930090 [debug] [Thread-1 (]: Began running node model.retail.report_year_invoices
[0m12:04:42.931684 [info ] [Thread-1 (]: 3 of 3 START sql table model retail.report_year_invoices ....................... [RUN]
[0m12:04:42.933347 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.retail.report_product_invoices, now model.retail.report_year_invoices)
[0m12:04:42.934586 [debug] [Thread-1 (]: Began compiling node model.retail.report_year_invoices
[0m12:04:42.938472 [debug] [Thread-1 (]: Writing injected SQL for node "model.retail.report_year_invoices"
[0m12:04:42.949551 [debug] [Thread-1 (]: Timing info for model.retail.report_year_invoices (compile): 12:04:42.935599 => 12:04:42.949158
[0m12:04:42.950954 [debug] [Thread-1 (]: Began executing node model.retail.report_year_invoices
[0m12:04:42.966697 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:04:43.977601 [debug] [Thread-1 (]: Writing runtime sql for node "model.retail.report_year_invoices"
[0m12:04:43.987474 [debug] [Thread-1 (]: On model.retail.report_year_invoices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "retail", "target_name": "dev", "node_id": "model.retail.report_year_invoices"} */

  
    

    create or replace table `sapient-cycling-413017`.`retail`.`report_year_invoices`
    
    

    OPTIONS()
    as (
      -- report_year_invoices.sql
SELECT
  dt.year,
  dt.month,
  COUNT(DISTINCT fi.invoice_id) AS num_invoices,
  SUM(fi.total) AS total_revenue
FROM `sapient-cycling-413017`.`retail`.`fct_invoices` fi
JOIN `sapient-cycling-413017`.`retail`.`dim_datetime` dt ON fi.datetime_id = dt.datetime_id
GROUP BY dt.year, dt.month
ORDER BY dt.year, dt.month
    );
  
[0m12:04:47.763774 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=sapient-cycling-413017&j=bq:US:42fe9f18-1e91-432e-a4cf-bf49f9fb5894&page=queryresults
[0m12:04:47.766847 [debug] [Thread-1 (]: Timing info for model.retail.report_year_invoices (execute): 12:04:42.951995 => 12:04:47.766621
[0m12:04:47.768560 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dbbd9c61-06a6-4abe-a915-42cc1d0ccece', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed555d6910>]}
[0m12:04:47.770121 [info ] [Thread-1 (]: 3 of 3 OK created sql table model retail.report_year_invoices .................. [[32mCREATE TABLE (1.0 rows, 9.3 MiB processed)[0m in 4.84s]
[0m12:04:47.771718 [debug] [Thread-1 (]: Finished running node model.retail.report_year_invoices
[0m12:04:47.774738 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:04:47.775763 [debug] [MainThread]: Connection 'model.retail.report_year_invoices' was properly closed.
[0m12:04:47.776858 [info ] [MainThread]: 
[0m12:04:47.777886 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 16.21 seconds (16.21s).
[0m12:04:47.779372 [debug] [MainThread]: Command end result
[0m12:04:47.796075 [info ] [MainThread]: 
[0m12:04:47.797133 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:04:47.798028 [info ] [MainThread]: 
[0m12:04:47.798976 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m12:04:47.800086 [debug] [MainThread]: Command `dbt run` succeeded at 12:04:47.799974 after 19.25 seconds
[0m12:04:47.800952 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed78daed90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed78832650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed7cf40790>]}
[0m12:04:47.801774 [debug] [MainThread]: Flushing usage events
